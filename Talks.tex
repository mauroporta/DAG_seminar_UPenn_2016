\pdfoutput=1
%The other issue is that some packages, such as microtype, produce different output under pdflatex. By default the arXiv goes from dvi to ps to pdf, so if you need pdflatex you have to set the \pdfoutput flag in the TeX file.
\newif\ifpersonal
\newif\ifarxiv
\personaltrue % comment to remove personal notes
\arxivtrue % comment to display shortened version for journal submissions
\RequirePackage[l2tabu, orthodox]{nag} %detect whether obsolete packages are used
\documentclass[10pt,a4paper,reqno,oneside]{book} %reqno places equation numbers on the right
\linespread{1.2}
%\allowdisplaybreaks[1]
\usepackage{calligra}
\usepackage{amsmath,amsthm,amssymb,mathrsfs,mathtools,bm,eucal,tensor} % math related
\usepackage{microtype,fixltx2e} % latex technical issues
\usepackage[scaled]{beramono,berasans}
\usepackage{enumerate,comment,braket,xspace,tikz-cd} %utilities
\usepackage[all,cmtip]{xy} % utilities
\usepackage[utf8]{inputenc} % input encoding
\usepackage[T1]{fontenc} % font encoding
\usepackage{lmodern}
\definecolor{linkcolor}{HTML}{005050}
\usepackage[centering,vscale=0.7,hscale=0.7]{geometry}
\usepackage{hyperref}
\usepackage[capitalize]{cleveref}
\usepackage{graphicx}
\usepackage{xparse}
\usepackage{url}

%\makeevenhead{headings}{\thepage}{}{\leftmark}
%\setlrmarginsandblock{3cm}{3.5cm}{*}
%\setlength\marginparwidth{2.5cm}
%\checkandfixthelayout
%
%\setlength\headheight{24pt}

\usepackage{vmargin}
\setpapersize{A4}
\setmarginsrb{25mm}{10mm}{25mm}{10mm}%
{12mm}{10mm}{5mm}{10mm}

\usepackage{fancyhdr}
\pagestyle{fancy}
%%%Settings
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}
\fancyhf{}
\fancyhead[LE,RO]{\bfseries\thepage}
\fancyhead[RE]{\bfseries\footnotesize\nouppercase{\leftmark}}
\fancyhead[LO]{\bfseries\footnotesize\nouppercase{\rightmark}}

\theoremstyle{plain}
\newtheorem{thm-intro}{Theorem}
\newtheorem{thm}{Theorem}[section]
\newtheorem*{thm*}{Theorem}
\newtheorem{lem}[thm]{Lemma}
\newtheorem*{lem*}{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{conj}[thm]{Conjecture}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{cor-intro}[thm-intro]{Corollary}
\newtheorem{assumption}[thm]{Assumption}
\theoremstyle{definition}
\newtheorem{defin}[thm]{Definition}
\newtheorem{exercise}[thm]{Exercise}
\newtheorem{defin-intro}[thm-intro]{Definition}
\newtheorem{notation}[thm]{Notation}
\theoremstyle{remark}
\newtheorem*{rem*}{Remark}
\newtheorem{eg}[thm]{Example}
\newtheorem{eg-intro}[thm-intro]{Example}
\newtheorem{rem}[thm]{Remark}
\newtheorem{rem-intro}[thm-intro]{Remark}
\numberwithin{equation}{section}
\newtheorem{construction}[thm]{Construction}

\input{newcommands_all}

\title{Derived Algebraic Geometry Seminar: Upenn 2016}

\begin{document}

\maketitle
\tableofcontents

\chapter*{Introduction}
\addcontentsline{toc}{chapter}{Introduction} \markboth{INTRODUCTION}{}

This contains notes livetexed for the Derived Algebraic Geometry Seminar currently being held at the University of Pennsylvania math department in the 2016-17 academic year.  We are following Mauro Porta's plan to introduce derived algebraic geometry, and then to look at derived geometric objects with extra structure (initially we will be looking at the case of symplectic and Poisson structures).

This is a draft and errors should be expected.

\chapter{$\infty$-category theory}
Talk by Mauro Porta.

\section{Why $\infty$-categories?}

Our main reason for studying $\infty$-categories in this seminar is that derived schemes form an $\infty$-category.
Some other applications of $\infty$-categories are the following.


\begin{enumerate}
\item \label{item:formal_moduli}
Formal moduli problems over a field $k$ of characteristic 0 are equivalent to $\text{dgLie}_{k}$, but this is
an equivalence of $\infty$-categories. We can see explicitly why this equivalence is plausible. For $F$ a formal moduli problem, 
$T_xF[1]$ is a dgLie algebra. Conversely, Maurer-Cartan elements on the RHS determine $F(k[\epsilon])$, 
i.e. infinitesimal formal moduli problems. Brackets then allow the complete recovery of $F$. 

\item 
The $\infty$-category of rational homotopy types is equivalent to that of dgLie algebras over $\Q$, concentrated in
positive degrees:
\[	S_*^{\text{rat}} \cong \text{dgLie}_{\Q}^{\geq 1}	\] 
This statement is related to item \ref{item:formal_moduli}: Lurie gives a nice proof using formal moduli problems, see 
\cite{DAG-XIII}.

\item To $X \in \Sch_k$, we associate its derived category of quasi-coherent sheaves, $D(X) = D(QCoh(X))$. 
It's a powerful invariant of $X$, especially when $X$ is not
smooth. For example, it contains the cotangent complex and dualizing complex, $\bbL_X , \omega_X \in D(X)$, which are not 
necessarily bounded if $X$ is not smooth.

The problem is that we cannot reconstruct $D(X)$, the derived category in the classical sense, by patching: $D(X) \not \simeq 
\lim_{\{U\} \text{ Zariski cover }} D(U)$. For example, take $X = \bbP^1_k$, and its standard cover by 2 open affines $U_0, U_1$.
We show that the functor:
\[	D(\bbP^1) \to D(U_0) \times_{D(U_{01})} D(U_1)	\]
is not faithful, by exhibiting a morphism in $D(\bbP^1)$ which gets mapped to 0. Start from the observation that morphisms
from the structure sheaf $\mathcal{O}_{\bbP^1}$ are the same as sections of the target sheaf, which implies:
\[	\R(\Hom) \big(\mathcal{O}_{\bbP^1},\mathcal{O}_{\bbP^1}(-2)[1]\big) \cong \R \Gamma\big(\mathcal{O}_{\bbP^1}(-2)[1]\big) .	\]
This complex has nontrivial cohomology in degree 0:
\begin{equation}
\label{eq:derived_counterex}
	H^0 \R \Gamma\big(\mathcal{O}_{\bbP^1}(-2)[1]\big) \cong H^1\big(\mathcal{O}_{\bbP^1}(-2)\big) \cong k.
\end{equation}
However, when passing to the affine patches, $D(U_i) \simeq D(k[T]-Mod)$, and the complexes corresponding to the
restrictions of $\mathcal{O}_{\bbP^1}$ and $\mathcal{O}_{\bbP^1}(-2)[1]$ are the following.
\[
\begin{tikzcd}
0\arrow{r} & 0\arrow{r} & k[T]\arrow{r} & 0 \\
0\arrow{r} & k[T]\arrow{r} & 0\arrow{r} & 0
\end{tikzcd}
\]
As such, there are no non-zero morphisms between the restrictions. Equivalently, when restricting to affine opens,
the first cohomology in equation \ref{eq:derived_counterex} is 0.

On the other hand, we will see that the $\infty$-derived category of $X$ (which we temporarily 
denote by $L_{\text{qcoh}}(X)$) can be patched using the homotopy fiber product:
\[	L_{qcoh}(\bbP^1_k) \simeq  L_{qcoh}(U_0) \times_{L_{qcoh}(U_{01})} L_{qcoh}(U_1) .\]

\item Let $\mathcal{M}_{ell}$ be the moduli stack of elliptic curves, i.e. the functor $F$ sending
$\Spec(A)$ to the classes of elliptic curves over $\Spec(A)$. It is not a sheaf, because two elliptic curves can become
isomorphic after a base extension. The problem here is that we were trying to take $F : \cA ff^{\op} \to \cS et$, and we can't talk
about isomorphisms in $\cS et$. Classically one solves this problem by replacing sets by groupoids, which are equivalent to
1-homotopy types.
\[
\begin{tikzcd}
\; & & \cG pd \cong \cS^{\leq 1} \\
\cA ff^{\op}\arrow{urr}{\text{stacks}}\arrow[swap]{rr}{\begin{array}{c}\text{naive moduli}\\
\text{problems}\end{array}} & & \cS et \cong \cS^{\leq 0}\arrow[hook]{u}
\end{tikzcd}
\]
We can define higher stacks by extending the tower to higher homotopy types, and ultimately to the category of spaces.
\[
\begin{tikzcd}
\; & &  \cS \\
\; & &  \vdots\arrow[hook]{u} \\
\; & &  \cS^{\leq 1}\arrow[hook]{u} \\
\cA ff^{\op}\arrow{uuurr}{\begin{array}{c}\text{higher}\\\text{stacks}\end{array}}
\arrow{urr}{\text{stacks}}\arrow[swap]{rr}{\begin{array}{c}\text{naive moduli}\\\text{problems}\end{array}} & & 
\cS et \cong \cS^{\leq 0}\arrow[hook]{u}
\end{tikzcd}
\]
In later talks, we'll
see that the perfect complexes $\cP erf$ form an $\infty$-stack which doesn't factor through finite homotopy types.
\end{enumerate}


\section{Three ways of working with $\infty$-categories}
To be attempted in order of desperation:
\begin{enumerate}
\item \label{model_indep} 
Reason model-independently to get a clean proof. The trick is that there are key statements (not proven model
independently; some are proven by Lurie and can be found in \cite{HTT}) which behave like a ``non-minimal set of axioms''.
One should learn a roadmap to \cite{HTT}, in order to know where to find these statements. (A good start for this roadmap is
reading \cite{groth}.)

\item 
\label{item:internal_rectification}
Internal rectification. 
\textbf{Rectification} is when something is defined up to homotopy, and we try to reduce the necessary homotopies. Suppose we have
a 1-category
$\cM$, and consider $\Fun(\Delta^2,\cM)$ and $\Fun(\Delta^2, \infty( \cM))$. The first is defined by specifying 3 objects and 3 morphisms, while
the second also requires the specification of a 2-morphism. In fact, these are the same as topological spaces due 
to \cite{HTT} 4.2.4.4. In this case, once the 1-morphisms are specified, the homotopy is defined up to a contractible space of choices, therefore forgetting it gives an equivalence.

Internal rectification is where we do rectification, while working in the setting of $\infty$-categories.
 Example: an $\infty$-category with
products, see it as a symmetric monoidal category with products. $Mon_{E_1}(\cC) \simeq Fun^{\times}(\Delta^{\op}, \cC)
\to Fun(\Delta^{\op}, \cC)$.
The reference is \cite{Lurie_Higher_algebra}, 4.1.2.6. 

\item \label{item:real_rectification}
Try a ``real rectification'' result, i.e. work with a model-categorical presentation. For example, take $\cS$,
the $\infty$-category
of spaces,  this is the Dwyer--Kan localization of the simplicial model category $sSet_{Kan}$. Suppose we wish to compute the limit (see \cite{groth} \S 2.5) of the functor $N(F)$, where $F$ maps $\cdot \rightarrow \cdot \leftarrow \cdot$ to $\{x\} \rightarrow X \leftarrow \{y\}$ and $N$ denotes the nerve functor, which takes categories to their associated $\infty$ categories. As
$\infty$-categorical limits correspond to homotopy limits in the model category (by \cite{HTT}, Theorem 4.2.4.1),  $Path_X(x,y)$ is the $\infty$-limit
of this diagram. See \cite{vezzosi2013autour} for more on model categories and their links to $\infty$-categories.


\end{enumerate}

In what follows we give examples where we can get by with procedure \ref{model_indep}. 

\begin{defin}
An $\infty$-category is a simplicial set $\cC$ such that all inner horns have fillers. In other words, for all $0<i<n$,
the dotted arrow in the following diagram exists.
\[
\begin{tikzcd}
\Lambda^{n}_{i}\arrow[hook]{d}\arrow{r} & \cC \\
\Delta^n\arrow[dotted]{ur} & 
\end{tikzcd}
\]
\end{defin}

Note that this achieves what we want: inner horn fillings act as composition of morphisms, but this composition is not unique. 
``Higher Topos Theory \cite{HTT} is the book where all of category theory is carried out without ever talking about composition.'' 
A few problems arise
from here:

\begin{enumerate}
\item How do we define Yoneda? A morphism $X \to Y$ is supposed to determine a morphism $h_X \to h_Y$ by composition, which
is not well-defined.
\item Let $\cC$ be an $\infty$-category. We want $f: x \to y$ in $\cC$ to determine a functor $f_*: \cC_{/X} \to \cC_{/Y}$
between over-categories, where, morally speaking, $g: Z \to X$ is sent to the composition $f \circ g$.
Again, this composition is not well-defined.
\end{enumerate}

To the rescue comes Corollary 2.4.7.12 in \cite{HTT}. 
\begin{thm}
\label{thm:cartesian_fib}
Let $f: \cC \to \cD$ be an $\infty$-functor between $\infty$-categories. Then the projection
\[	\mathcal{P} : Fun(\Delta^1, \cD) \times_{Fun(\{1\},\cD)} \cC \to Fun(\{0\}, \cD) 	\]
is a \textbf{cartesian fibration}. Moreover, a morphism in the source is $\mathcal{P}$-\textbf{cartesian} iff its image in $\cC$ 
is an \textbf{equivalence}.
\end{thm}
Note that the $\infty$-functors $\Fun(\cC,\cD)$ are nothing but the internal $\Hom$ in $s\cS et$. 
\[	\Fun(\cC,\cD)_n = s\cS et(\cC \times \Delta^n, \cD)	\]
It's standard to prove that, if $\cC, \cD$ are $\infty$-categories, then so is $\Hom(\cC, \cD)$.

We will spend much of section \ref{sect:cartesian} defining the terms in bold in Theorem \ref{thm:cartesian_fib}. In Example
\ref{eg:composition}, we will use Theorem \ref{thm:cartesian_fib} to obtain the desired pushforward map between overcategories.



\section{Equivalences and Cartesian fibrations}
\label{sect:cartesian}

\begin{defin}
$g : x \to y$ in $\cC$ is an \textbf{equivalence} if any of the following equivalent conditions hold.
\begin{enumerate}[(a)]
\item \label{item:inverse_fillers}
The map $g': \Lambda_0^2 \to \cC$ given by $\{1 \leftarrow 0 \rightarrow 2\} \mapsto \{y \overset{g}{\leftarrow} x 
\overset{1_x}{\rightarrow} x\}$ admits an extension:
\[
\begin{tikzcd}
\Lambda^2_0 \arrow{r}\arrow[hook]{d} & \cC \\
\Delta^2 \arrow[dotted]{ur} & 
\end{tikzcd}
\]
Morally speaking, the restriction of the dotted arrow to the face $12$ of $\Delta^2$ is the right inverse of $g$.

Moreover, the map $g'': \Lambda_2^2 \to \cC$ given by $\{0 \leftarrow 2 \rightarrow 1\} \mapsto \{y \overset{1_y}{\rightarrow} y 
\overset{g}{\leftarrow} x\}$ admits an extension:
\[
\begin{tikzcd}
\Lambda^2_2 \arrow{r}\arrow[hook]{d} & \cC \\
\Delta^2 \arrow[dotted]{ur} & 
\end{tikzcd}
\]
Morally speaking, the restriction of the dotted arrow to the face $01$ of $\Delta^2$ is the left inverse of $g$.

\item \label{item:infinity_sphere}
The same as variant \ref{item:inverse_fillers}, but with higher homotopies included. Formally, we introduce the
Kan complex $S^{\infty}$, defined as 0-coskeleton of the discrete simplicial set with 2 vertices. (For more details see
the exercises \cite{Mauro_Exercises}.)
We say that $g$ is equivalence if there is a lift in the following diagram.
\[
\begin{tikzcd}
\Delta^1 \arrow{r}{g}\arrow[hook]{d} & \cC \\
S^{\infty}\arrow[dotted]{ur} & 
\end{tikzcd}
\]

\item \label{item:iso_homcat}
We say that $g$ is an equivalence if its image in the homotopy category $h(\cC)$ is an isomorphism.
\footnote{Recall that this is a 1-category with objects Ob$(\cC)$ and morphisms $\Hom(x,y) = \pi_0(\cC(x,y))$.}
\end{enumerate}
\end{defin}

In the definition, going from version \ref{item:infinity_sphere} to version \ref{item:inverse_fillers} of is a rectification result,
in the sense of procedure \ref{item:internal_rectification} described above.

Next, we recall the notions of cartesian morphism and cartesian fibration in the context of 1-categories.
\begin{defin}
Let $\mathcal{P} : C \to D$ be a functor between 1-categories. If $x \in Ob(C)$ and $f\in \Hom(x,y)$, we use the notation
$\bar x := \mathcal{P}(x)$, $\bar f = \mathcal{P}(f)$. In the following diagram, the first 2 rows are in $C$, while the
third one is in $D$. However, we would like to think about the ``square'' as a pullback square.
\[
\begin{tikzcd}
z\arrow[dashed]{dd}{\mathcal{P}} & & \\
& x\arrow{r}{f}\arrow[dashed]{d}{\mathcal{P}} & y\arrow[dashed]{d}{\mathcal{P}} \\
\bar z & \bar x \arrow{r}{\bar f} & \bar y
\end{tikzcd}
\]
We say that $f$ is a $\mathcal{P}$-\textbf{cartesian morphism} if the data of a morphism $z \to y$ in $C$ and a 
morphism $\bar z \to \bar x$
in $D$ uniquely determine a morphism $z \to x$ in $C$, such that the ``diagram'' commutes.

We say that $\mathcal{P}$ is a \textbf{cartesian fibration} if for all $y \in C$ and all $\bar x \overset{\bar f}{\to} \bar y$ 
morphism in $D$, $\exists f : x \to y \in \mathcal{C}$ such that $\mathcal{P}(f) = \bar f$ and $f$ is $\mathcal{P}$-cartesian.
\end{defin}

The analogous definitions for $\infty$-categories are the following.

\begin{defin}
Let $\mathcal{P} : \cC \to \cD$ be an $\infty$-functor. A 1-morphism in $\cC$, which is the same as an edge $f: \Delta^1
\to \cC$, is $\mathcal{P}$\textbf{-cartesian} if for all $n\geq 2$, the following outer horn has a filler.
\[
\begin{tikzcd}
\Delta^1 = \Delta^{\{n-1,n\}}\arrow{d}\arrow{dr}{f} & \\
\Lambda^n_n\arrow{d}\arrow{r} & \cC \arrow{d}{\mathcal{P}} \\
\Delta^n \arrow{r}\arrow[dashed]{ur} & \cD
\end{tikzcd}
\]
Morally speaking, when $n=2$, this says that for any edge $g: z \to f(1)$ and edge $\bar h : \bar z \to \overline{f(0)}$,
there exist an edge $h : z \to f(0)$ and a homotopy $g \simeq f \circ h$, such that $\mathcal{P}(h) = \bar h$.

We say that $\mathcal{P}$ is a \textbf{cartesian fibration} if for every edge $a : \bar x \to \bar y$ of $\cD$, and every
object $y$ of $\cC$ such that $\mathcal{P}(y) = \bar y$, there exists a $\mathcal{P}$-cartesian edge $f : x \to y$ such that
$\mathcal{P}(f) = a$.
\end{defin}

Recall that, in the study of fibered 1-categories, one proves that cartesian fibrations with base $D$ are the same as
lax 2-functors from $D$ to the 2-category of 1-categories. (This is known as the ``Grothendieck construction'', see
for example, Proposition I.3.26 in \cite{FGAex}.) Explicitly, given a cartesian fibration $\mathcal{P} : C \to D$,
the corresponding lax 2-functor maps an object $d \in D$ to the fiber $\mathcal{P}^{-1}(d)$.
Theorem 3.2.0.1, the main theorem of Chapter 3 in \cite{HTT}, is the analog of this result for the setting of $\infty$-categories.

\begin{thm}
\label{thm:cartesian_equiv}
For any $\infty$-category $\cC$, there is an equivalence of $\infty$-categories:
\begin{equation}		
\text{CartFib}/\cC \simeq \Fun(\cC^{op},\Cat_{\infty}).
\end{equation}
\end{thm}

\begin{eg}
\label{eg:composition}
Recall that we started out by trying to construct an $\infty$-functor $f_* : \cC_{/x} \to \cC_{/y}$ between overcategories,
given an 1-morphism $f: x \to y$ in $\cC$. Taking $F : \cC \to \cC$ as the identity, Theorem \ref{thm:cartesian_fib} gives
a Cartesian fibration over $\cC$:
\[	  \big\{ (f : x \to y, a) | \{f :x \to y\} \in \cC, F(a) \cong y \big\} \to \cC,	\]
where a pair $(f : x \to y, a)$ maps to $x$. We recognize the fiber over $x$ as the undercategory $\cC_{x/}$:
\[	\Hom_{sSet}(\Delta^n, \cC_{x/}) = \big\{\alpha: \Delta^{n+1} \to \cC | \alpha_{\Delta^{[0,\dots,n}} = x \big\}.	\]

Theorem \ref{thm:cartesian_equiv} then produces an $\infty$-functor:
\begin{align*}
\cC^{\op} &\to \cC at_{\infty} \\
x & \mapsto \cC_{x/} \\
f:x\to y & \mapsto f^* : \cC_{y/} \to \cC_{x/}.
\end{align*}
We have obtained a pullback map on undercategories. To obtain the pushforward on overcategories, start with $F : \cC^{\op} \to \cC$
as the contravariant identity functor instead.\todo{we probably want co-cartesian fibrations actually}
\end{eg}

Next, we discuss a simpler example. Let $\cC$ be an $\infty$-category, and let $x \in \cC$ be an initial object. 
We want to construct a functor $\cC \to \cC_{x/}$. Note that this is silly in 1-category theory, since there's a unique 
morphism $x \to y$. To aid us in the context of $\infty$-categories, we start
by giving a good definition. 

\begin{defin}
$x \in \cC$ \textbf{initial} if $\forall y \in \cC$, $Map_{\cC}(x,y)$ is contractible.
\end{defin}

The key result, proved, for example, in \cite{groth}, is the following.
\begin{prop}
If $\cC$ is an $\infty$ category, then $x \in \cC$ is initial iff the canonical projection $\cC_{x/} \to \cC$ is
a trivial Kan fibration.
\end{prop}

To solve our problem, note that $\cC$ is cofibrant in the Kan model structure, so there exists a lift in the diagram:
\[
\begin{tikzcd}
\emptyset\arrow{d}\arrow{r} & \cC_{x/}\arrow{d} \\
\cC \arrow{r}{\id}\arrow[dashed]{ur} & \cC .
\end{tikzcd}
\]

In the exercises, we also encounter the following problem. Suppose $\cC$ has pushouts and a zero object. Construct 
an $\infty$-functor $\cC \to \cC$ sending $x$ to the pushout of 0 and 0 over $x$. \todo{write this up, either here or in the
exercises}






\chapter{Derived Affines}
Talk by Benedict Morrissey.

\section{3 perspectives on derived affines}

First recall the notion of affines in classical AG: $\Aff_k^{Cl} \simeq (\cC Ring)^{\op}$. We get schemes by gluing these together.
There's also the functor of points viewpoint: $X \in \Aff_k^{Cl}$ defines a sheaf by sending $\Spec R \mapsto \Hom
(\Spec R, X)$. The schemes are then precisely the sheaves in the Zariski topology.  Already in classical AG, there exist 
constructions which move us out of this category: 
both Serre's intersection theorem and Illusie's notion of the cotangent complex use derived functors.
So by introducing DAG, we will understand better these structures in classical AG.

We will talk about 3 approaches to derived affines --- all of these consist of embedding the classical category $CRing_{k}$ into a larger category in which we have a derived tensor product.  In this section we assume that we are working over a ring $k$ of characteristic zero\footnote{We note here that we neglect to mention the important generalization of rings given by E-$\infty$ ring spectra, as described in chapter 7 of \cite{Lurie_Higher_algebra}.  In the case where we are working over $k$ a $\mathbb{Q}$-algebra this infinity category is equivalent to those described in this section as shown in  \cite{Lurie_DAG_V} proposition 4.1.11.  When we remove the characteristic zero assumption the statements about the Model structure on CDGA's no longer hold.  One can still use simplicial commutative rings or E-$\infty$ algebras, though these give different $\infty$ categories.}.
\begin{enumerate}
\item \label{item:scr} Simplicial commutative rings;
\item \label{item:cdga} Commutative differential graded algebras. (CDGA's)
\item \label{item:lawvere} Lawvere theory;
\end{enumerate}

\begin{rem}
Classically gluing is easy. For example, fiber products are computed by reducing to the affine case, where it's just the
tensor product of rings. In DAG, the derived tensor product is only defined up to quasi-isomorphism, so gluing can only be
defined in a category which allows homotopy, such as an $\infty$-category. For today's talk we mostly use the model category description;
an application of Dwyer-Kan localization produces an $\infty$-category.
\end{rem}

\subsection{Simplicial Commutative Rings}

For approach \ref{item:scr}, recall that the simplicial category $\Delta$ is:
\[ 	Ob(\Delta) = \{n \in \N \cup \{0\} \}		\]
where morphisms are compositions of face maps $\delta_{i}^{n}:[n-1]\rightarrow [n]$ for $0 \leq i < n$ and degeneracy maps $s_{i}^{n}: [n+1]\rightarrow [n]$, subject to the simplicial identities as can be found in e.g. \cite{gillam2013simplicial}. 
\begin{defin}
The \textbf{category of simplicial commutative rings} is the category of contravariant functors:
\[	 SCR_k = \Hom(\Delta^{\op}, CRing_k).	\] 
\end{defin}

\begin{rem}
There's a model category structure on this: fibrations are Kan fibrations on the underlying simplicial sets, i.e. morphisms
$f: A \to B$ of simplicial commutative rings, such that all horns have fillers:
\[
\begin{tikzcd}
\Lambda^n_j\arrow[hook]{d}\arrow{r} & A\arrow{d}{f} \\
\Delta^n\arrow{r}\arrow[dashed]{ur} & B.
\end{tikzcd}
\]

Weak equivalences
are weak homotopy equivalences on the underlying simplicial sets. Cofibrations are then determined from the axioms of a
model category; note that they are \textit{not} the same as cofibrations of the underlying simplicial sets.
\end{rem}

\begin{rem}
\label{rem:transfer_model_structure}
We're using transfer to put the model structure on $SCR_k$. To explain what that means, under suitable conditions, there's 
a general procedure for defining a model structure on a category $\cB$, given a model category $\cA$ and an adjoint functor
pair:
\[
\begin{tikzcd}
 \cA \arrow[shift left]{r}{F} & \cB \arrow[shift left]{l}{G} .
\end{tikzcd}
\]
The procedure forces the adjoint functor pair to be a Quillen adjunction. In our case, we use the free-forgetful adjunction:
\[
\begin{tikzcd}
 s\cS et \arrow[shift left]{r}{F} & SCR_k \arrow[shift left]{l}{U}
\end{tikzcd}
\]
to transfer the Kan model structure to $SCR_k$. The key point which allows this to work is that all objects are fibrant. 
Cofibrations are more difficult to characterize, but the cofibrant objects are precisely the quasi-free ones. (That is,
the ones isomorphic to a free object.)
\end{rem}

\subsection{CDGA's}

Next, we introduce CDGA's and the Dold-Kan equivalence --- which shows that this category is the same as that of simplicial commutative rings under our assumption that we are working over a characteristic zero field. Recall that we have a Quillen equivalence:
\[
\begin{tikzcd}
	s\cV ect \arrow[shift left]{r} & dg-\cV ect^{\leq 0} \arrow[shift left]{l}
\end{tikzcd}
\]
between simplicial vector spaces and differential graded vector spaces, concentrated in nonpositive degrees. We want to
talk about commutative monoids in these categories, $sc\cA lg_k$ and $cdg-\cA lg^{\leq 0}$, respectively.
The model structure on $cdg-\cA lg^{\leq 0}$ can also be obtained by transfer from the free-forgetful adjunction; we obtain
that the weak equivalences are quasi-isomorphisms, and the fibrations are degree-wise surjections.

\begin{thm}[Symmetric monoidal Dold-Kan (A proof can be found in \cite{schwede2003equivalences})]
There is a Quillen equivalence:\footnote{Note that, in general, a Quillen equivalence is not an equivalence of categories.
It does, however, induce an equivalence of Dwyer-Kan localizations (and hence also of homotopy categories).}
\[
\begin{tikzcd}
	sc\cA lg_k \arrow[shift left]{r}{N} & cdg-\cA lg_k^{\leq 0} \arrow[shift left]{l}{\Gamma}.	
\end{tikzcd}
\]
Moreover, if the simplicial commutative algebra $A_*$ corresponds to the commutative dg-algebra $B_{\bullet}$, then
$\pi_i(A_*) \cong H^i(B_{\bullet})$.
\end{thm}

\begin{rem}
We describe $N$:
$A_* \in sc\cA lg_k$ maps in the first stage to $\tilde A_{\bullet}$, where $\tilde A_{-n} = A_n$, and the differential 
is the alternating sum of the face maps.
$N(A_*)$ is then the quotient of $\tilde A_{\bullet}$ by the images of the degeneracy maps.
For $C$ a CDGA we can describe $(\Gamma C)_{n}:=Hom_{ch^{-}}(N(\Delta^{n}), C)$ where we are in fact using the above definition of $N$ to give a functor from simplicial abelian groups to $ch^{-}$ --- the category of non positively graded chain complexes, and $\Delta^{n}$ is the simplicial abelian group freely generated by an $n$-simplex.  
\end{rem}

We have a similar result for the category of simplicial modules for a given simplicial ring, and the category of dg-modules for its image in CDGA's.  Note that the categories of simplicial modules and of non-positively graded modules for a given CDGA both have model structures.

\begin{thm}[\cite{schwede2003equivalences}]
If $A$ is a simplicial ring the categories of simplicial $A$-modules and of negatively graded $N(A)$-modules are Quillen equivalent.

If $A$ is a CDGA, the categories of negatively graded $A$-modules and of simplicial $\Gamma(A)$-modules are equivalent.
\end{thm}


We now define the truncation functor of a CDGA.  We can use the above Quillen equivalence to also define truncation functors on the category of Simplicial Commutative Rings.

Let $CDGA_{k}^{\leq n} \hookrightarrow CDGA_{k}$ denote the subcategory of $CDGA_{k}$ consisting of objects $A$ such that $H^{i}(A) =0$ for all $i>n$.  Note that $CDGA_{k}^{\leq 0} \cong CRing_{k}$.  The inclusion has a right adjoing $\tau^{\leq n}: CDGA_{k}\rightarrow CDGA^{\leq n}$.  For $A=(A_{n})$, \[(\tau^{\leq n}(A))_{m}= \begin{cases} 
      A_{m} & 0 > m > -n \\
      A/im(d^{m+1}) & m=n \\
      0 & m < n.
   \end{cases}
\]

%Note: Bousfield localization to put a model cateogry structure on n-homotopy type simplicial sets. Just declare the map
%from the $n$-sphere to the point to be a weak equivalence.

\subsection{Lawvere Theories}
\label{sect:lawvere}

We move on to approach \ref{item:lawvere} to derived affines, the Lawvere Theory description. 
This is important because
it's the only one of the 3 procedures which carries through in the analytic setting (see e.g. \cite{Porta_Yu_Higher_analytic_stacks_2014}). You get holomorphic rings, smooth rings,
and much of the theory of DAG can be carried in this setting.\todo{clear this part up}

The idea of Lawvere theory is to describe all objects with some type of algebraic structure as functors between the free objects and the category $Set$.
For example,
\[	AbGps \cong \Fun^{\times}(FAb^{\op}, Set).	\]
There's a map $\Z \to \Z \times \Z$, which sends $1\mapsto 1\times 1$. Since $F$ preserves products, $F(\Z) \times F(\Z)
\cong F(\Z \times \Z) \to F(\Z)$.  In fact $F(\Z)$ has the structure of an abelian group, and the equivalence of categories above is realized on objects by $F \mapsto F(Z)$.  We denote by $T_{disc}$ the opposite category of free commutative rings.  Free commutative rings are the rings $k[x_1, \dots, x_n]$. Hence $T_{disc}$ is the subcategory of the category of affine schemes with objects the planes $\{\bbA^n\}$.
$\Fun^{\times}(T_{disc}, Set) \cong CRing$. On objects we map a functor to it's value on the group ring $\bbA^{1}$, $F\mapsto F(\bbA^{1})$.  The addition and multiplication on $\bbA^{1}$ give $F(\bbA^{1})$ the structure of a (commutative) ring.  

Now pass to $SCR_k \cong s\Fun^{\times}(T_{disc}, Set) \cong \Fun^{\times}(T_{disc}, sSet) \cong \Fun^{\times}
(T_{disc}, S)$, where $S$ is the infinity category of spaces. The last step is a very hard rectification theorem, proved
by Lurie-Bergner.\footnote{HTT Propositions 5.5.9.2} 

 %$\Fun^{\times}(T_{disc}, sSet)_{projective}$. 

\section{Derived Affines as Ringed Spaces}

Finally, we take the viewpoint of seeing a scheme as a locally ringed space. For $A \in cdg-\cA lg_k$, we look at
the truncation $\Spec H^0(A)$, which is an affine scheme in the classical sense. We can regard $A$ 
as a sheaf of cdg-algebras on the truncation, as long as we can understand how localization works for cdg-algebras. 
We claim that it suffices to localize the commutative algebra $A_0$. Indeed, we have the multiplication map:
\[	\mu:	A_0 \times A_i \to A_i,		\]
so given a multiplicative subset $S \subset A_0$, we define the localization $S^{-1}A_i$ as $\mu(S^{-1}A_0 \times A_i)$.
If this makes sense, we get a sheaf $\mathcal{O}_A$ of cdg-algebras.

We would like to define derived affines as pairs $\big(\Spec H^0(A), \mathcal{O}_A\big)$. There is a subtlety: a priori 
this only gives a 2-category, and we need $\infty$-categories.  The key to resolving this is to define the notion of a sheaf valued in an $(\infty,1)$-category.



\section{Our favorite classes of morphisms}
\begin{defin}
Given $f: A \to B$ in $SCR_k$, we get maps:
\[	\pi_*(A) \otimes_{\pi_0(A)} \pi_0(B) \to \pi_*(B)	\]
of graded modules. We say that $f$ is \textbf{strong} if this is an isomorphism of graded modules.
\end{defin}

\begin{defin}
\label{def:fav_morphisms}
We define $f: A \to B$ to be \textbf{\'{e}tale} (resp. \textbf{smooth}, \textbf{Zariski open immersion}, \textbf{flat})
if $f$ is strong and $\pi_0(A) \to \pi_0(B)$ is \'{e}tale (resp. smooth, Zariski open immersion, flat) in the classical sense.
\end{defin}

\begin{rem}
The strength condition on $f$ is quite restrictive: for example, a strong map from a non-derived domain must have a non-derived
target.
\end{rem}

\begin{defin}
Let $X = \Spec(A)$ be a derived affine over $k$. Then the \textbf{small \'{e}tale site} of $X$ is:
\[	X_{\text{\'{e}t}} = \{\text{\'{e}tale maps }\Spec(B) \to \Spec(A)\}.	\]
\end{defin}

In order to obtain the small \'{e}tale site in the sense of classical AG, one needs to pass to the truncated version
of the \'etale maps: $\pi_0(f) : \Spec(\pi_0(B)) \to \Spec(\pi_0(A))$. Then one can prove there's an equivalence of 
$\infty$-categories between the derived and classical \'etale sites. In particular, this shows that 
$X_{\text{\'{e}t}}$ is a 1-category. This is one of the ingredients in the proof of the easy version
of Lurie representability. Moreover, the same holds for the small smooth site and the small Zariski site.

After introducing the cotangent complex $\bbL_f$ of a morphism $f$, we will see that $f$ is \'{e}tale iff $\pi_0(f)$ 
is of finite presentation and $\bbL_f \simeq 0$.

\begin{defin}
$f:A \to B$ is \textbf{of finite presentation} if the functor $\Map_A(B, - ) : sc\cR ing_k \to \cS$ commutes with
filtered colimits. 
\end{defin}

Unlike in the underived case, being of finite presentation is very strong, because it has a hidden regularity condition.
In particular, we have the proposition due to Lurie:

\begin{prop}
$f: A \to B$ is of finite presentation in the derived sense iff $\pi_0(f)$ is of finite presentation in the classical sense
(also called to order 0) and the cotangent complex $\bbL_f$ is perfect.
\end{prop}

\begin{eg}
Let $X = \bbA^3$, and $Y$ a closed subscheme of $X$ which is not a local complete intersection. 
Then the inclusion $\iota :Y \to X$ is not of finite presentation in the derived sense.
Indeed, by a conjecture of Quillen, which is now a theorem of Abramov, for maps between classical schemes, the cotangent 
complex is either concentrated in degrees 0 and -1, or it's unbounded. Since $Y$ is not lci, the first case is ruled out,
and $\bbL_{\iota}$ is unbounded.
\end{eg}





\chapter{Stable $\infty$-categories}
Talk by Michael Gerapetritis.

\section{Motivation}
\label{sect:motivation}

In the 1-categorical setting, if $\cC$ is a category, we may require that $\cC(A,B)$ be a set. 
To get particularly well-behaved categories, namely the additive categories, we require that $\cC(A,B)$ is actually
an abelian group. 

We try to replicate this in the $\infty$-category setting.
Let $\cC$ be an $\infty$-category, then $\cC(X,Y)$ is a space. We want to discover what is the good extra structure to have on 
this space; we will call the corresponding $\infty$-categories stable.


\section{Stable $\infty$-categories and triangulated 1-categories}

\begin{defin}
An $\infty$-category $\cC$ is \textbf{stable} if:
\begin{itemize}
\item $\cC$ is pointed, i.e. it has a zero object;
\item every morphism $f : X \to Y$ admits fibers and cofibers;
\item a triangle is a fiber iff it is a cofiber.
\end{itemize}
\end{defin}

Recall that a \textbf{triangle} in $\cC$ is a map of simplicial sets $\Delta^1 \times \Delta^1 \to \cC$,
i.e. a homotopy commutative diagram with the zero object in the bottom-left corner:
\[
\begin{tikzcd}
X\arrow{r}{f}\arrow{d} & Y\arrow{d}{g} \\
0\arrow{r} & Z
\end{tikzcd}
\]
The triangle is a \textbf{fiber} if it is a pullback square, and a \textbf{cofiber} if it is a pushout square. We say
that $f: X \to Y$ admits a fiber (resp. cofiber) when $\exists W$ (resp $Z$) such that:
\[
\begin{tikzcd}
W\arrow{r}\arrow{d} & X\arrow{d}{f} \\
0\arrow{r} & Y
\end{tikzcd}
\]
is a pullback square (or, respectively:
\[
\begin{tikzcd}
X\arrow{r}{f}\arrow{d} & Y\arrow{d} \\
0\arrow{r} & Z
\end{tikzcd}
\]
is a pushout square).

\begin{rem}
Note that the data of a triangle consists not only of homotopy commutative diagrams as above, but also of choices of 
homotopies between the branches. This is crucial, since it ensures that cones are
functorial at the level of the homotopy category. This functoriality does not hold in a general triangulated category. 
(See Theorem \ref{thm:stable_triang} for the relation between stable
$\infty$-categories and triangulated 1-categories.)
\end{rem}

\begin{eg}
Our two main examples are $\infty$-categories of spectra (see Section \ref{sect:spectra}) and of modules over a CDGA or SCR
(see Section \ref{sect:modules}).
\end{eg}

Recall the data for a triangulated category.

\begin{defin}
A category $\cD$ is triangulated if:
\begin{enumerate}
\item $\cD$ is additive;
\item \label{item:translation_equiv}
 $\cD$ admits a translation functor $T : \cD \overset{\simeq}{\to} \cD$;
\item $\cD$ has a collection of distinguished triangles:
\[
\begin{tikzcd}
X\arrow{r} & Y \arrow{r} & Z \arrow{r} & X[1]
\end{tikzcd}
\]
\end{enumerate}
This data is required to satisfy some axioms, but we won't go into details here.
\end{defin}

\begin{thm}
\label{thm:stable_triang}
If $\cC$ is a stable $\infty$-category, then $h\cC$ is triangulated.
\end{thm}

For a proof see \cite{Lurie_Higher_algebra}. We won't go over it, let's just say that translation is given by $\Sigma$,
and distinguished triangles are precisely the images of fiber sequences (or equivalently, cofiber sequences), as resulting
from the following diagram.
\[
\begin{tikzcd}
X\arrow{r}\arrow{d} & Y \arrow{r}\arrow{d} & 0\arrow{d} \\
0\arrow{r} & Z \arrow{r} & X[1]
\end{tikzcd}
\]

\begin{prop}
$\cC$ is stable iff the following hold:
\begin{enumerate}
\item $\cC$ admits finite limits and colimits;
\item any square is a pushout iff it is a pullback.
\end{enumerate}
\end{prop}
\begin{proof}
Again, we don't give a full proof. Let's just see why products and coproducts must exist in a stable $\infty$-category. 
Note first that $\Sigma$ is an equivalence of
$\infty$-categories. Indeed, $\Sigma$ is a left adjoint functor; moreover, the unit and counit of the adjunction become 
isomorphisms in the homotopy category, due to condition \ref{item:translation_equiv} in the definition of a triangulated
category. Then we use the following diagram.
\[
\begin{tikzcd}
\Omega(X)\arrow{d}\arrow{r} & 0\arrow{d}\arrow{r} & Y\arrow{d} \\
0\arrow{r} & X\arrow{r} & X \oplus Y
\end{tikzcd}
\]
We have defined $X \oplus Y$ as the cofiber of $\Omega(X) \overset{0}{\to} Y$, which is postulated to exist in a stable $\infty$
-category. This turns the outer rectangle into a pushout square, and it follows that the square on the right is also a pushout
square. Thus $X\oplus Y$ is the coproduct of $X$ and $Y$. We reason dually to obtain products.
\end{proof}

\begin{defin}
Let $\cC, \cC'$ be stable $\infty$-categories, and $F: \cC \to \cC'$ an $\infty$-functor which maps 0 objects to 0 objects. 
Equivalently, $F$ maps triangles to triangles.
If $F$ maps fiber sequences to fiber sequences, we say that $F$ is \textbf{exact}.
\end{defin}

\begin{lem}
\label{lem:exact}
TFAE:
\begin{enumerate}
\item $F$ is exact;
\item $F$ is right-exact, i.e. commutes with finite colimits;
\item $F$ is left-exact, i.e. commutes with finite limits.
\end{enumerate}
\end{lem}

This is very useful: sometimes it's really easy to check that a functor is right or left exact, e.g. if it's a left or right
adjoint, respectively.


\section{Modules}
\label{sect:modules}

For a useful example of the result in Lemma \ref{lem:exact}, we look at $\cC = A-\cM od$, where $A$ is a CDGA or SCR over $k$.
(By $A-\cM od$ we mean the unbounded derived category.) The easiest way
to see $A-\cM od$ as an $\infty$-category is to put a model structure on chain complexes, say the projective one, and then
take the underlying $\infty$-category.
We claim that $A-\cM od$ is a stable $\infty$-category. Using the theorem
Mauro talked about in Lecture 1, limits and colimits exists in the $\infty$-category iff they exist in the model category.
\todo{reference theorem} It remains to prove the following.

\begin{lem}
A triangle in $A-\cM od$ is a fiber iff it is a cofiber.
\end{lem}
\begin{proof}
We prove one direction; the other argument is dual to this one. Assume that $f:M^{\bullet} \to N^{\bullet}$ 
is the fiber of a map $g$. Take a cofibrant replacement of $f$, get $\tilde M, \tilde N$ cofibrant and a homotopy
pullback square:
\todo{figure out how to do the cartesian symbol in tikz}
\[
\begin{tikzcd}
\tilde M^{\bullet}\arrow[hook]{r}{\tilde f}\arrow{d} & \tilde N^{\bullet}\arrow{d}{\tilde g} \\
0\arrow{r}  & P^{\bullet} .
\end{tikzcd}
\]
$\tilde f$ is cofibrant, so it's a degree-wise injection. Then $g$ is a degreewise surjection, and it follows that the 
square is a strict pushout. \todo{wait, how did this work again?}
\end{proof}

Now suppose we have $f: A \to B$ a morphism of $CDGA_k^{\leq 0}$. It induces the adjunction of model categories:
\[
\begin{tikzcd}
A-Mod\arrow[shift left]{r}{f^*} & B-Mod\arrow[shift left]{l}{f_*},
\end{tikzcd}
\]
where $f_*$ is the forgetful functor, and $f^*(M) = M \otimes_A B$. So this gives an adjunction of $\infty$-categories:
\footnote{Here we use $L$ and $R$ to indicate that the functors are derived.
In later talks derived functors will be the default, and we will omit the symbols $L$ and $R$.}
\[
\begin{tikzcd}
\label{tikz:adjunction}
A-\cM od\arrow[shift left]{r}{Lf^*} & B-\cM od\arrow[shift left]{l}{Rf_*}.
\end{tikzcd}
\]
Explicitly, $Lf^*$ is constructed by first choosing a cofibrant replacement $\tilde M$ for $M$, 
and then taking $\tilde M \otimes_A B$. The
answer doesn't depend on cofibrant replacement, up to coherent isomorphism. Then $Lf^*$ is a left adjoint
functor, so it follows from general nonsense that it's right exact. Lemma \ref{lem:exact} then implies that $Lf^*$
is also left exact and exact.

\begin{rem}
\label{rem:exact_t}
If $f$ is not flat in the sense of Definition \ref{def:fav_morphisms}, then the exactness of
$Lf^*$ comes at the price of losing t-exactness. To explain what we mean, pick $M \in A-Mod$, such that
$H^i(M) = 0$ unless $i = 0$. But then $Lf^*(M) = M \otimes_A^{\bbL} B$, and $H^{-i}(M\otimes_A^{\bbL}B) = \Tor_i^A(M,B)$, which
is $\neq 0$ in general, because $f$ is not flat. So even though $M$ was homologically concentrated in degree 0, $Lf^*(M)$ may
not be. In other words, the failure of a functor of (Grothendieck) abelian categories to preserve limits translates into a lack 
of t-exactness of the derived functor. In the following section we define t-structures and t-exactness for $\infty$-categories.
\end{rem}


\section{t-structures}
\label{sect:t-struct}

\begin{defin}
If $\cC$ is a stable $\infty$-category, a \textbf{t-structure}\footnote{$t$ stands for truncation} on 
$\cC$ is the data of two full subcategories of $\cC$, $\cC^{\leq 0}$ and
$\cC^{\geq 0}$, \footnote{Note that we use cohomological notation, while Lurie in \cite{Lurie_Higher_algebra} uses homological
notation. Therefore gradings have opposite signs in this seminar and in \cite{Lurie_Higher_algebra}.} such that:

\begin{enumerate}
\item \label{item:no_morph_right}
$\pi_0 \Map_{\cC}(X,Y[-1]) = 0$ if $X \in \cC^{\leq 0}$ and $Y \in \cC^{\geq 0}$.
\footnote{In a stable $\infty$-category, we sometimes use the shift notation $[n]$ to denote the $|n|$-fold iterated application
of the $\Sigma$ functor (if $n$ is positive) or the $\Omega$ functor (if $n$ is negative). This notation is justified by
Proposition \ref{prop:stable_shift}.}

\item $X \in \cC^{\leq 0}, X[1]  \in \cC^{\leq 0}$;

\item \label{item:fiber_seq}
$\forall X$, $\exists$ fiber sequence $X' \to X \to X''$, where $X' \in \cC^{\leq 0}$, $X'' \in \cC^{\geq 1}$.
\end{enumerate}
\end{defin}

\begin{rem}
Condition \ref{item:no_morph_right} has the following intuitive meaning in the case $\cC = A-\cM od$. $0$-morphisms in 
$\cC$ are chain maps which preserve degree, while
higher morphisms are homotopies which shift the degree to the left; morphisms that shift degree to the right are not allowed.
Then, if $X \in \cC^{\leq 0}$ and $Y \in \cC^{\geq 0}$, no nonzero morphisms should be allowed between $X$ and $Y[-1]$:
\[
\begin{tikzcd}
\dots \arrow{r} & X_{-2} \arrow{r} & X_{-1} \arrow{r} & X_0 \arrow{r} & 0\arrow{r} & 0\arrow{r} & 0\arrow{r} & \dots \\
\dots \arrow{r} & 0 \arrow{r} & 0 \arrow{r} & 0 \arrow{r} & Y_0\arrow{r} & Y_1\arrow{r} & Y_2\arrow{r}  & \dots
\end{tikzcd}
\]
\end{rem}

\begin{rem}
$X'$ and $X''$ are uniquely determined by $X$.
\end{rem}

\begin{thm}
The inclusion $\cC^{\leq 0} \to \cC$ has a right adjoint, which we denote $\tau_{\leq 0} : \cC \to \cC^{\leq 0}$. Similarly
we get $\tau_{\geq 0} : \cC \to \cC^{\geq 0}$.
\end{thm}

\begin{cor}
For all $X \in \cC$, the fiber sequence of \ref{item:fiber_seq} is just:
\[	\tau_{\leq 0} X \to X \to \tau_{\geq 1} X.	\]
\end{cor}

\begin{prop}
Denote by $\cC^{\heartsuit} := \cC^{\leq 0} \cap \cC^{\geq 0}$, the \textbf{heart} or \textbf{core} of the t-structure. 
It is an abelian 1-category.
\end{prop}

\begin{prop}
\label{prop:stable_les_homology}
Let $\cC$ be stable. Then if:
\[	X \to Y \to Z	\]
is a fiber sequence, then we have a long exact sequence of $H^i$, where $H^i(X) := \tau_{\geq i} \circ \tau_{\leq i} (X)$.
\end{prop}

Putting the last few results together, from $\cC$ a presentable stable $\infty$-category with $t$-structure, the heart 
is Grothendieck abelian. Write $A = \cC^{\heartsuit}$. Then we can form $\cD(A)$, the $\infty$-derived category of $A$.
The next theorem describes the relationship between $\cC$ and $\cD(A)$.

\begin{thm}[Lurie]
$\cD(A)$ has a universal property which produces an $\infty$-functor:
\[	\cD(A) \to \cC.	\]
In general this is very far from being an equivalence.
\end{thm}

\begin{eg}
Let $A \in CDGA^{\leq 0}_k$. The theorem gives a map:
\begin{equation}
\label{eq:map_heart}
	(A-\cM od)^{\heartsuit} \to  (H^0(A)-Mod)^{\heartsuit}.
\end{equation}
This is one of the most important facts
in DAG, because it reduces problems about the $\infty$-category of $A$-modules to problems in classical categories of modules,
where one can work with generators and relations. The map in \ref{eq:map_heart} is an equivalence iff $A \simeq H^0(A)$ 
are quasi-isomorphic.\todo{figure out what's the precise relationship here}
\end{eg}

\begin{defin}
Let $\cC, \cD$ be stable $\infty$-categories with $t$-structures. Then an exact functor $F : \cC \to \cD$ is:
\begin{enumerate}
\item \textbf{left t-exact} if $F(\cC^{\leq 0}) \subset \cD^{\leq 0}$;
\item \textbf{right t-exact} if $F(\cC^{\geq 0}) \subset \cD^{\geq 0}$;
\item \textbf{t-exact} if both.
\end{enumerate}
\end{defin}

\begin{eg}
\label{eg:modules_t_exact}
For $A,B \in CDGA_k^{\leq 0}$, $f:A \to B$, we have the adjunction:
\[
\begin{tikzcd}
A-\cM od\arrow[shift left]{r}{Lf^*} & B-\cM od\arrow[shift left]{l}{Rf_*}.
\end{tikzcd}
\] 
Every object is fibrant, so we don't need to
derive the functors. $Rf_*$ is both left and right t-exact. $Lf^*$ is not right t-exact, because of nontrivial $\Tor^i$
terms; see \ref{rem:exact_t}. However, $Lf^*$ is right t-exact: 
morally speaking, Projective resolution only puts stuff in negative degrees. We give an $\infty$-categorical proof.

Pick $M \in A-Mod^{\geq 0}$. We want $Lf^*(M) \in B-Mod^{\leq 0}$. To check this is the same as checking that
$\forall N \in B-Mod^{\geq 1}$, $\Map_{B-Mod}(Lf^*M,N) \cong 0$. But this is $Map_{A-Mod}(M,Rf_*N) \cong 0$, which
follows since $Rf_*$ was t-exact.
\end{eg}


\section{Spectra}
\label{sect:spectra}

Going back to the question left unanswered in Section \ref{sect:motivation}, the extra structure we want on
morphism spaces of stable $\infty$-categories is $\Map_{\cC}(X,Y) \in \Sp^{\leq 0}$.

\begin{defin}
\textbf{Spectra} are sequences $\{F_i\}$ of objects in $\cC$ such that $F_n \simeq \Omega F_{n+1}$. Alternatively,
we identify them with objects of the homotopy limit:
\[	\dots \overset{\Omega}{\to} \cC \overset{\Omega}{\to} \cC \overset{\Omega}{\to} \dots	\]
\end{defin}

\begin{rem}
We must be careful with defining morphisms between spectra: we want squares to commute up to coherent homotopy.
Moreover, it's hard to get a monoidal model structure on the category of spectra: this was done only in the 2000s, after Hovey 
introduced symmetric spectra. Lurie has a very categorical and very nice way of putting a monoidal structure 
at the level of the $\infty$-category
directly. See the last chapter of \cite{groth}, and also 4.8.2 of \cite{Lurie_Higher_algebra}.
\end{rem}

\begin{thm}
$Sp(\cC)$ is stable.
\end{thm}

This gives a canonical stabilization for every $\infty$-category. The proof of the theorem follows from the following characterization
of stable $\infty$-categories,
and the fact that $\Omega:Sp(\cC) \to Sp(\cC)$ is an equivalence.

\begin{prop}
\label{prop:stable_shift}
$\cC$ is a pointed $\infty$-category. TFAE:
\begin{enumerate}
\item $\cC$ is stable;
\item $\cC$ admits colimits and $\Sigma : \cC \to \cC$ is an equivalence;
\item $\cC$ admits limits and $\Omega : \cC \to \cC$ is an equivalence;
\end{enumerate}
\end{prop}

%\begin{thm}
%Let $K$ be a simplicial set, and $F : K \to \cC at_{\infty}$. These correspond to cartesian fibrations, by HTT chapter 3,
%as explained by Mauro in the first lecture. We find a cartesian fibration $\mathscr{P} : \mathscr{X} \to K$.
%\todo{insert diagram}
%We have $\N \to \Cat_{\infty}$, we associate $\mathscr{X} \overset{\mathscr{P}}{\to} \N$. Look at section $s
%: \N \to \mathscr{X}$. $n \to m$ goes to:\todo{complete the diagram}
%\[
%\begin{tikzcd}
%s(n)\arrow{d}\arrow{r} & s(m)\arrow{d} \\
%n \arrow{r} & m
%\end{tikzcd}
%\]
%Thus we get a cocartesian fibration. Conclusion: let $\cD$ be the full subcategory of $\Map_{/K}(K,\mathscr{X})$ 
%spanned by cocartesian sections. Then
%$\cD$ is equivalent to $invlim_{\cC at_{\infty}} K$. In Theorem 3.3.3.1 of \cite{HTT}, Lurie has $\cD = \Map^{\flat}_{K^{\sharp}}
%(K^{\sharp}, \mathscr{X}^{fillthisinhere})$.
%\end{thm}

%Upshot: we need $sSet^+_{/K}$, where some collection of arrows is marked. We think of the marked ones as the ones which
%will become cocartesian.
%\[	sSet^+ = \{ (L,S) | L \in sSet, S\subset \Fun(\Delta^1, L), S \text{ contains the identities }\}	\]
%We have two functors $sSet \to sSet^+$. One is $K \mapsto K^{\flat} = (K, \text{identities})$. The other is
%$K \mapsto (K,\text{all morphisms}) = K^{\sharp}$. $\mathscr{P} : \mathscr{X} \to K$ cartesian, so
%$\mathscr{X}^{fillthisin} = (\mathscr{X}, \text{p-cartesian edges})$.

%We have an adjunction $Forget: sSet^+ \to sSet_{Joyal} : (-)^{\sharp}$. What is $L(Forget)$? Cocartesian morphisms
%over a point are just equivalences. So $L(Forget)$ is $\infty$-categorical localization.






\chapter{The Cotangent Complex}
Talk by Sukjoo Lee.

\section{Motivation}
\label{sect:cc_motivation}

We recall from classical AG: if $f:A \to B$ is a homomorphism between commutative rings and $M$ is a $B$-module, 
an A-\textbf{derivation} of $B$ into $M$ is a map $d : B \to M$ such that:
\begin{itemize}
\item $d\big( f(a)\big) = 0$, for all $a\in A$;
\item $d(bb') = db\; b' + b\; db'$ (Leibniz rule).
\end{itemize}
We denote by $Der_A(B,M)$ the set of all derivations of $B$ into $M$. There is also an absolute version, where
we take $f:0 \to A$, and the first condition is automatic.

\begin{defin}
The \textbf{module of relative K\"ahler differentials} of $B$ over $A$ is a derivation $(\Omega^{1}_{B/A}, d_A)$ 
over $A$ satisfying the universal property:
\[
\begin{tikzcd}
B \arrow{r}{d_A}\arrow[swap]{rd}{d'} & \Omega^1_{B/A}\arrow[dotted]{d}{\exists !} \\
 & M.
\end{tikzcd}
\]
Equivalently, $\Hom_{B-Mod}(\Omega^1_{B/A}, M) \simeq Der_A(B,M)$. (+ absolute version).
\end{defin}

\begin{prop}
If $A \to B \to C$ is a sequence of maps of commutative rings, then the following sequence of $C$-modules is exact:
\begin{equation}
\label{eq:ses_omegas}
	\Omega^1_{B/A} \otimes_B C \to \Omega^1_{C/A} \to \Omega^1_{C/B} \to 0.
\end{equation}
\end{prop}

One of the goals for this talk is to extend the sequence to the left. If $CRing$ was an Abelian category, we would
attempt to derive the functor $\Omega^1$; however, this is not the case. Instead, what we do is generalize the notion of
K\"ahler differential to the $\infty$-categorical setting, and show that this gives an extension to the left of the sequence
\ref{eq:ses_omegas}. Slogan: ``$\infty$-category theory allows us to do derived functors in a non-linear setting''. 



\section{Generalization and definition}
\label{sect:cc_def}

Note that generalizing the Leibniz rule to the $\infty$-category setting is hard, because we'd have to replace the 
equality with a homotopy.
Instead, consider the following idea. For a ring homomorphism $\phi : A \to B$, we want a new homomorphism $\phi': A \to B$ 
``sufficiently close'' to $\phi$. For example, take $I \subset B$ an ideal
with $I^2 = 0$. Then ``sufficiently close'' means that $\phi' : A \to B$ is congruent to $\phi$ modulo $I$, i.e.:
\[	\forall\; a \in A,\; \phi(a) - \phi'(a) \in I.	\]
For a fixed $\phi$, we have a bijective correspondence:
\begin{equation}
\label{eq:corresp_derivations}
\left\{ \begin{array} {c} \phi': A \to B \text{ such that} \\ \phi' \equiv \phi \text{ mod } I \end{array} \right\}
\longleftrightarrow
\left\{ \begin{array} {c} d: A \to I \text{ satisfying} \\ \text{the Leibniz rule} \end{array} \right\} .
\end{equation}


If $M$ an $A$-module, take $B := A \oplus M$ equipped with 
the ring structure such that $M^2 = 0$:
\[	(a_1, m_1) (a_2,m_2) = (a_1 a_2, a_1 \dot m_2 + a_2\dot m_1).	\]
We fix $\phi : A \to B$ the natural inclusion of $A$ into the coproduct (as abelian groups); with the given ring structure,
$\phi$ is also a ring homomorphism. Take the ideal $I = M$. Then the correspondence \ref{eq:corresp_derivations} becomes:
\begin{equation}
\label{eq:derivations_classical}
\Map_{/A}(A, A\oplus M) \cong Der(A,M).
\end{equation}


This is something we can generalize. We work with $A \in SCR_k$, and the category of $A-\cM od$; all categories in the rest of
the talk are $\infty$-categories. Take $M \in A-\cM od$ and construct $A \oplus M$, whose underlying simplicial set is the
coproduct, and whose ring structure is defined levelwise (see \cite{HAG-II}, 1.2.1.1 for details).

We adapt equation \ref{eq:derivations_classical} to this setting, by defining:
\[	\cD er(A,M) = \Map_{/A}(A,A\oplus M) \in \cS.	\]
Moving from the absolute version of derivations to the relative one, for $f : A \to B$ in $SCR_k$ and $M \in B-\cM od$, we 
define: 
\[	\cD er_A (B,M) = \Map_{A-Alg/B}(B, B\oplus M)\in \cS.	\]


We obtain functors $\cD er(A,-) : A-Mod \to \cS$ and $\cD er_A(B,-) : B-Mod \to \cS$. We claim that these functors are corepresentable,
and call the corepresenting objects the \textbf{absolute cotangent complex} $\bbL_A$ and \textbf{relative cotangent complex}
$\bbL_{B/A}$, respectively. Equivalently, this means:
\begin{align*}
\Map_{A-Mod}(\bbL_{A}, M) &\cong \Map_{/A}(A, A\oplus M), \\
\Map_{B-Mod}(\bbL_{B/A}, M) &\cong \Map_{A-Alg/B}(B, B\oplus M).
\end{align*}

The proof of corepresentability relies on the following lemma.
\begin{lem}
\item $Der_A(B,-)$ and $Der(A,-)$ commute with limits and $K$-filtered colimits.\footnote{
$\omega$-filtered would mean that the representing guy can be given by presentation with gen and relation. Otherwise we just
mean for everything strictly less than cardinality $K$, which could be continuum or more.} \todo{explain the footnote better}
\end{lem}

Then the result follows by Theorem 5.5.2.7 in \cite{HTT}, which we reproduce here.\footnote{Related to this is the Adjoint
Functor Theorem 5.5.2.9, which is one of the most important theorems in $\infty$-category theory. It's also the reason
we love presentable $\infty$-categories.}

\begin{thm}
Let $\cC$ be a presentable $\infty$-category and $F : \cC \to \cS$ a functor. Then $F$ is corepresentable by an object of
$\cC$ if and only if $F$ preserves $K$-filtered colimits and all small limits.
\end{thm}

\begin{rem}
Note that preserving small limits is obviously necessary in order to be corepresentable, since $\Hom$ is a right adjoint,
and thus preserves small limits.\todo{think more about the small hypothesis} Let's explain this in more detail
for 1-category theory. We have the diagram:
\[
\begin{tikzcd}
A-Mod \arrow{r}{\simeq} & Ab(CRing_{/A})\arrow{d}{\text{forget}} & \\
 & CRing_{/A} \arrow{r}{\Hom(A, -)} & Set .
\end{tikzcd}
\]
The equivalence on the first line works by sending an $A$-module $M$ to $A \oplus M$, and a ring $B$ over $A$ to the kernel
of $B \to A$. \todo{finish this}

For $\infty$-category theory, the relevant diagram is:
\[
\begin{tikzcd}
A-\cM od \arrow{r}{\simeq} & \cS p(SCR_{/A})\arrow{d}{\text{forget}} & \\
 & SCR_{/A} \arrow{r}{\Map_{/A}(A, -)} & \cS .
\end{tikzcd}
\]
The reference for this is \cite{Lurie_Higher_algebra}, section 7.4.\todo{wait, where exactly? can't find it}
\end{rem}


In \cite{HAG-II}, Chapter 1, we find an explicit (although not useful in practice, according to Mauro) model 
for $\bbL_A$. Take a simplicial resolution $\tilde A \to A$, which is also a cofibrant replacement. Then we have:
\[	 \Omega_{\tilde A}^1 \otimes^{\bbL}_{\tilde A} A \in A-Mod	\]
is a model for $\bbL$, where the complex $\Omega_{\tilde A}^1$ is build by taking K\"ahler differentials degree-wise:
\[	(\Omega_{\tilde A}^1)_{\bullet} := \Omega^1_{\tilde A_{\bullet}}.	\]





\section{Examples and Properties}
\label{sect:cc_eg}

In this section we compute $\bbL_{k[x]/k}$ and $\bbL_{k/k[x]}$, where $x$ is in degree -1, as opposed to 1, by our 
cohomological convention. (See remark \ref{rem:degree_convention} for what this implies; $k[x]$ is not what it seems.)
In the process we go over some of the properties of cotangent complexes.

\begin{lem}
Let $A \in SCR_k$ and $M \in A-\cM od$. The cotangent complex of $f: A \to \Sym_A M$ is:
\[	\bbL_{\Sym_A M /A}\cong M \otimes^{\bbL}_A \Sym_A M .	\]
\end{lem}
\begin{proof}
For all $\Sym_A M$-module $N$,
\begin{align*}
	\Map_{\Sym_A M -\cM od}(\bbL_{\Sym_A M/A}, N) &\cong \Map_{A-\cM od}(\Sym, \Sym\oplus N ) \cong \Map_{A-\cM od}(M, f_* N) \\
&\cong \Map_{\Sym_A M - \cM od}(M \otimes^{\bbL}_A \Sym_A M ,N).
\end{align*}
Here the first equivalence is definitional, the second follows from the universal property of $\Sym_A M$, and the third is
the adjunction \ref{tikz:adjunction}.
\end{proof}

For our first example, note that $k[x] \cong \Sym_k(k[1])$. Then the answer is $k[1] \otimes^{\bbL}_k k[x]$, which is just 
$k[x]$ concentrated in degree $-1$.

\begin{rem}
\label{rem:degree_convention}
Note that, since $k[1]$ is concentrated in degree $-1$, so is $\Sym_k(k[1])$; it does not have information in all 
nonnegative degrees, as the notation may mislead one into thinking. We just get a copy of $k$ in degree 0 and one
in degree -1,
and this is what we call $k[x]$. This is because multiplication in the symmetric algebra is graded commutative:
\[	x y = (-1)^{|x||y|} yx,	\]
so in particular for $x$ of degree 1 we get $x^2 = -x^2 = 0$. If we started with $k[2]$ instead,
$\Sym_k(k[2])$ would be nontrivial in all negative even degrees and commutative in the classical sense. More generally, 
$\Sym(k[n])$ gives what we would classically
call a symmetric algebra if $n$ is even, or an alternating algebra if $n$ is odd.
\end{rem}

Some properties of cotangent complex:
\begin{prop}
\;
\begin{enumerate}
\item For $A \to B \to C$ in $SCR_k$, there is a homotpy cofiber sequence in $C-Mod$:
\[	\bbL_{B/A} \otimes^{\bbL}_B C \to \bbL_{C/A} \to \bbL_{C/B}.	\]
\item Base change: given a homotopy pullback square
\[
\begin{tikzcd}
A\arrow{r}\arrow{d} & B\arrow{d} \\
A'\arrow{r} & B',
\end{tikzcd}
\]
there is an equivalence $\bbL_{B/A} \otimes^{\bbL}_B B' \simeq \bbL_{B'/A'}$.
\end{enumerate}
\end{prop}

To compute $\bbL_{k/k[x]}$, use the cofiber sequence associated to the sequence of maps $k \to k[x] \to k$. We get the
cofiber sequence in $k-\cM od$:
\begin{equation}
\label{eq:cofiber_poly}
	\bbL_{k[x]/k} \otimes^{\bbL}_{k[x]} k \to \bbL_{k/k} \to \bbL_{k/k[x]}.
\end{equation}
By our previous computation, the first term is:
\[ \bbL_{k[x]/k} \otimes^{\bbL}_{k[x]} k \simeq k[1] \otimes_k^{\bbL} k[x] \otimes^{\bbL}_{k[x]} k \simeq k[1].	\]
(Using associativity for derived tensor product.) The second term in \ref{eq:cofiber_poly} is 0, so the cofiber sequence
is actually a suspension diagram. 
\[
\begin{tikzcd}
k[1]\arrow{r}\arrow{d} & 0\arrow{d} \\
0\arrow{r} & \bbL_{k/k[x]}
\end{tikzcd}
\]
Then $\bbL_{k/k[x]}\simeq k[2]$. 
%That this is consistent with our intuition from the classical case: 
%if, to begin with, $k$ is in degree 0 to begin with, and
%$\bbL_{k/k[x]} = k[1]$, concentrated in degree -1. It's great that it doesn't have anything in degree 0, since Kahler differentials
%of a closed immersion are 0.

Going back to Section \ref{sect:cc_motivation}, we complete the exact sequence \ref{eq:ses_omegas} on the left. 
Using stability of $C-\cM od$, the cofiber sequence gives a long exact sequence on homology (recall proposition
\ref{prop:stable_les_homology}; in particular, $H^i(X) = \tau^{\geq i} \circ \tau^{\leq i}(X)$).
\[
\begin{tikzpicture}[descr/.style={fill=white,inner sep=1.5pt}]
\label{tikz:les}
        \matrix (m) [
            matrix of math nodes,
            row sep=1em,
            column sep=2.5em,
            text height=1.5ex, text depth=0.25ex
        ]
        { \dots & H^{-1}(\bbL_{B/A} \otimes^{\bbL}_{B} C) & H^{-1}(\bbL_{C/A}) & H^{-1}(\bbL_{C/B}) & \\
            & H^0(\bbL_{B/A} \otimes^{\bbL}_{B} C) & H^0(\bbL_{C/A}) & H^0(\bbL_{C/B}) & \\
            & H^1(\bbL_{B/A} \otimes^{\bbL}_{B} C) & H^1(\bbL_{C/A}) & H^1(\bbL_{C/B}) & \dots \\
        };

        \path[overlay,->, font=\scriptsize,>=latex]
        (m-1-1) edge (m-1-2)
        (m-1-2) edge (m-1-3)
        (m-1-3) edge (m-1-4)
        (m-1-4) edge[out=350,in=170]  (m-2-2)
        (m-2-2) edge (m-2-3)
        (m-2-3) edge (m-2-4)
        (m-2-4) edge[out=350,in=170]  (m-3-2)
        (m-3-2) edge (m-3-3)
        (m-3-3) edge (m-3-4)
				(m-3-4) edge (m-3-5);
\end{tikzpicture}
\]
We claim that:
\begin{enumerate}
\item \label{item:h0_underived}
\textit{For underived rings}, $H^i(\bbL_{B/A}) = 0$ if $i>0$;
\item \textit{For underived rings}, $H^0(\bbL_{B/A}) \simeq \Omega^1_{B/A}$;
\item \textit{In general}, $H^0(\bbL_{B/A}) \simeq \Omega^1_{\pi_0(B)/\pi_0(A)}$.
\end{enumerate}
An application of these facts is the desired extension
to the left of the sequence \ref{eq:ses_omegas}. The facts are proved in \cite{Lurie_Higher_algebra}, section 7.4.3. 
We will say more about claim \ref{item:h0_underived}, but first we need to talk about connectivity. 



\section{Connectivity}
\label{sect:cc_connectivity}

\begin{defin}
A space $X$ is \textbf{n-connective} if $\pi_i(X,x) = 0$ for all $x \in X$ and $i<n$. We say $X$ is \textbf{connective}
if it's 0-connective, \textbf{connected} if it's 1-connective. $f:X \to Y$ is \textbf{n-connective} if fiber$(f)$ is n-connective.
\end{defin}

The following is in \cite{Lurie_Higher_algebra}, 7.4.3.2, and it's VERY important.
\begin{thm}[Connectivity estimate]
\label{thm:connectivity_estimate}
Assume $f : A \to B$ is a map in $SCR_k$ and cofib$(f)$ is $n$-connective. Then there exists a map:
\[	\mathcal{E}_f: B \otimes_A^{\bbL} Cofib(f) \to \bbL_{B/A}	\]
in $B-Mod$, which is $2n$-connective.
\end{thm}

\begin{rem}
The proof is not hard; the only difficulty is constructing the map, which we can do after we learn Postnikov towers.
\todo{reference once we have the postnikov notes}
\end{rem}

\begin{cor}
The hypothesis of Theorem \ref{thm:connectivity_estimate} implies $\bbL_{B/A}$ is $n$-connective.
\end{cor}
\begin{proof}
We look at the fiber sequence:
\[	fib(\mathcal{E}_f) \to B\otimes^{\bbL}_A cofib(f) \to \bbL_{B/A},	\]
and get a long exact sequence of homotopy groups. So it suffices to show that:
\begin{enumerate}
\item \label{item:cofiber_connective}
 $B\otimes_A^{\bbL} Cofib(f)$ is $n$-connective;
\item \label{item:epsilon_connective}
$fib(\mathcal{E}_f)$ is $n-1$-connective.
\end{enumerate}
\ref{item:epsilon_connective} is implied by Theorem \ref{thm:connectivity_estimate}; note that theorem is actually considerably
stronger. Property \ref{item:cofiber_connective} is proved in \cite{Sq0}. The proof there uses a spectral sequence due to 
Quillen: for $M,N \in A-Mod$, $A \in SCR_k$,
\[	\Tor_p^{\pi_q(A)}(\pi_qM, \pi_qN) \Longrightarrow \pi_{p+q}(M \otimes^{\bbL}_A N).	\]
\end{proof}

\begin{rem}
In particular, cotangent complexes are 0-connective for commutative rings. This gives a proof of fact
\ref{item:h0_underived} at the end of the previous section.
\end{rem}

\begin{cor}
For $A \in SCR_k$, $\bbL_A$ is 1-connective. Moreover, $f:A \to \pi_0(A)$ is 1-connective, so $\bbL_{\pi_0(A)/A}$ is
1-connective.
\end{cor}

The most important corollary:
\begin{cor}
$f: A \to B$ is an equivalence iff $\pi_0(f) : \pi_0(A) \to \pi_0(B)$ is and $\bbL_{B/A} \simeq 0$. One direction obvious, the
other comes from the fact that $\bbL_{B/A}$ is $n$-connected for all $n$.
\end{cor}

\begin{rem}
Slogan: ``DAG = classical AG + DDT''.
Lurie's representability theorm is a great example of the philosophy: it says that a derived stack is representable iff
its truncation is representable and its cotangent complex is nice enough. We won't get to see this in the seminar, since we'll
change course towards structured DAG instead.
\end{rem}


\begin{rem}
Cotangent complexes we glue for free, which was not possible before $\infty$-categories. This allows to reduce many questions
to the affine setting, where we may have to do actual computations if things go wrong.
\end{rem}

We have one talk on Postnikov tower, and one on perfect complexes, then we leave the affine setting forever.

\todo{look at last 2 exercises from stable $\infty$-category}







\chapter{Square Zero Extensions}
Talk by Matei Ionita.

\section{Square Zero Extensions}
\label{sect:sq0_sq0}

Recall that, given $A \in cdga^{\leq 0}_k$ and $M \in A-\cM od$, we defined derivations from $A$ into $M$ as:
\[	\cD er_k(A,M) = \Map_{A-\cA lg / k} (A, A \oplus M) .	\]
Alternatively, these are the same as sections of the projection map $A \oplus M \to A$. Morally speaking, we'd
like to define square-zero extensions as homotopy fibers of derivations, i.e. $f: A^{\eta} \to A$ is a square-zero
extension of $A$ by $M$ if there is a homotopy pullback square:
\[
\begin{tikzcd}
A^{\eta}\arrow{r}{f}\arrow{d} & A\arrow{d}{d_{\eta}} \\
0\arrow{r} & M[1].
\end{tikzcd}
\]
The problem is that the above diagram doesn't make sense, because a derivation is not a morphism in $cdga^{\leq 0}_k$.
In section 7.4.1 of \cite{Lurie_Higher_algebra}, Lurie addresses this by using the category of tangent 
correspondences, which acts
like a ``tangent bundle'' of the category $cdga^{\leq 0}_k$, with $A-\cM od$ acting as the tangent space 
$T_A cdga^{\leq 0}_k$. In this new category
the diagram makes sense. However, we don't introduce all this technology here, and instead translate Lurie's (more general)
definition of square zero extensions into a more accessible version.

\begin{defin}
\label{defin:sq0}
A map $\tilde f: \tilde A \to A$ is a \textbf{square-zero extension} of $A$ by $M$ if it's equivalent in the category
$cdga^{\leq 0}_{/A}$ to a map $f: A^{\eta} \to A$ such that there is a homotopy pullback diagram in $cdga^{\leq 0}_k$:
\[
\begin{tikzcd}
A^{\eta}\arrow{r}{f} \arrow{d} & A\arrow{d}{d_{\eta}} \\
A\arrow{r}{d_0} & A \oplus M[1].
\end{tikzcd}
\]
Here $d_0$ is the zero derivation.
\end{defin}

\begin{rem}
We explain why the shift by 1 is necessary in definition \ref{defin:sq0}, by studying the split square-zero extension.
We claim that, with the shift in place, the following diagram is a homotopy pullback.\todo{replace with better explanation}
\[
\begin{tikzcd}
A \oplus M \arrow{r}\arrow{d} & A\arrow{d} \\
A\arrow{r} & A\oplus M[1] 
\end{tikzcd}
\]
To see this, extend the diagram by considering the map $0 \to A$, and the resulting pullback square in the category
$A-\cM od$:
\[
\begin{tikzcd}
M\arrow{r}\arrow{d} & A \oplus M \arrow{r}\arrow{d} & A\arrow{d} \\
0\arrow{r} & A\arrow{r} & A\oplus M[1] .
\end{tikzcd}
\]
Indeed, the vertical map $A\oplus M \to A$ is surjective, hence a fibration in $A-\cM od$, and then the naive pullback $M$ 
is a homotopy pullback. Moreover, the outer square is also a homotopy pullback in $A-\cM od$, because it's equivalent to:
\[
\begin{tikzcd}
M\arrow{r}\arrow{d} & 0\arrow{d} \\
0\arrow{r} & M[1].
\end{tikzcd}
\]
It follows that the square on the right is a homotopy pullback in $A-\cM od$. But all maps in this square are maps of
$A$-algebras, so we claim that the square is actually a homotopy pullback in $A-\cA lg$.
\end{rem}

\begin{rem}
Definition \ref{defin:sq0} is easy and clean, but it is hard to see whether a given map satisfies it. For example, if
$A \to B$ is a square zero extension of commutative rings by a $B$-module $M$, in the classical sense, the shift
$M[1]$ makes us leave the classical category of modules. Moreover, it's hard to prove that the given map $A \to B$
comes from the fiber product structure of $A$.
\end{rem}

We would like to construct a functor $\Phi : \cD er (A,M) \to \Fun(\Delta^1, cdga^{\leq 0}_k)$ whose essential image are the square-zero
extensions. Morally speaking, $\Phi$ sends $d_{\eta} : A \to A \oplus M$ to its homotopy fiber. The rest of this section makes
this construction precise.

\begin{defin}
The $\infty$-category $\cD er_A$ of \textbf{derivations of A} has objects derivations $d : A \to M$ and spaces of morphisms
$\cD er_A(M_1, M_2) = A-\cM od_{/A}(M_1,M_2)$. The $\infty$-category $ \tilde \cD er_A$ of \textbf{extended derivations of A}
has objects consisting of homotopy pullback squares:
\[
\begin{tikzcd}
A^{\eta}\arrow{r}{f} \arrow{d} & A\arrow{d}{d_{\eta}} \\
A\arrow{r}{d_0} & A \oplus M,
\end{tikzcd}
\]
and spaces of morphisms consisting of morphisms of squares.
\end{defin}

Note that $\tilde \cD er_A$ can be described as the full $\infty$-subcategory of $\Fun(\Delta^1 \times \Delta^1, cdga^{\leq 0}_{/A})$
whose objects are homotopy pullback squares and have prescribed restrictions: $F(\{0,0\}) = A$ and $F(\{1\}\times \Delta_1) = 
d_0 : A \to A\oplus M$.

There are two functors $F_1, F_2 : \tilde \cD er_A : \Fun(\Delta^1, cdga^{\leq 0}_{/A})$ obtained by restricting to $\Delta_1 \times \{1\}$
and $\{0\} \times \Delta^1$, respectively. Note that their essential images are A-derivations and square-zero extensions of $A$,
respectively, so that we have:
\[
\begin{tikzcd}
\; & \tilde \cD er_A \arrow[swap]{ld}{F_1}\arrow{rd}{F_2} & \\
\cD er_A & & \Fun(\Delta_1, cdga_{/A}).
\end{tikzcd}
\]
We prove that $F_1$ is a trivial Kan fibration, which implies that it has a section $s$. This will allow us to define
$\Phi = F_2 \circ s$.

\begin{lem}
$F_1$ is a trivial Kan fibration.
\end{lem}
\begin{proof}
Consider the decomposition:
\[
\begin{tikzcd}
\Fun(\Delta^1 \times \Delta^1, cdga_{/A})\arrow{rr}{R}\arrow{rd}{R_1} & & \Fun(\Delta^1 \times \{1\}, cdga_{/A}) \\
& \Fun(\Lambda^2_2, cdga_{/A})\arrow{ur}{R_2} & 
\end{tikzcd}
\]
$F_1$ is the restriction of $R$ to $\tilde \cD er_A$. Then we have:
\begin{enumerate}
\item Using Proposition 4.3.2.15 in \cite{HTT}, a restriction functor $\Fun(\cC, \cD) \to \Fun(\cC_0, \cD)$ is a trivial
Kan fibration as long as all functors in $\Fun(\cC, \cD)$ are Kan extensions of those in $\Fun(\cC_0, \cD)$. We apply this twice.
\item The pullback squares in $\Fun(\Delta^1 \times \Delta^1, cdga^{\leq 0}_{/A})$ are Kan extensions, because all limits are Kan
extensions. It follows that $R_1|_{\tilde \cD er_A}$ is a trivial Kan fibration.
\item $R_1(\tilde \cD er_A)$, the images of extended derivations in $\Fun(\Lambda^2_2, cdga^{\leq 0}_{/A})$, are left Kan extensions.
It follows that $R_2$ restricted to the images of extended derivations is a trivial Kan fibration.
\end{enumerate}
\end{proof}

Then we invoke the theorem saying that every trivial Kan fibration has a section \todo{reference this}, and define
$\Phi = F_2 \circ s$.




\section{n-small extensions}
\label{sect:sq0_nsmall}

Let $f: A \to B$ be a map in $cdga^{\leq 0}_k$, and let $I = \textbf{hofib}(f)$. In other words, $I$ is the homotopy pullback of
the following diagram of non-unital commutative monoid objects in $A-\cM od$:
\[
\begin{tikzcd}
I\arrow{r}\arrow{d} & A\arrow{d}{f} \\
0 \arrow{r} & B.
\end{tikzcd}
\]
This induces a non-unital commutative monoid structure on $I$; in particular, $I$ is an $A$-module, and
there is a multiplication map $I \otimes_A I \to I$. The following is proposition 7.4.1.14. in \cite{Lurie_Higher_algebra}.

\begin{prop}
\label{prop:mult_nullhomotopic}
The multiplication map $I \otimes_{A^{\eta}} I \to I$ is nullhomotopic.
\end{prop}


This motivates our definition of n-small extensions.
The following definition and remarks are 7.4.1.18-7.4.1.21 in
\cite{Lurie_Higher_algebra}.

\begin{defin}
Let $f : A \to B$ be a map in $cdga_k^{\leq 0}$, and let $n\geq 0$. We say that $f$ is an \textbf{n-connective extension}
if $hofib(f) \in cdga_k^{\leq -n}$. We say that $f$ is an \textbf{n-small extension} if it is an n-connective extension and,
moreover:
\begin{enumerate}
\item \label{item:mult_nullhomotopic}
$hofib(f) \in cdga_k^{\geq -2n}$;
\item the multiplication map $hofib(f) \otimes hofib(f) \to hofib(f)$ is nullhomotopic.
\end{enumerate}
\end{defin}

\begin{rem}
If $f:A \to B$ is an n-connective extension, from the long exact sequence on homotopy groups we see that 
$\pi_0(A) \to \pi_0(B)$ is surjective.
\end{rem}

\begin{rem}
Suppose that $f:A \to B$ is an n-connective extension with $hofib(f) \in cdga_k^{\geq -2n}$. Since $hofib(f) \in cdga_k^{\leq -n}$,
we also have that $hofib(f) \otimes hofib(f) \in cdga_k^{\leq -2n}$. It follows that, at the level of homotopy groups,
the only potentially nonzero map is:
\begin{equation}
\label{eq:pi2n_vanish}
	\pi_{2n}\big(hofib(f) \otimes hofib(f)\big) \to \pi_{2n}\big(hofib(f)\big).
\end{equation}
Therefore condition \ref{item:mult_nullhomotopic} in the definition of an n-small extension simply requires that the map
\ref{eq:pi2n_vanish} is 0.
\end{rem}

\begin{eg}
Let $A$ be a commutative ring, which we regard as a discrete commutative dga. A map $\tilde A \to A$ in $cdga_k^{\leq 0}$
is a 0-small extension if and only if:
\begin{enumerate}
\item $\tilde A$ is also discrete;
\item $f: \tilde A \to A$ is a surjective commutative ring homomorphism;
\item if $I$ is the kernel of $f$, then $I^2 = 0$, as a consequence of \ref{eq:pi2n_vanish}.
\end{enumerate}
So we recover the square-zero extensions in classical AG.
\end{eg}

We want to prove that all n-small extensions are square-zero extensions. (But not vice-versa!) First, we identify
what n-smallness should correspond to in terms of derivations. It's what you'd expect.

\begin{defin}
Let $\cD er_{\text{n-con}}(A)$ denote the full subcategory of derivations $\eta : A \to M[1]$ such that $M \in A-\cM od^{\leq -n}$.
Let $\cD er_{\text{n-sm}}(A)$ denote the full subcategory of derivations $\eta : A \to M[1]$ such that 
$M \in A-\cM od^{\leq -n} \cap A-\cM od^{\geq -2n}$.
\end{defin}

The following is Theorem 7.4.1.23 in \cite{Lurie_Higher_algebra}, and is the main result of this talk.

\begin{thm}
Let $\Phi : \cD er(A) \to \Fun(\Delta^1, cdga_k^{\leq 0})$ be the functor constructed in section \ref{sect:sq0_fib}. For
each $n\geq 0$, it induces an equivalence of categories:
\[	\Phi_{\text{n-sm}} : \cD er_{\text{n-sm}} \to \Fun_{\text{n-sm}}(\Delta^1, cdga_k^{\leq 0}).	\]
\end{thm}

\begin{proof}
We just give a sketch. First, note that for a derivation $d_\eta : A \to A \oplus M[1]$, there is an equivalence
between the homotopy fiber of the square-zero extension $A^{\eta} \to A$ and $M$. Moreover, multiplication on
the fiber of a square-zero extension is nullhomotopic, by Proposition \ref{prop:mult_nullhomotopic}.
 It follows that the functor $\Phi$ restricts indeed to a functor
$\Phi_{\text{n-sm}} : \cD er_{\text{n-sm}} \to \Fun_{\text{n-sm}}(\Delta^1, cdga_k^{\leq 0})$. 

$\Phi$ admits a left adjoint $\Psi$, which sends a square-zero extension $A^{\eta} \to A$ to the derivation classified
by $\bbL_A \to \bbL_{A/A^{\eta}}$. This restricts to a left adjoint of $\Phi_{\text{n-conn}}$, but we need to truncate in
order to get an adjoint $\tau \circ \Psi_{\text{n-conn}}$ for $\Phi_{\text{n-sm}}$. Then we prove that this adjoint pair
is an equivalence.
\end{proof}


\begin{cor}
Every n-small extension is a square-zero extension.
\end{cor}

\begin{cor}
Let $A \in cdga_k^{\leq 0}$, then every map in the Postnikov tower:
\[	\dots \to \tau^{\geq -2}(A) \to \tau^{\geq -1}(A) \to \tau^{\geq 0} (A) 	\]
is a square-zero extension.
\end{cor}

This is because the n-th stage is obviously an n-small extension, the homotopy fiber being equal to $\pi_{n}(A)[n]$ 
concentrated in degree $n$.  This corollary is highly important, as it allows statements about derived affines $A$ to be proved
by induction on the Postnikov tower. The base step, for $\pi_0(A)$, is a classical AG statement, which is proved by classical
methods. The inductive step reduces to a linear problem involving the derivation
associated to the square-zero extension $\tau^{\geq i}(A) \to \tau^{\geq i-1}(A)$. The next section exemplifies this
philosophy.




\section{Induction on Postnikov tower}
\label{sect:sq0_induction}

\begin{prop}
Let $A\in sCA_{k}$, Assume we are given $j:\Spec(\pi_{0}(A))\to \mathbb{A}^{n}$, then there exists a lift 
of the map $j$ to a map $\Spec(A)\rightarrow \mathbb{A}^{n}$.
\end{prop}

\begin{proof}
We use induction on the Postnikov tower. Suppose that there is a map $j_{n}: Spec(\tau^{\leq n}A)\rightarrow 
\mathbb{A}^{n}$, we show that there is a lifting $j_{n+1}$ from $Spec(\tau^{\leq n+1}A)$ to $\mathbb{A}^{n}$.  
If we can prove this then as $A=lim(\tau^{\leq n}A)$ and there thus exists a lifting of the map $j$ to a map 
from $Spec(A)$. 

We show how this works for the first stage, the construction of $j_1 : \Spec(\tau^{\leq 1}(A)) \to \bbA^n$.
\[
\begin{tikzcd}
\label{tikz:postnikov_pullback}
k[x_1, \dots, k_n]\arrow{drr}{j}\arrow[swap]{ddr}{j}\arrow[dashed]{dr} & & & \\
 & \tau^{1}(A)\arrow{r}\arrow{d} & \pi_0(A)\arrow{d}{d_{\eta}}\arrow[bend left]{ddr}{=} & \\
 & \pi_0(A)\arrow[swap, bend right]{drr}{=} \arrow{r}{d_0} & \pi_0(A) \oplus \pi_1(A)[2]\arrow{dr}{p} & \\
 & & & \pi_0(A) .
\end{tikzcd}
\]

In order to invoke the universal property of the homotopy pullback, we need a homotopy between two maps
$k[x_1, \dots, k_n] \to \pi_0(A) \oplus \pi_1(A)[2]$:
\[	d_{\eta} \circ j \cong d_{0} \circ j.	\]
It suffices to show that this homotopy exists, i.e. that the space $X$ of such homotopies is nonempty. However,
we will accomplish more: we find the homotopy type of $X$, which allows us to comment on the (non-)uniqueness
of the lift $j_1$. Note that, in an $\infty$-category, the derivations $d_0$ and $d_{\eta}$ come with the data which expresses
them as sections of the projection $p:\pi_0(A) \oplus \pi_1(A)[2] \to \pi_0(A)$, i.e. homotopies $p\circ d_0
\Rightarrow \id_A$ and $p\circ d_{\eta} \Rightarrow id_A$; this is the bottom-right part of diagram \ref{tikz:postnikov_pullback}.
Moreover, giving a map $k[x_1, \dots, k_n] \to \pi_0(A) \oplus \pi_1(A)[2]$ (such as $d_{\eta} \circ j$ or $\cong d_{0} \circ j$)
is, using the universal property of pullbacks, equivalent to giving a section of the pullback map $B \to k[x_1, \dots, k_n]$:
\[
\begin{tikzcd}
k[x_1, \dots, k_n]\arrow{dr} & & k[x_1, \dots, k_n]\arrow{dl} & \pi_0(A)\arrow{dr} & & \pi_0(A)\arrow{dl} \\
& B\arrow{d} & & & \pi_0(A) \oplus \pi_1(A)[2]\arrow{d} & \\
& k[x_1, \dots, k_n] \arrow{rrr}{j} & & & \pi_0(A) & 
\end{tikzcd}
\]
Note that $\pi_0(A) \oplus \pi_1(A)[2] \to \pi_0(A)$ is a degreewise surjection, hence a fibration in the model structure
of $cdga_k^{\leq 0}$. (See \ref{rem:transfer_model_structure} for how this model structure is obtained, via the free-forgetful
adjunction.) It follows that the homotopy pullback by $j$ is the same as the naive pullback, so $B = k[x_1, \dots, k_n]
\oplus j_*\pi_1(A)[2]$.

Putting everything together, a lift $j_1 : \Spec \tau^{\leq 1}(A) \to \bbA^1$ is the same as a homotopy between $d'_0$
and $ d'_{\eta}$, the images of $d_0$ and $d_{\eta}$ under pullback. 
But $d'_{0},d'_{\eta} \in Map_{cdga_k^{\leq 0} / k[x_{1},...,x_{n}]}(k[x_{1},...,x_{n}]), k[x_{1},...,x_{n}]\oplus 
j_{*}\pi_{1}(A)[2])\cong Map_{k[x_{1},...,x_{n}]-Mod}(\bbL_{k[x_{1},...,x_{n}]}, j_{*}\pi_{1}(A)[2])$; denote this space
by $X$. We compute its homotopy type. 

Since $k[x_1, \dots, x_n]$ is discrete and smooth over $k$, $\bbL_{k[x_1, \dots, x_n]} \cong \Omega^1_{k[x_1, \dots, x_n]}[0]$.
On the other hand, the functor $j_*$ is t-exact (see \ref{eg:modules_t_exact}), so $j_* \pi_1(A)[2]$ is concentrated in degree 2.
It follows that we have:
\[	\pi_i(X) = \left\{ \begin{array} {l} 0 \text{ if } i \neq 2, \\ 
\Hom\big(\Omega^1_{k[x_1, \dots, x_n]}, \pi_1(A)\big) \cong \pi_1(A)^{\oplus n} \text{ if } i = 2 \end{array}\right. .	\]
So $X \simeq K(\pi_1(A)^{\oplus n}, 2)$. In particular, $X$ is path connected, so the required path between $d'_0$ and $d'_{\eta}$
exists. We can say more:
\[	\{ \text{homotopies between } d'_0 \text{ and } d'_{\eta} \} \simeq \Omega X \simeq K(\pi_1(A)^{\oplus n}, 1).	\]
We conclude that any two lifts $j_1, j_1' : k[x_1, \dots, x_n] \to \tau^{\leq 1}(A)$ are homotopic, but not coherently
homotopic.
\end{proof}



\chapter{Perfect Complexes}
Talk by Benedict Morrissey.

Half of this is about perfect complexes in classical AG, and the second half about what we do in the derived setting. 
In 2-3 weeks we will see that perfect complexes actually form a stack.

\section{Classical}
\label{sect:perf_classical}

Let $X$ be a scheme, then we look at $Ch^{\bullet}(QCoh(X))$.

\begin{defin}
$E^{\bullet} \in Ch^{\bullet}(QCoh(X))$ is \textbf{perfect} if it's Zariski locally quasi-isomorphic to an object
of $Ch^b(Vect_X)$. 
\end{defin}

\begin{rem}
This is not the same as requiring cohomology to be finitely supported.
\end{rem}

\begin{defin}
$E^{\bullet} \in Ch^{\bullet}(QCoh(X))$ has \textbf{Tor amplitude} in $[a,b]$ if for all $\mathcal{F} \in \mathcal{O}_X -Mod$,
\[	H^k(E^{\bullet} \otimes^{\bbL}_{\mathcal{O}_X} \mathcal{F}) = 0	\]
for $k \not \in [a,b]$. In particular, if $E$ is in the heart, this is just saying that the Tor with any given sheaf is bounded.
\end{defin}

\begin{rem}
For $\mathcal{F} = \mathcal{O}_X$, we just get the cohomology of $E^{\bullet}$.
\end{rem}

This is sometimes difficult to work with, so we have:

\begin{defin}
$E^{\bullet} \in Ch^{\bullet}(QCoh(X))$ is \textbf{almost perfect} if Zariski locally there is a $n$-quasi-isomorphic to
something in $Ch^b(Vect_X)$. n-quasi-isomorphism means isomorphism on cohomologies for $k\geq n+1$, and surjection
for degree $n$.\todo{Figure out cohomological convention}
\end{defin}

Perfect obviously implies almost perfect; this descends to the derived category of quasi-coherent sheaves.

\begin{thm}
$E^{\bullet}$ is perfect iff $E^{\bullet}$ is almost perfect (for some $n$) and has finite Tor amplitude.
\end{thm}
\begin{proof}
Locally free means flat, so tensoring it with anything preserves the tor amplitude. The other direction is in
TT, Higher algebraic K-theory of schemes, 2.2.12.
\end{proof}

Alternative definition: $E^{\bullet} \in D(Coh(X))$. Locally on some $U$ we have an $\mathcal{O}_X(U)$-module
$E|_{U}^{\bullet}$. We require that this is bounded above and has coherent cohomologies. Equivalently, $\tau_{\leq n}(E^{\bullet}|_n)$
is compact in $\tau_{\leq n} Mod_{\mathcal{O}_X(U)}$.

\begin{thm}
For $X$ affine, $E^{\bullet}$ is perfect if and only if it's globally quasi-isomorphic to an object of $Ch^b(Vect_X)$.
\end{thm}

\begin{thm}
If $X$ is smooth and Noetherian, then $D(Coh^b(X)) \simeq D(Perf(X))$.
\end{thm}

We'll prove this by Serre regularity.

\begin{defin}
A is \textbf{regular} if $\dim_k(m/m^2) = \dim_{Krull} A$. The \textbf{global dimension} of $A$ is:
\[	gldim(A) = \sup_{M \in A-Mod} \text{projdim}(M),	\]
where the latter is the minimum length of a projective resolution of $M$.
\end{defin}

\begin{thm}[Serre regularity]
If $A$ is a Noetherian local ring, TFAE:
\begin{enumerate}
\item $A$ is regular;
\item $gldim(A) < \infty$;
\item $gldim(A) = \dim_{Krull}A$.
\end{enumerate}
\end{thm}

Going back to $X$ smooth and Noetherian, we know that all local rings are regular. $E^{\bullet} \in Coh^b(X)$, then
$E^{\bullet}_p$ is a $\mathcal{O}_{X,p}$ module. 

\begin{proof}
We actually just do the case of $E$ in the heart, because it's easier. (For the other one, we probably resoluve to a double
complex, and take the total complex.)

Take a projective resolution of $E^{\bullet}_p$ as a $\mathcal{O}_{X,p}$ module; we know it must be finite:
\[	0 \to P_n \to \dots \to P_2 \to P_1 \to E^{\bullet}_p \to 0.	\]
We can do this in an open set around $p$:\todo{draw this from paper}

This takes care of one direction. We then use Tor dimension to show that, if $E$ is perfect, it's in $D(Coh^b(X))$.
\end{proof}

For the non-smooth case, we look at the ind-completion $Ind(Perf(X)) \simeq QCoh(X)$. (Always true for $X$ quasi-compact,
quasi-separated.) On the other side, $Ind(Coh^b(X)) = IndCoh(X)$. The quotient $IndCoh(X)/QCoh(X) = D_{sing}(X)$, which
really sees the singularities of $X$.


\section{derived}
\label{sect:perf_derived}

Let $A \in SCR_k$; recall that $\cM od_A$ is a stable $\infty$-category.

\begin{defin}
$\cM od^{\text{perf}}_A \subset \cM od_A$ is the smallest stable subcategory containing $A$ and closed under retracts.
Recall that $A$ is a retract of $B$ if there exist maps $i:A \to B, r:B \to A$ such that $r\circ i = \id_A$.
\end{defin}

\begin{defin}
$N \in \cC$ is \textbf{compact} if $\cH om_{\cC}(N, -)$ commutes with filtered colimits. The latter means that
the index category is nonempty, and for all $i,j \in I$, there exists $k$ such that $i \to k \leftarrow j$, and
coequalizers exist.
\end{defin}

\begin{eg}
Consider $(\cM od_A)^{\heartsuit}$. The compact objects are the finitely presented ones. We have a map $A^n \to M$,
so:
\[	\Hom(M, \varinjlim_I B_i) \simeq \varinjlim_I \Hom(M,B_i),	\]
because if we have a map $M \to B$, we can fully describe it by the composition $A^n \to B$. Each of the $n$ generators goes
to some $B_{i_k}$, so by the definition of filtered index category, there exists some $B_j$ such that $A^n \to B_j$. 

Conversely, starting with compact $M$, we look at finitely generated submodules $M_i$, and we have:
\[	\Hom(M, \varinjlim_I M_i) \simeq \varinjlim_I(M,M_i).	\]
In particular, the identity map $M \to M$ factors through some $M_j$, so $M = M_j$.
\end{eg}

\begin{thm}
$M \in \cM od_A$ is perfect iff it's compact.
\end{thm}
\begin{proof}
$\cM od_A^{\text{perf}} \subset \cM od_A^{\text{cpct}}$. \todo{add diagram from paper}
\[
\begin{tikzcd}
\;
\end{tikzcd}
\]

Since DK is an equivalence, we only need to argue that truncation and the forgetful functor preserve filtered colimits.
For the first one: filtered colimits are t-exact. For the second one: it does.

For the other direction, we have the inclusion $\cM od_A^{\text{perf}} \to \cM od_A$, we factor this though Ind, which
is just the completion with respect to filtered colimits.
\[
\begin{tikzcd}
\cM od_A^{\text{perf}} \arrow{r} & \cM od_A \\
 & Ind(\cM od_A^{\text{perf}}) \arrow{u}{\phi}
\end{tikzcd}
\]
$f$ is obviously fully faithful, because $Ind(\cM od_A^{\text{perf}})^{\omega} = \Mod_A^{perf}$.\footnote{We'll talk more about
this equality later, it follows because Perf is idempotent complete.} Mapping spaces
in $Ind$ are computed by:
\[ \cM ap_{Ind(\cC)}(\colim_{i \in I} \mathcal{F}_i, \colim_{j \in J} \mathcal{G}_j)	
= \lim_{i \in I} \colim_{j \in J}	\cM ap_{\cC}(\mathcal{F}_i, \mathcal{G}_j) .\]
This means we're computing mapping spaces by the same formula, so $\phi$ is fully faitfhul.
\end{proof}

The following is 7.2.4.5 in \cite{Lurie_Higher_algebra}:
\begin{thm}
$M \in \Mod_A^{perf}$, we have:
\begin{enumerate}
\item $\pi_n M = 0$ for $n >>0$;
\item If $\pi_m M \cong 0$ for all $m>k$, then $\pi_k M$ is finitely presented as a $\pi_0(M)$-module.
\end{enumerate}
\end{thm}

\begin{proof}
For $M$ perfect, we use compactness to get $M \simeq \lim_{n\to \infty} (\tau_{\leq n} M)$. In fact, the map must
factor through one of the terms in the limit, so $M \simeq \tau_{\leq n}M$ for some $n$.

Next, we have the adjunction:
\[
\begin{tikzcd}
\cM od_A^{\heartsuit} \arrow{r} & \cM od_A^{connective} \arrow{r}{[k]} & \cM od_A^{support \leq k}
\end{tikzcd}
\]
The adjoint truncates $\geq k$ and then shifts. Both of these preserve  \todo{finish}
\end{proof}

\begin{eg}
Think about $\Sym(k[2])$ as a module over itself. It is perfect by definition, but it's not bounded below.
\end{eg}




Recall from the last talk that we have $A \in SCR_k$, and a stable$\infty$-category $\cM od_A$. We defined the
stable $\infty$-subcategory $\cM od_A^{\text{perf}}$. We proved that $\cM od_A^{\text{perf}}\simeq \cM od_A^{\text{cpt}}$.


\begin{defin}
$M$ is almost perfect if it's almost compact, i.e. $M$ is bounded above and $\forall n\leq 0$, $\tau_{\geq n}M$ is 
compact in $\cM od_A^{\geq n}$.
\end{defin}

\begin{rem}
In the classical setting, due to Tor amplitude, perfect complexes need to be bounded below. This is no longer the case.
\end{rem}

\begin{thm}[7.2.4.11 in \cite{Lurie_Higher_algebra}]
\begin{enumerate}
\item $\cM od_A^{aperf} \subset \cM od_A$ closed under translation, finite colimits, so it's a stable subcategory of
$\cM od_A$;
\item $\cM od_A^{aperf}$ is closed under retracts;
\item $\cM od_A^{perf} \subset \cM od_A^{aperf}$;
\item $(\cM od_A^{aperf})^{\leq 0}$ closed under geometric realizations;
\item Every $M \in \cM od_A^{aperf}$ is $M = |P_{\bullet}|$, a geometric realization of a simplicial $A$-module. Each 
$P_i$ finite rank and free.\footnote{In fact, the almost perfect ones are precisely these geometric realizations - we think.
Write about this in more detail.}
\end{enumerate}
\end{thm}

\begin{proof}
Look at 2.4.1
\end{proof}

A note about geometric realizations, which are colimits of simplicial objects. Simplicial resolutions are the classical
description of the cotangent complex. One starts with a simplicial resolution in the category of $A$-modules, and the
realization is the cotangent complex.

Now assume that $X \in \Aff^{classical}$ and that $E_{\bullet}$ is perfect. We want to show that $E_{\bullet}$
is equivalent to a finite complex of vector bundles, globally. This follows from the proof before, but we show that
$D_i$ are actually vector bundles, using the finite Tor amplitude.

\begin{thm}[7.2.4.17 in \cite{Lurie_Higher_algebra}]
Say $A$ is left coherent, i.e. $A$ is connective, $\pi_nA$ is a finitely presented $\pi_0(A)$-module, and that every
finitely generated left ideal of $A$ is a finitely presented left $A$-module. Then $M \in \cM od_A$ is almost perfect
if and only if $\exists m >>0$ such that $\pi_k M = 0$ for all $k\geq m$, and $\pi_k M$ is a finitely presented
$\pi_0(A)$-module. \footnote{This formulation is using homological convention, I think. Figure out the signs.}
\end{thm}

\begin{rem}
In particular, from this it's obvious that not all almost perfect modules are perfect. Think about the discrete case,
this allows almost perfect to be unbounded below, whereas perfect have to be bounded below, due to finite Tor amplitude.
\end{rem}

\begin{defin}
The tor amplitude $Toramp(M) \leq n$ if for all discrete $A$-modules $N$, $\pi_i(M \otimes_A N) = 0$ for all $i\leq -n$.
\end{defin}

\begin{thm}[7.2.4.23 in \cite{Lurie_Higher_algebra}]
$A \in SCR_k$:
\begin{enumerate}
\item $M \in \cM od_A$, tor amplitude $\leq n$ $M[k]$ has tor amplitude $\leq n+k$;
\item $M' \to M \to M''$ a fiber sequence, $M'$ and $M''$ have tor amplitude $\leq n$, then so does $M$;
\item $M$ has tor amplitude $\leq n$, so does any retract;
\item $M$ is almost perfect, then $M$ is perfect iff it has finite Tor amplitude;
\item $M$ has $Toramp \leq n$, then $\forall N \in (\cM od(A)_{supp \leq 0})$, $\pi_i(N\otimes_A M) = 0$ for
	$i \leq -n$.
\end{enumerate}
\end{thm}

\begin{proof}
For 4, the inductive hypothesis uses 2, for the base case we want that almost perfect and flat implies perfect. The latter
follows from 7.2.4.20.
\end{proof}





\chapter{Descent}
Talk by Antonijo Mrcela.

\section{Statement}
\label{sect:cc_statement}

We recall the construction of overcategories, introduced in \ref{sect:cartesian}. In particular, the $\infty$-category of
commutative algebras over $A$ is the homotopy pullback in the following diagram.
\[
\begin{tikzcd}
\cC Alg_{/A} \arrow{r}\arrow{d} & \Fun(\Delta^1 , \cC Alg_k)\arrow{d}{ev_1} \\
\{A\} \arrow{r} & \cC Alg_k
\end{tikzcd}
\]
This is a co-Cartesian fibration. Next, given $f:B \to A$, we get a Cartesian morphism:
\[
\begin{tikzcd}
\cC Alg_{/B} \arrow{d} &  \cC Alg_{/A} \arrow{d}\arrow{l}\\
\{B\} \arrow{r}{f} & \cC \{A\}
\end{tikzcd}
\]
So we can apply the Grothendieck construction to get a functor $\mathcal{F} : \cC Alg_k^{\op}
\to \cC at_{\infty}$. We then take the spectralization to $\cC at_{\infty}^{st}$.

Moreover, $Mod$ lands in the presentable category: $Pr_{st}^R$, where the functors are right adjoint functors. There's also a version
$Pr_{st}^L$, and we have, by \cite{HTT} 5.5.3.4, $[\cS, Pr_{st}^R] \simeq [\cS^{\op}, Pr^L]$. So we can take the adjoint of
$Mod: \cC Alg_k^{\op} \to Pr_{st}^R$ to get $QCoh^{\times} \cC Alg_k \to Pr_{st}^L$.

Note also that at the level of Mod we have a contravariant functoriality, where $f: A \to B$ gets sent to the forgetful functor
$f_* : B-Mod \to A-Mod$. At the level of $QCoh^{\times}$ we have covariant functoriality.

We'll define Grothendieck topologies for $\infty$-categories, and surprisingly get just Grothendieck topologies on the homotopy
category.

\begin{defin}
A \textbf{sieve} on an $\infty$-cat $\cC$ is a full subcategory such that, if $f: C \to D$ and $D \in \cC^0$, then
$C \in \cC^0$. If $C \in \cC$, then a \textbf{sieve over} $C$ is a sieve on $\cC_{/C}$.
\end{defin}

By Remark 6.2.2.3 in \cite{HTT}, a Grothendieck topology on $\cC$ is just one on $h\cC$.

Note, though, that $\eta : h(\cC_{/C}) \to h(\cC)_{/C}$ is not normally an equivalence. This is because in $h(\cC_{/C})$
we also need to specify hte homotopy that makes $A \to B \to C$ commute. However, $\eta$ induces a bijection on sieves.

In $\cC Alg_k$, $S$ the set of faitfully flat morphisms. The following is DAG VII 5.4, 5.1: $S$
determines a Grothendieck topology on $\cC Alg_k$. This is called \textbf{the flat topology}.

\begin{defin}
The \textbf{Cech nerve functor} $B^{\bullet} : \Delta \to \cC Alg_k$, is informally described by $i \to B_i = B^{\otimes_A^{i+1}}$.
To construct it as an $\infty$-functor, we take the left Kan extension of the functor $\Delta^{\leq 1} \to \cC Alg_k$, given
by the morphism $B \to B \otimes_A B$. \todo{Doesn't sound right, figure this out}
\end{defin}


Since $A$ maps to each $B_i$, we obtain an $\infty$-functor $\phi: A-\cM od \to \varinjlim_{\Delta} B^{\otimes_A^{n+1}} - \cM od$.
The \textbf{descent problem} asks if this is an equivalence, and if it is,
whether we can construct some sort of inverse. We give an affirmative answer to the first question, using the following
strategy:
\begin{itemize}
\item The category $A-\cM od$ has a standard t-structure given by the degrees of the modules. We use Lemma \ref{lem:t_filt}
to put a t-structure on $\varinjlim_{\Delta} B^{\otimes_A^{n}} - \cM od$ as well.
\item Due to Lemma \ref{lem:equiv_heart}, $\phi$ is an equivalence if and only if it induces an equivalence on the hearts
of the given t-structures. Due to the equivalence \ref{eq:map_heart}, $\phi$ is an equivalence if and only if it induces
an equivalence $\pi_0(A) \cM od^{\heartsuit} \to \varinjlim_{\Delta} \pi_0(B)^{\otimes_{\pi_0(A)}^{n+1}} - \cM od^{\heartsuit}$.
\item We use a version of Quillen's Theorem A, reproduced in \ref{thm:A}, to show that we can replace the infinite Cech nerve
with a 3-term Cech nerve, without changing the limit. This reduces the problem to Grothendieck's classical formulation of 
descent, which we know to be true.
\end{itemize}


\section{Proof}
\label{sect:descent_proof}
The following lemma is 3.20 in Shennon - Porta - Vezzosi, Formal Gluing along non-linear
flags. \todo{cite this once it appears}

\begin{lem}
\label{lem:t_filt}
Let $p : \mathcal{X} \to \cS$ be a stable filtration, and let $\cS^{\op} \to \cC at_{\infty}^{st}$ be the associated 
$\infty$-functor. Suppose:
\begin{enumerate}
\item For all $s \in \cS$ there is a t-structure $(\mathcal{X}_s^{\leq 0}, \mathcal{X}_s^{\geq 0})$ on $\mathcal{X}_s$.
\item For all edges $f:s \to s'$, the induced functor $f^*$ is t-exact.
\end{enumerate}
Then the stable $\infty$-category $\varprojlim F$ has a (unique) t-structure characterized by:
\[	\forall s \in S, e_s : \varprojlim F \to \mathcal{X}_s 	\]
is $t$-exact.
\end{lem}
\begin{proof}
We can represent the limit as: $\varprojlim F = \Map^{\flat}_S(S^{\sharp},\mathcal{X}^{} )$. \todo{figure out how to do symbol
over $\mathcal{X}$; see \cite{HTT} 3.3.3.2.}
I.e. we map all edges to $p$-Cartesian edges. Define $\cC^{\leq 0}$ to be the full subcategory spanned by $x \in \cC$ such that
$x(s) \in \mathcal{X}_s^{\leq 0}$.
in $\mathcal{X}$.

Let $\mathcal{X}^{\leq 0}$ be the full subcat spanned by $x \in \mathcal{X}$ such that $x \in \mathcal{X}^{\leq 0}_{}$. Let
$j: \mathcal{X}^{\leq 0} \to \mathcal{X}$ be the inclusion.
$p\circ j$ is again a Cartesian fibration, because $f^*$ is exact. Then the inclusion preserves Cartesian edges.
By Proposition 1.2.1.5 in \cite{Lurie_Higher_algebra} (says that $\cC^{\leq n}$ is a localization of $\cC$), which we apply
fiberwise, we get a left adjoint for each fiber. Then apply \cite{Lurie_Higher_algebra} 7.3.2.6 which says the
following. Suppose that we have
a commutative diagram,
\[
\begin{tikzcd}
\cC\arrow{dr}{q} & & \cD\arrow{ll}{G} \arrow{dl}{p} \\
 & \cE & 
\end{tikzcd}
\]
where $p, q$ are locally Cartesian categorical fibrations. Then $G$ admits a left adjoint iff
\begin{enumerate}
\item for every $E \in \mathcal{E}$, the map $G_E : \cD_E \to \cC_E$ admits a left adjoint;
\item $G$ carries locally $p$-Cartesian morphisms in $\cD$ to locally $q$-Cartesian in $\cC$.
\end{enumerate}
This is a ``gluing result for left-adjoints''; not entirely obvious result. But using this gives a global adjoint
$\tau_{\leq 0} : \mathcal{X} \to \mathcal{X}^{\leq 0}$.

Note that, in general, $G$ doesn't have
to preserve Cartesian edges. But we used the fact that $f^*$ is t-exact to deal with this.
\end{proof}

\begin{eg}
Pick $A \to B$ a non-flat morphism. Then we have: \todo{add from paper}
\end{eg}

Now we need to reduce to the problem of descent in the heart. We use Lemma 3.3.7 in the same paper.
\begin{lem}
\label{lem:equiv_heart}
Let $f : \cC \to \cD$ be an exact functor between stable $\infty$-categories. Assume $\cC, \cD$ have t-structures which
are left complete and right bounded, and that with respect to these structures $f$ is t-exact. Then TFAE:
\begin{enumerate}
\item $f$ is an equivalence;
\item $f^{\heartsuit} : \cC^{\heartsuit} \to \cD^{\heartsuit}$ is an equivalence of abelian categories.
\end{enumerate}
\end{lem}
Note that 1 $\Rightarrow$ 2 is obvious, while 2 $\Rightarrow$ 1 is very powerful. This is because we can do many constructions
at the level of the hearts that we can't do at the level of $\infty$-categories.

\begin{proof}
The first step is full faithfulness. For $x,y \in \cC$, there is a canonical transformation $\psi_{x,y} :
Map_{\cC}^{st}(x,y) \to Map_{\cD}^{st}(f(x), f(y))$. Start by fixing $x$ and defining the full subcategory $\cC_x \subset \cC$,
spanned by those $y$ such that $\psi_{x,y}$ is an equivalence. This is closed under loop and suspension, extensions
and retract. So if $\cC^{\heartsuit} \subset \cC_X$, we go by induction on non-vanishing cohomology groups,
to get $\cC^b \subset \cC_X$. Here we use the left complete and right complete assumptions. Now for an arbitrary $y\in \cC$,
$y = \varinjlim \tau_{\geq n} y$. $f$ commutes with this specific colimit, so $f(y) = \varinjlim f(\tau_{\geq n} y)$.
Every map from $x$ to $y$ lands in $\tau_{\geq n} y$ for some $n$, and analogously for maps $f(x)$ to $f(y)$, which reduces
the problem to the case of bounded modules, which is already proved.

Step 2 is essential surjectivity. On the heart it's the hypothesis. Pick $y\in \cD^b$, we have the exact sequence
$\tau_{\leq k} y \to y \to \tau_{>k} y$, with $k$ chosen so that both truncations have fewer cohomology groups than $y$.
Since \todo{fill in from paper}
\end{proof}

\begin{rem}
According to Marci, there are two non-equivalent versions of $D^bCoh$ which have the same heart. We could think about why
this lemma doesn't apply for them.
\end{rem}

\begin{rem}
Mauro says that you can use this statement to prove a bunch of things, for example reduce $\infty$-GAGA to classical GAGA.
\end{rem}

Recall that we were trying to determine whether $A-\cM od \to \varinjlim B^{\otimes_A^{n}} - \cM od$ is an equivalence. We use
Lemma \ref{lem:t_filt} to put a t-structure on the limit, and Lemma \ref{lem:equiv_heart} to show that the problem is equivalent
to that of equivalence of the hearts of the categories. The RHS
becomes:
\[	\varinjlim (B^{\otimes_A^{n}} - \cM od)^{\heartsuit} = \varinjlim \pi_0(B^{\otimes_A^{n}}) - \cM od ,	\]
and the LHS becomes:
\[	\pi_0(A)- \cM od.	\]
This is almost the statement of the classical descent theorem \`{a} la Grothendieck. However, 
in our case the Cech nerve is infinite, instead of having only 3 terms. These two versions are actually
equivalent, due to the following theorem. 

\begin{thm}[Quillen, version of Theorem A]
\label{thm:A}
If $\cC$ is an $n$ category (it's proven in \cite{HTT} that $n$ can be $\infty$), $A : J \to I$ a functor,
if for every object $x \in I$ we have $\pi_i(J_{/x}) = 0$ for $i<n$, then $\lim F = \lim F \circ A$, for all $F : I \to \cC$.
\end{thm}

Here $J_{/x} = J \times_I I_{/x}$. We apply the theorem with $\cC = \cC at \subset \cC at_{\infty}$, which is a 2-category. 
So we need $n=2$.\footnote{For $n=1$, Theorem A is classical; for $n=\infty$, it is proved in \cite{HTT}. For $1<n<\infty$,
we don't think it's written up anywhere, but it should be true.} Furthermore, we use the inclusion $\Delta_s^{\leq 3} \to
\Delta_s$, where the subscript denotes the subcategories with the same objects, but only monomorphisms as morphisms. Define
$F$ as the infinite Cech nerve, $F : \Delta_s \to \cC$, $n \mapsto B^{\otimes_A^n}$; then the restriction $F \circ A$ is
the Cech nerve \`a la Grothendieck:
\[
\begin{tikzcd}
\pi_0(B) - \cM od \arrow[shift left]{r}\arrow[shift right]{r} & \pi_0(B) \otimes_{\pi_0(A)} \pi_0(B) -\cM od
\arrow[shift left = 2]{r}\arrow{r}\arrow[shift right = 2]{r} & \pi_0(B) \otimes_{\pi_0(A)} \pi_0(B) \otimes_{\pi_0(A)} \pi_0(B)
-\cM od .
\end{tikzcd}
\]


\begin{rem}
We motivate the choice of 3 in $\Delta_s^{\leq 3}$ above.
As proved in Exercise 1.5.4, the homotopy type of $(\Delta^{\leq m}_S)_{/m+k}$, with $k\geq 0$,
is a wedge of a number $N_{m,k}$ of $m-1$-spheres. \footnote{Mauro has computed $N_{m,1} = 1$ and $N_{m,2}= 3$; we should see
if we can determine all $N_{m,k}$.} In order for $J = \Delta^{\leq m}_S$ to satisfy the assumptions of Theorem \ref{thm:A} with
$n=2$, we need $m\geq 3$. Therefore the Cech nerve can be reduced to a minimum of 3 terms.
\end{rem}

\begin{rem}
We have:
\[
\begin{tikzcd}
 \varinjlim B^{\otimes_A^{n}} - Mod \arrow{d} \\
A-Mod
\end{tikzcd}
\]
Warning: in non-affine situations, the functor $\lim QCoh(U^n) \to \Fun(\Delta, QCoh(X))$ is highly non-explicit. Given
a descent datum $\{\mathcal{F}^n\}$, we get an $\infty$-functor $\Delta \to QCoh(X)$ which is very lax. In practice one uses
rectification to write $\Fun(\Delta, QCoh(X)) \simeq \infty \Fun(\Delta, Ch(QCoh(X)))$, and use Reed something. The problem is
that the rectification is also very non-explicit.
\end{rem}





\chapter{Geometric Stacks and Gluing}
Talk by Mauro Porta.


We finally leave the affine world! Only took us 2 months. But first, we mention a
correction to Lemma \ref{lem:equiv_heart} from the previous talk.
The statement ``$F^{\heartsuit}$ is an equivalence'' should be taken as ``$F^{\heartsuit}$ is essentially surjective and 
$F|_{\cC^{\heartsuit}}$ is
fully faithful''. This means we have to take into account $\Ext$ between discrete objects; an equivalence at the level of
hearts is not strong enough to guarantee an equivalence on the entire categories.

Otherwise, there's a counterexample to the lemma. Take $A \in cdga^{\leq 0}$, we have the pullback  functor 
$A-\cM od \overset{f^*}{\to} H^0(A)-\cM od$, $M\mapsto M \otimes_A H^0(A)$, which is not t-exact, so the lemma makes no statement
about it. However, the forgetful functor $f_* : H^0(A) - \cM od \to A-\cM od$ is t-exact, but it fails to be an equivalence, even if
$f_*^{\heartsuit}$ is an equivalence between the categories of discrete modules.


\section{Gluing: problems and approaches}
The problem for today is: how do we patch together derived affines? This is difficult for two reasons:
\begin{enumerate}
\item If a derived scheme is to be thought of as a gluing of derived affines, we should be able to produce many gluing
diagrams in $d \cA ff_k$. This means functors $I \to d \cA ff_k$, which is difficult because the latter is an $\infty$-category,
so we need to specify higher coherencies when defining functors.
In particular, to define $\bbP^1$, we have:
\[
\begin{tikzcd}
\; & \bbA^1\arrow{dr} &  \\
\bbG_m \arrow{ur}\arrow{dr} & & \bbP^1 \\
& \bbA^1\arrow{ur} &
\end{tikzcd}
\] 
as well as a homotopy between the branches. \todo{Am I interpreting this correctly?}
This is not an existential threat, because we can choose a model-categorical presentation for $d \cA ff_k$.
\item But we really need an environment category where the gluing is performed; constructing this is tricky. There are 2 ways.
\begin{itemize}
\item Structured spaces, i.e. the environment is the category of locally ringed topoi, or similar.
\item Functor of points, i.e. the environment is the category of presheaves of spaces, $\Fun(d\cA ff \to \cS)$.
\end{itemize}
Today we want to address both and compare them.
\end{enumerate}

First, we look at pros and cons for both:
\begin{itemize}
\item Structured spaces. It's fairly easy to think about objects in this way: they are $(X, \mathcal{O}_X)$, where $X$ is some
sort of topological space (actually $\infty$-topos), and $\mathcal{O}_X$ is a sheaf of cdga's on $X$. Note how similar this is
to how we think about underived schemes. Moreover, the subdivision $(X, \mathcal{O}_X)$ makes it easy to distinguish the
derived information from the underived one. For example, $\pi_0(X,\mathcal{O}_X) = (X, \pi_0(\mathcal{O}_X))$, and the Postnikov
tower discussion carries over to derived schemes:
\[	\dots \to (X, \tau_{\leq 2} \mathcal{O}_X) \to (X, \tau_{\leq 1} \mathcal{O}_X) \to (X, \pi_0 \mathcal{O}_X).	\]
Cons: maps are difficult to understand, and only Deligne-Mumford stacks can be described in this way. 
\footnote{Any structured space has connected cotangent complex, but Artin stacks don't need to. The smooth \'etale
site is not canonical, while the \'etale site is.}
Note that the stack of
perfect complexes, as well as the Eilenberg-Maclane stacks are Artin, but not Deligne-Mumford.

\item Functor of points. It can deal with Artin stacks, and then some more. Sometimes in life we want to deal with objects 
which are stacks,
but not geometric stacks; the easiest example is $QCoh : d Aff \to Cat_{\infty}$. We saw last time it has descent, so it's
a stack, but it's not geometric.\footnote{I.e. it doesn't have an appropriate atlas, we'll see shortly what this means.} 
We only have one con, but it's pretty bad: it's not clear at all,
in this language, why schemes should be simpler than Artin stacks. In other words, techniques which hold for schemes but don't
hold for Artin stacks are obscured.
\end{itemize}


\section{Structured spaces}
We want a category $\cC$ with the following properties:
\begin{enumerate}
\item \label{env1}
$\cC$ contains $d \cA ff_k$ in a fully faithful way.
\item \label{env2}
$\cC$ is big enough to contain all the gluings we'll make. For example, we'd be happy with $\cC$ closed under colimits.
\item \label{env3}
$\cC$ is small enough to have a good notion of Grothendieck topology. (Note that any co-complete category has a Grothendieck
topology, called the \textbf{canonical topology}: for an object $X$, and a collection $\{U\}$ of objects mapping to $X$, 
call it a covering if
the geometric realization of the $\check{C}$ech nerve of $\{U\}$ is equivalent to $X$. But this is not a very useful topology; when
we say ``good Grothendieck topology'', we want to have a better grasp on the coverings: describe them using words such as
\'etale, smooth, flat, open immersion etc.)
\end{enumerate}


To exemplify this philosophy, recall what we do in classical AG. That is, start with $\cA ff_k$ instead of $d \cA ff_k$. 
Then we have two choices for $\cC$.
\begin{itemize}
\item $(X,\mathcal{O}_X)$ locally ringed spaces. Property \ref{env1} we all know. For \ref{env2}, note that LRS doesn't admit
all colimits (you can't talk about $\bbP^{\infty}$, for example; that's an IndScheme), but admits enough of them
to describe schemes. For \ref{env3}, the Grothendieck topology is as follows. We say $(X, \mathcal{O}_X) \to (Y,\mathcal{O}_Y)$ is an
\textbf{open immersion} if it's an open inclusion at the level of topological spaces, and the induced map $f^{\sharp}
: f^* \mathcal{O}_Y \to \mathcal{O}_X$ is an isomorphism. Then a collection $\{X_i\}$ is a \textbf{covering} of $Y$ if
each $X_i \to Y$ is an open immersion, and moreover the induced map $\coprod X_i \to Y$ is surjective at the level of topological
spaces. \todo{is this definition of covering correct?}
Then we can define schemes as objects in LRS which are covered, in the above sense, by objects in the essential
image of $\cA ff_k \to LRS$.

\item Alternatively, we can take locally ringed 1-topoi, in which case we get Deligne-Mumford stacks. Below we make a short
summary of locally ringed 1-topoi.
\end{itemize}

\begin{defin}
A \textbf{Grothendieck site} is a category $\mathcal{D}$ together with a Grothendieck topology. A \textbf{1-topos} $X$
is a category equivalent to $\Sh(\mathcal{D})$ for some Grothendieck site $\mathcal{D}$.
\end{defin}

If the gluing environment $\cC$ is the category of locally ringed topoi, then \ref{env1}
and \ref{env2} are again easy. For the Grothendieck topology on $\cC$, we make the following definitions.
\footnote{Don't confuse the Grothendieck topology on the category $\cC$ of locally ringed topoi, which we're trying to
define now, with the Grothendieck topology on the underlying site $\cD$ of an individual topos $\mathcal{X}$. Sometimes
both topologies have the same name, e.g. \'etale, but it should be clear that they're completely different notions.}

\begin{defin}
For $\mathcal{X}$, $\mathcal{Y}$ 1-topoi, a \textbf{geometric morphism} $\mathcal{Y} \to \mathcal{X}$ is an adjoint pair:
\[	f^{-1} : \mathcal{X} \to \mathcal{Y} : f_*,	\] 
where moreover $f^{-1}$ preserves finite limits.
\end{defin}

Note that, despite the notation, the geometric morphism goes from $\mathcal{Y}$ to
$\mathcal{X}$; the ``inverse image'' $f^{-1}$ happens to be the left adjoint. This is motivated by the following example.
If $X, Y$ topological spaces, take $\mathcal{X} = \Sh(X)$ and $\mathcal{Y} = \Sh(Y)$.
For any $f: Y \to X$, the usual inverse and direct image functors on sheaves:
\[	f^{-1}: \Sh(X) \to \Sh(Y) : f_*	\]
form a geometric morphism. Recall that $f^{-1}$ is defined as a colimit indexed by open subsets containing
the image of $f$, followed by sheafification. Both these operations are filtered colimits, therefore commute with finite
limits. Hence $f^{-1}$ commutes with finite limits, and the pair $(f^{-1},f_*)$ is a geometric morphism.

\begin{defin}
\label{defin:etale_topoi}
A geometric morphism $f^{-1} : \mathcal{X} \to \mathcal{Y} : f_*$ is \textbf{\'etale} if there exists $U \in \mathcal{X}$
and an equivalence $\mathcal{X}_{/U}$ making the following diagram commute:
\[
\begin{tikzcd}
\mathcal{X}\arrow{r}{\times U}\arrow[shift left]{dr}{f^{-1}} & \mathcal{X}_{/U}\arrow{d}{\simeq} \\
 & \mathcal{Y}\arrow[shift left]{ul}{f_*} .
\end{tikzcd}
\]
\end{defin}

To get a feel for this definition, note the following examples.

\begin{lem}
\label{lem:etale_topoi}
If $f:Y \to X$ is a local homeomorphism of topological spaces, then the standard $f^{-1}, f_*$ is \'etale. Moreover, if
$f:Y \to X$ is an \'etale map of schemes, then $f^{-1} : \Sh_{Set}(X_{\'et}, T_{\'et}) \to 
\Sh_{Set}(Y_{\'et}, T_{\'et})$ is \'etale.\footnote{By $X_{\'et}$ we mean the \'etale site of the scheme $X$, which is the
subcategory of the comma category $\Sch_X$ given by \'etale morphisms $U \to X$. We endow this site with the Grothendieck
topology $T_{\'et}$ induced from the \'etale topology on $\cA ff$.}
\end{lem}

In fact, we can uprgrade the second statement of Lemma \ref{lem:etale_topoi} to a characterization of \'etale morphisms of
schemes.

\begin{prop}
$f : X \to Y$ in $Sch_k$ is \'etale iff the induced $(f^{-1},f_*)$ morphism of topoi is \'etale
and $f^{-1} \mathcal{O}_Y \to \mathcal{O}_X$ is an equivalence.
\end{prop}

\begin{rem}
We elaborate on the element $U \in \mathcal{X}$ which appears in Definition \ref{defin:etale_topoi}. If $Y \subset X$ is an
open subset of the topological space $X$, then $Y$ defines by Yoneda a sheaf $h_Y \in \mathcal{X} = \Sh(X)$, such that:
\[
h_Y(V) = \left\{ \begin{array} {ll} * & ,V \subset Y, \\ \emptyset &, V\not \subset Y. \end{array}\right.
\]
Then we take $U = h_Y$, and note that we have $\Sh(Y) \simeq \Sh(X)_{/U}$.

We can relax the assumptions and take $f:Y \to X$ a local homeomorphism. Then we define a sheaf $h_f$ by
$h_f(V) = \Hom_{/V}(V,V \otimes_X Y)$.\footnote{In other words, this is the sheaf of sections of $f:Y \to X$.}
 This generalizes the sheaf $h_Y$ from the previous paragraph, in the sense that,
if $f$ is an open immersion, $\Hom_{/V}(V,V \otimes_X Y)$ is nonempty iff $V\cap Y = V$, i.e. $V \subset Y$.
Moreover, it's a fact that local homeomorphisms are characterized by the property $\Sh(Y) \simeq \Sh(X)_{/h_f}$. So
we take $U = h_f$.
\end{rem}

We move on from the idea of gluing in the ambient category of locally ringed 1-topoi to the derived analog. This
will involve the theory of $\infty$-topoi, which allows us to replace sheaves of sets with sheaves of spaces,
and obtain higher DM stacks. This is necessary, for example, in order to talk about $K(G,n)$, for $G$ finite abelian
and $n>1$.\footnote{In algebraic topology, we obtain $K(G,n)$ by de-looping $K(G,n-1)$, a process which almost never
returns a scheme. So when doing geometry we need to replace de-looping with working with higher groupoids; morally
speaking, de-looping $n$ times in topology corresponds to increasing the stack level by $n$. For example, the de-looping
$BG$ of a topological group $G$ corresponds to the stack $BG$ in geometry.}


\section{A primer on $\infty$-topoi}
Note first that the HAG framework \cite{HAG-I} involves hypercomplete $\infty$-topoi, while the DAG framework
\cite{Lurie_DAG_V} involves non-hypercomplete 
$\infty$-topoi. The latter make for a nicer theory, but in practice often need to be reduced to the hypercomplete case.

The main difference is that the following hold if $\mathcal{X}$ is hypercomplete, but don't need to otherwise.
\begin{itemize}
\item $\mathcal{X} = \Sh(\cC, \cT)$, where $(\cC, \cT)$ is an $\infty$-Grothendieck site.\footnote{From now on,
sheaves are sheaves of spaces, unless we explicitly say otherwise.}
\item For $f: \mathcal{F} \to \mathcal{G}$ a morphism in $\mathcal{X}$, $f$ is an equivalence
iff $\pi_i(f)$ are isomorphisms for all $i$.
\end{itemize}

\begin{rem}
\begin{enumerate}
\item If $\mathcal{X}$ is a 1-topos, viewing it as an $\infty$-category (i.e. taking the nerve) \emph{does not} get us
an $\infty$-topos. Instead, if $\mathcal{X} = \Sh_{Set}(\cC, \cT)$, we need to replace it with $\Sh(\cC,\cT) :=\Sh_{\cS}(\cS,\cT)$,
which is an $\infty$-topos. Moreover, we have a fully faithful embedding $\mathcal{X} \subset \Sh(\cC,\cT)$.

\item If $\mathcal{X}$ is an $\infty$-topos, we can look at $\mathcal{X}^{\leq n}$, the $\infty$-category of $n$-truncated 
objects in $\mathcal{X}$. $\mathcal{F} \in \mathcal{X}$
is \textbf{n-truncated} if for all $\mathcal{G} \in \mathcal{X}$, $\Map_{\mathcal{X}}(\mathcal{G},\mathcal{F})$ is n-truncated
as an $\infty$-category. Every $\mathcal{F} \in \mathcal{X}^{\leq n}$ is hypercomplete, i.e. equivalent to the limit of its
Postnikov tower.

We say that $\mathcal{X}$ is \textbf{n-localic} if we can recover it from $\mathcal{X}^{\leq n}$. More precisely, this means that
for all $\infty$-topoi $\mathcal{Y}$, $\Map_*(\mathcal{Y}, \mathcal{X}) \simeq \Map_*(\mathcal{Y}^{\leq n}, \mathcal{X}^{\leq n})$.
The equivalence is implemented as follows. Since $f_*$ is a right adjoint, it preserves truncated objects, which gives the
bottom arrow in the diagram:
\[
\begin{tikzcd}
\mathcal{Y}\arrow{r}{f_*} & \mathcal{X} \\
\mathcal{Y}^{\leq n}\arrow[hook]{u}\arrow[dashed]{r} & \mathcal{X}^{\leq n}\arrow[hook]{u}.
\end{tikzcd}
\]

\item Sometimes, $\infty$-topoi are ``naturally'' hypercomplete. For example:
\begin{itemize}
\item If $X$ is a topological space with finite covering dimension, such as locally compact Hausdorff, then $\Sh(X)$ is
hypercomplete.
\item If $X$ is a quasi-compact, quasi-separated, locally Noetherian scheme, then sheaves on $(X_{Zar},\cT_{Zar})$
are a hypercomplete $\infty$-topos.
\item With $X$ as before $\Sh(X_{Nis},\cT_{Nis})$ is hypercomplete.
\item With $X$ as nice a scheme as you want, even a field, $\Sh(X_{\'et},\cT_{\'et})$ is \emph{not} hypercomplete. But it's
always 1-localic.
\end{itemize}
\end{enumerate}
\end{rem}

\begin{defin}
An $\mathbf{\infty}$\textbf{-topos} is a left exact, accessible localization of a presentable $\infty$-category.
(For example, a presentable $\infty$-category of presheaves of spaces.)
\end{defin}

\begin{rem}
There exists an analog of Giraud's characterization, giving necessary and sufficient intrinsic conditions for an $\infty$-category
to be an $\infty$-topos. They are somewhere in \cite{HAG-I}.
\end{rem}

\begin{rem}
$\mathcal{X}$ is n-localic iff there exists an n-cateogry $\cC$ such that $\mathcal{X} = \Sh(\cC,\cT)$.
\end{rem}

We want to construct the category of locally ringed $\infty$-topoi; a reference for this is Chapter 3 of \cite{DAG-V}.
Recall the definition of derived affines via
Lawvere theory, explained in \ref{sect:lawvere}: $d \cA ff = \Fun^{\times}(T_{disc}(k), \cS)$, where $T_{disk}(k) = \{\bbA_k^n\}$
is the $\infty$-category of affine spaces with morphisms of schemes. To get locally ringed $\infty$-topoi, we change the target $\cS$
to something else. Let $^L Top$ be the $\infty$-category of $\infty$-topoi with geometric morphisms; there is a forgetful
functor $^L Top \to \cC at_{\infty}$. Using the Grothendieck construction, this buys us a Cartesian fibration
$\overline{^L Top} \to ^L Top$.

\begin{defin}
The $\infty$-category of locally ringed $\infty$-topoi is a subcategory:
\[	^L Top(T_{disc}(k)) \subset \Fun(T_{disc}(k), \overline{^L Top}) \times_{\Fun(T_{disc}(k),^L Top)} {^L Top}.	\]
Its objects are pairs $(\mathcal{X}, \mathcal{O} : T_{disc}(k) \to \mathcal{X})$, where $\mathcal{O}$ commutes with products
and $\pi_0(\mathcal{O})$ is a sheaf of local rings. Its morphisms are pairs $(f,f^{\sharp}) : (\mathcal{X},\mathcal{O}_{\mathcal{X}})
\to (\mathcal{X},\mathcal{O}_{\mathcal{X}})$, such that $f^{\sharp} : f^{-1} \mathcal{O}_{\mathcal{Y}} \to \mathcal{O}_{\mathcal{X}}$
induces a local morphism on $\pi_0$.
\end{defin}

\begin{defin}
A \textbf{derived Deligne-Mumford stack} is a pair $(\mathcal{X},\mathcal{O}_{\mathcal{X}}) \in ^L Top(T_{disc}(k))$,
such that locally $(\mathcal{X},\mathcal{O}_{\mathcal{X}})$ is of the form $\Spec A = (\Sh(A_{\'et}), \mathcal{O}_A)$,
for some derived ring $A$.
\end{defin}

In practice, $(\mathcal{X},\mathcal{O}_{\mathcal{X}})$ is a derived DM stack if there exist $U_i \in \mathcal{X}$ such that:
\begin{enumerate}
\item $(\mathcal{X}_{/U_i}, \mathcal{O}_{\mathcal{X}}|_{U_i}) \cong \Spec A_i$;
\item $U= \coprod_i U_i \to 1_{\mathcal{X}}$ is an effective epimorphism (i.e. $\pi_*(U) \to \pi_*(1_{\mathcal{X}})$ is surjective).
\end{enumerate}

\begin{defin}
We say that $(\mathcal{X},\mathcal{O}_{\mathcal{X}})$ is a \textbf{derived algebraic space} if we can take $U_i$ as above such that
$U_i \to 1_{\mathcal{X}}$ is a monomorphism for all $i$.
\end{defin}

A key property of maps of derived schemes:
\begin{prop}
The following diagram is a homotopy pullback:
\[
\begin{tikzcd}
\Map_{\Sh_{cdga}(\mathcal{X})} (f^{-1}\mathcal{O}_{\mathcal{Y}}, \mathcal{O}_{\mathcal{X}}) \arrow{r}\arrow{d} &
\Map_{d Sch} \big( (\mathcal{X},\mathcal{O}_{\mathcal{X}}), (\mathcal{Y},\mathcal{O}_{\mathcal{Y}}) \big)\arrow{d} \\
(f^{-1},f) \arrow{r} & \Map_{^L Top}(\mathcal{X}, \mathcal{Y})
\end{tikzcd}
\]
\end{prop}

So far so good; but recall that requirement \ref{env1} for the environment gluing category was that it admits a fully
faithful embedding from the affine category. The following, Theorem 2.1.12 in \cite{DAG-V}, addresses this. Note that
the proof is difficult.\todo{understand and say why}

\begin{thm}
The embedding $\Spec : sc\cA lg_k \to ^L Top(T_{disc}(k))$ is fully faithful.\footnote{Essentially one needs to prove that
$\Map(\mathcal{X}, \Spec A) \simeq \Map(A, \Gamma(\mathcal{O}_{\mathcal{X}}))$.}
\end{thm}



\section{Functor of points}
Recall that we defined $^R Top(T_{disc})$ the $\infty$-category of locally ringed $\infty$-topoi. Then we defined the
full subcategory: $DM-Stacks \subset {^R Top}(T_{disc})$ with objects $(\mathcal{X},\mathcal{O}_{\mathcal{X}})$ satisfying:
there exist objects $U_i \in \mathcal{X}$ such that:
\begin{enumerate}
\item $\coprod U_i \to 1_{\mathcal{X}}$ is an effective epimorphism;
\item $(\mathcal{X}_{/U_i}, \mathcal{O}_{\mathcal{X}/U_i}) \simeq \Spec (A_i)$, for $A_i \in sCRing$.
\end{enumerate}

Recall also that, if $A \in sCRing$, then $\Spec A$ was defined as:
\begin{enumerate}
\item $\mathcal{X}_A = \Sh (A_{et}, \tau_{et})$;
\item $\mathcal{O}_A : A_{et} \to scRing_k$
\end{enumerate}

\begin{thm}[DAG-V, Theorem 2.12]
If $(\mathcal{X},\mathcal{O}_{\mathcal{X}}) \in {^R Top}^{loc}(T_{disc})$, there is a canonical equivalence:
\[	\Map_{{^R Top}^{loc}(T_{disc})}\big( (\mathcal{X},\mathcal{O}_{\mathcal{X}}), \Spec A\big)
\simeq \Map_{sCRing_k}\big.(A,\Gamma(\mathcal{O}_{\mathcal{X}})\big)	\]
\end{thm}

\begin{cor}
$\Spec : sCRing_k \to {^R Top}^{loc}(T_{disc})$ is fully faithful.
\end{cor}

\begin{rem}
If $(\mathcal{X},\mathcal{O}_{\mathcal{X}})$ is a dDM, then it is a derived algebraic space if the following equivalent
conditions are satisfied:
\begin{enumerate}
\item $U_i \to 1_{\mathcal{X}}$ are homotopy monomorphisms (think inclusion of open sets);
\item $\mathcal{X}$ is the \'etale topos of an ordinary algebraic space.
\end{enumerate}
\end{rem}

\begin{rem}
There is no internal characterization of schemes, as opposed to algebraic spaces. The reason is that with these definitions
the underlying $\infty$-topos of $\Spec A$ is 1-localic and not 0-localic.
However, note the following.
What we called $\Spec$ is usually denoted $\Spec^{\'et}$, as opposed to $\Spec^{Zar}$, defined as $\Spec^{Zar}(A) 
= (\mathcal{X}_A^{Zar},\mathcal{O}_{A})$, where $\mathcal{X}_A^{Zar} = \Sh(A_{Zar}, \tau_{Zar})$. If we use $\Spec^{Zar}$,
derived schemes can be characterized as derived DM stacks which are covered by monomorphisms.
\end{rem}

\begin{rem}
There's a way of taking the topology into account inside $T_{disc}$. That is, there is a modified version of Lawvere theory
which takes into consideration also the Grothendieck topology. This is called (pre)geometry. It gives extra flexibility
that allows to freely switch between different topologies. This language is also used in the analytic setting. (Complex or
non-archimedian.) Then we get:
\[
\begin{tikzcd}
^R Top(T_{Zar})\arrow{r}{\Spec_{Zar}^{\'et}} & ^R Top(T_{\'et})\arrow{r}{\Spec_{\'et}^{an}} & ^R Top(T_{an}(\C)) \\
d Sch\arrow[hook]{u} & dDM\arrow[hook]{u} & d An_{\C}\arrow[hook]{u}
\end{tikzcd}
\]
Moreover, the ``\'etalification'' functor takes $\Spec^{Zar}$ to $\Spec^{\'et}$. 
Note also that the analytification functor can be constructed by hand, but we need the abstract machinery to prove
that the construction is correct. More details about this are in \cite{DAG-V}.
\end{rem}
\todo{the stuff so far should be merged with the previous section}


Now we actually move on to the functor of points. Say $\cC$ is a category of (derived) affines. We want to enlarge 
$\cC$ in order to allow general gluings. This can be performed in 3 steps:
\begin{enumerate}
\item Add all colimits to $\cC$, i.e. take the $\infty$-category $\PSh(\cC)$.
\item Realize that this destroys all geometric information in $\cC$.
\item Replace presheaves $\PSh(\cC)$ with sheaves $\Sh(\cC,\tau)$, for an appropriate Grothendieck topology $\tau$.
\end{enumerate}

For an example of why presheaves lose geometric information in $\cC$, consider $X, Y \in \cC$, and suppose 
the coproduct $Z = X \coprod Y$ exists.
Then we have $h_X, h_Y, h_Z \in \PSh(\cC)$. Unfortunately, $h_X \coprod h_Y \neq h_Z$. More concretely, take
$X = Y = \Spec k[x]$ to be affine lines. Then $h_X \coprod h_Y = \Map( -, \bbA^1_k) \coprod \Map(-,\bbA^1_k)$. On the other hand, we have
$h_Z = \Map(-, \bbA^1_k \coprod \bbA^1_k)$. Evaluating both on $\Spec k \coprod \Spec k$, $h_X \coprod h_Y$ gives
a point on each affine line, while $h_Z$ allows two points on the same affine line. This problem doesn't arise
when working with sheaves, rather than presheaves, because then $h_X \coprod h_Y$ is defined by applying sheafification
to the coproduct of presheaves.

\begin{rem}
A moment's thought should convince you that these ``geometric relations'' in $\cC$ are the same as a Grothendieck topology. 
The best way to explain this is the following lemma.
\end{rem}

\begin{lem}
Let $(\cC, \tau)$ be a Grothendieck site. Then $\tau$ is subcanonical (every representable preseheaf is a sheaf) if and only if
for all $U^{\bullet} \to X$ $\tau$-cover of $X$ in $\cC$, we have $X \cong \colim U^{\bullet}$.
\end{lem}

\begin{lem}
Let $(\cC, \tau)$ be a Grothendieck site. Then $\Sh(\cC, \tau)$ has the following universal property:
\begin{enumerate}
\item The functor $j:\cC \to \Sh(\cC, \tau)$ sends Cech nerves of $\tau$-covers to colimits.
\item $j$ is universal with property (1), i.e. for all $\infty$-categories $\cD$ and $F: \cC \to \cD$ such that
$F$ sends Cech nerves of $\tau$-covers to colimits, there exists a unique up to
homotopy extension $\tilde F$ making the following diagram commute.
\[
\begin{tikzcd}
\cC \arrow{r}{j}\arrow[swap]{dr}{F} & \Sh(\cC, \tau)\arrow[dashed]{d}{\tilde F} \\ & \cD
\end{tikzcd}
\]
\end{enumerate}
\end{lem}

Thus, we need to replace $\PSh(\cC)$ with $\Sh(\cC,\tau)$. The case we're primarily interested in is
 $\cC = dAff_k$, and $\tau = \tau_{\'et}$.

\begin{rem}
$\tau_{\'et}$ is subcanonical thanks to the descent for $QCoh$ that we discussed.
\end{rem}

Often in $\cC$ there are many interesting geometric notions (e.g. properness). It's not clear how to translate them for
random objects in $\Sh(\cC, \tau)$. Therefore we restrict to a full subcategory $\Geom(\cC,\tau, \bbP) \subset
\Sh(\cC, \tau)$, spanned by ``tame objects'', where the geometric notions transport in
a painless way. The idea is that every sheaf is a colimit of representable ones, but we want to restrict the diagrams which can
idex the colimit.

The original idea of geometric stack is due to Artin; it has been generalized by Simpson. Before starting, we fix a collection
of morphisms $\bbP$ in $\cC$, which are $\tau$\textbf{-local}. I.e. for $f: X \to Y$ in $\cC$, $f\in \bbP$ iff
for all $\tau$-covers $Y_i \to Y$, $X \times_{Y} Y_i \to Y_i$ is in $\bbP$. \footnote{Actually this is local on target,
we may also need local on domain.} In our case, $\tau$ is \'etale and $\bbP$ is smooth morphisms.

\begin{defin}
\begin{enumerate}
\;
\item $F \in \Sh(\cC,\tau)$ is (-1)-geometric if it's representable ($F = \Spec^f(A)$, where $f$ stands for functor).
\item A morphism $f:F\to G$ is (-1)-geometric if for all $X \in \cC$ and all $h_X \to G$, $h_X \times_G F$ is representable.
In other words, there is some $Y$ making the following diagram cartesian.
\[
\begin{tikzcd}
h_Y \arrow{r}\arrow{d} & F\arrow{d} \\ h_X \arrow{r} & G
\end{tikzcd}
\]
\item An $n$-atlas of $F \in \Sh(\cC,\tau)$ is an epimorphism $\pi : U \to F$ such that $U$ is (-1)-geometric,
$\pi$ is $n-1$-geometric and $\pi$ is $n-1$-$\bbP$.
\item $F \in \Sh(\cC,\tau)$ is $n$-geometric if it has an $n$-atlas and $F \to F\times F$ is $n-1$-geometric.
\item A morphism $f:F \to G$ is $n$-geometric if for all $h_X \to G$, $h_X \times_G F$ is $n-1$-geometric.
\end{enumerate}
\end{defin}

\begin{rem}
If you start with affine schemes, 0-geometric is algebraic spaces.
\end{rem}

\begin{rem}
Let $F$ be a geometric stack, and let $\pi : U \to F$ be an $n$-atlas. Then $U^{\bullet} = \check{C}(U\to F)$ is a groupoid,
and each level $U^k$ is $n-1$-geometric. Moreover, $|U^{\bullet}| \simeq F$, and the transition morphisms are in $\bbP$.
The converse is also true: given a groupoid where transition morphisms are in $\bbP$, the geometric realization is a geometric
stack.
\end{rem}

\begin{rem}
In $\cC = d\Aff_k$, it's not necessary to ask $F \to F \times F$ to be $n-1$-geometric.
\end{rem}

\begin{rem}
There's always a cheap way of extending geometric properties of morphisms in $\cC$ to analogous properties of geometric
stacks. This goes by induction. But caution: this is not necessarily the best thing to do, e.g. properness has to be dealt with
more cleverly. 
\end{rem}

\begin{rem}
In the specific case $\cC = d\Aff_k$, given $F:d\Aff_k^{\op} \to \cS$, we consider the composition:
\[
\begin{tikzcd}
\Aff_k^{\op} \arrow[hook]{d} \arrow{r}{t_0(F)} & \cS \\ d\Aff_k^{\op} \arrow[swap]{ur}{F} &
\end{tikzcd}
\]
We call this
\textbf{truncation}. The truncation functor preserves geometric stacks, as well as finite limits. Moreover, $t_0(\Spec(A))
= \Spec^f(\pi_0(A))$.
\end{rem}

\begin{rem}
If $F$ is a derived geometric stack, then in general $F$ is not truncated. For example, take $A = k[x]$, 
$F = \Spec A$, $F(B) = \Map(\Spec B,\Spec A) = \Map_{sCR_k}(A,B) \cong B$, the underlying topological space of $B$. This can
be arbitrarily complicated. However, $t_0(F)$ always factors through $\cS^{\leq n}$ for some $n$. More precisely,
if $F$ is $n$-geometric, then $t_0(F)$ is $n+1$-truncated. The proof is simple, by induction on the geometric level.
\footnote{In fact, this is how most proofs go for geometric stacks.}
\end{rem}

\begin{rem}
When $\bbP$ is smooth, we call $\Geom(d\Aff_k, \tau_{\'et}, \bbP)$ \textbf{derived Artin stacks}. When $\bbP$ is \'etale,
we call $\Geom(d\Aff_k, \tau_{\'et}, \bbP)$ \textbf{ derived Deligne-Mumford stacks}.
\end{rem}

From now on, we only consider the case $\cC = d\Aff_k$.

\begin{lem}
$F \in \Geom(d\Aff_k, \tau_{\'et}, \bbP)$, there exists a functor of the form: 
\begin{align*}
F_{\'et} &\to t_0(F)_{\'et} \\
\big(G \overset{\'et}{\to} F\big) & \mapsto \big( t_0(G) \overset{\'et}{\to} t_0(F)\big),
\end{align*}
which is a Morita equivalence.
\footnote{This means that the categories of sheaves on them are equivalent.} Note that $F_{\'et}$ is the small
\'etale site, which considers derived affines mapping into $F$ via \'etale maps.
\end{lem}

\begin{cor}
\label{cor:stack_ncat}
For $F \in \Geom(d\Aff_k, \tau_{\'et}, \bbP)$, if $F$ is $n$-geometric, then $F_{\'et}$ is an $n$-category.
\end{cor}

\begin{rem}
Let $F,G \in \Geom(d\Aff_k, \tau_{\'et}, \bbP)$ and $f :F \to G$. The pullback $G_{lis-\'et} \to F_{lis-\'et}$
\footnote{These sites are called \textbf{lisse-\'etale}, which means that $\bbP$ is the class of smooth morphisms but the
topology $\tau$ is \'etale.} does not induce a geometric morphism of topoi. There is an adjunction:
\[	f^* : \Sh(G_{lis-\'et}, \tau_{\'et}) \to \Sh(F_{lis-\'et}, \tau_{\'et}) : f_*,	\]
but $f^*$ does not preserve finite limits. The reason for this, approximately, is that certain pullbacks don't exist
in the lisse-\'etale site. If we use the \'etale site, given two \'etale morphisms $X \to G$, $Y\to G$,
any morphism between them is forced to be \'etale as well. But this is no longer true when using the lisse-\'etale site.
This is a thorny problem, but it can be avoided if one is content with working with
coherent sheaves.
\end{rem}


\section{Comparison of approaches}

\begin{thm}
Let $dDM^{loc}$ be the $\infty$-category of structured derived DM-stacks $(\mathcal{X}, \mathcal{O}_{\mathcal{X}})$, where
$\mathcal{X}$ is $n$-localic for some $n$. Let $dDM^f := \Geom(d\Aff_k,\tau_{\'et}, \bbP_{\'et})$ be derived DM-stacks
obtained from the functor of points. Then there is an equivalence:
\[	dDM^{loc} \simeq dDM^f	.\]
\end{thm}
\begin{proof}
The construction $dDM^{loc} \to dDM^f$ takes $(\mathcal{X}, \mathcal{O}_{\mathcal{X}})$ and sends it to the functor
$F: dAff_k^{\op} \to \cS$, which maps $B$ to $\Map(\Spec^{\'et}(B), (\mathcal{X}, \mathcal{O}_{\mathcal{X}}))$.
$\mathcal{X}$ localic means that $F$ satisfies hyperdescent.

In the other direction, pick $F$ and send it to $\big(\Sh(F_{\'et},\tau_{\'et}), \mathcal{O}_F\big)$. Thanks to Corrolary
\ref{cor:stack_ncat} $\Sh(F_{\'et},\tau_{\'et})$ is n-localic.
\end{proof}




\section{Descent and infinitesimal theory}
How do we define $QCoh(F)$ for a sheaf $F$? We would like it to be the dashed arrow in the diagram: 
\[
\begin{tikzcd}
d\Aff_k^{\op}\arrow{d}\arrow{r}{QCoh} & \Pr^L \\
\Sh(d\Aff_k, \tau_{\'et})\arrow[dashed, swap]{ur}{\underline{QCoh}}
\end{tikzcd}
\]
Then one defines $\underline{QCoh}(F)$ as the
\textbf{mapping stack} $\underline{Map}(F,QCoh)$. In turn, this is defined as the adjoint of $- \times F$. 
That is, the functor of points of a mapping stack is:
\[	\Map(\Spec A, \underline{Map}(F,QCoh)) = \Map(\Spec A \times F, QCoh) .	\]

This is the same as setting $\underline{QCoh}(F) := \lim QCoh(A)$, where
the limit is taken over $\Spec(A) \to F$.

\begin{rem}
This makes sense for every sheaf $F$. If $F$ is geometric, then we can restrict to the lisse-\'etale site when taking the limit.
\end{rem}

\begin{defin}
Let $F \in \Sh(d\Aff_k, \tau_{\'et})$. Then:
\begin{enumerate}
\item Let $x : \Spec A \to F$, we say that $F$ \textbf{has a cotangent complex at} $x$ if there exists an object
$\bbL_{F,x} \in QCoh^-(A)$ such that for all $M \in QCoh(A)$, $\Map_{QCoh(A)}(\bbL_{F,x}, M) \simeq Der_F(A;M)$. 
Here the $F$\textbf{-linear derivations} $Der_F(A;M)$ are defined as the pullback:
\[
\begin{tikzcd}
Der_F(A;M)\arrow{d}\arrow{r} & \Map\big(\Spec(A\oplus M), F\big)\arrow{d}{0} \\ * \arrow[swap]{r}{x} & \Map(\Spec(A),F) .
\end{tikzcd}
\]
\item $F$ \textbf{has a global cotangent complex} if it has a cotangent complex at $x$ for every $x : \Spec(A) \to F$, and 
moreover there exists $\bbL_F \in \underline{QCoh}(F)$ such that for all $x$, $x^* \bbL_F \cong \bbL_{F,x}$. 
\end{enumerate}
\end{defin}

\begin{thm}
If $F$ is geometric, then it has a global cotangent complex.
\end{thm}

\begin{rem}
If $F$ is dDM, then $\bbL_F$ is connective, i.e. concentrated in non-positive degrees. However, if $F$ is Artin $n$-geometric,
then $\bbL_F$ is concentrated in degrees $(-\infty, n]$. \todo{$\pm 1$}
\end{rem}






\chapter{The Stack of Perfect Complexes}
\label{chap:stack_perf}
Talk by Sukjoo Lee.

We first define $\Perf(X)$, then prove the geometricity of $\Perf$ and $\Perf(X)$. We proceed to describe the tangent complex
of these. Finally, we describe the perfect determinant map and construct the Atiyah class.

\section{The Sheaf Perf}
Recall we defined $\QCoh : d\Aff^{\op} \to \cS$, and extended it to $\underline{QCoh}: \Sh(d\Aff, \tau_{\'et}) \to \cS$.
In particular, if $X$ is a scheme, we'll write $\QCoh(X)$ for $\underline{Map}(X,\QCoh)$. We also defined
$\Map(\Spec A, \underline{Map}(X,\QCoh)) = \Map(X \times \Spec A, \QCoh)$.

Now for $X$ a smooth and proper $k$-scheme, we define $\Perf : d\Aff^{\op} \to \cS$, sending $A \mapsto (A-mod)^{perf}$.
Morphisms are given by base change, and this is ok, since perfect modules are stable under base change.\footnote{Note that,
as always, to make this definition rigorous, we need to define the functor using co-cartesian fibrations.}
Then $\Perf(X) := \Map(X, \Perf)$.

Note that, for smooth schemes, $\Perf$ and $\Coh^b$ are the same, but in our case it's essential that we don't restrict to $A$
smooth. Moreover, $\Coh^b$ is not functorial, because base change can kill the boundedness. Actually $\Perf$ and $\Coh^-$ are
the only ones that are functorial.


\section{Geometricity}
\begin{thm}
$\Perf$ and $\Perf(X)$ are locally geometric and locally of finite presentation.
\end{thm}

\begin{defin}[Properties of stacks]
\begin{enumerate}[(a)]
\item A stack $F$ is \textbf{quasi-compact} if there exists a representable stack $X$ and a covering map $X \to F$.
\item A morphism of stacks is \textbf{quasi-compact} if for every representable $X$, $X \times_F G$ is quasi-compact.
\item is \textbf{strongly quasi-compact} if for arbitrary $X, Y$ representable stacks and maps to $X$, the $n-1$-geometric
stack $X \times_F Y$ is strongly quasi-compact. This is an inductive definition, where at level -1 it just means quasi-compact.
\item Morphism is strongly quasi-compact.
\item A representable stack $F \simeq \Spec A$ is \textbf{finitely presented} if for every filtered system of objects
$B_i \in CAlg_k$ we have:
\[	\colim_i \Map(A,B_i) \simeq \Map(A, \colim_i B_i).	\]
\item A stack $F$ is \textbf{locally finitely presented} if there exists n- atlas $\mathcal{X}_i$ such that each is
finitely presented.
\item Strongly finitely presented means 1-finitely presented and quasi-compact.
\end{enumerate}
\end{defin}

\begin{rem}
All these definitions are stable by pull-backs and retracts.
\end{rem}

\begin{defin}
$F$ is \textbf{locally geometric} if it can be written as a filtered colimit $F \simeq \colim_i F_i$, such that each $F_i$
is n-geometric ($n$ can depend on $i$!), and $F_i \to F$ is mono (i.e. $F_i \to F_i \times_F F_i$ is iso.)
\end{defin}

\begin{lem}
For $f : F \to G$ $n$-representable, if $G$ is n-geometric, then so is $F$.
\end{lem}

Let's begin the proof of the theorem.

\begin{rem}
We can define $\Perf^{[a,b]} \subset \Perf$ to consist of the complexes which have tor amplitude contained in $[a,b]$. This
is an open immersion, which means that amplitude is stable under quasi-isomorphism.
Note that $\Perf = \cup_{a\leq b} \Perf^{[a,b]}$, which exhibits $\Perf$ as a union of connected components.
 Moreover, we can define $\Perf(X)^{[a,b]}$ to be the homotopy pullback:
\[
\begin{tikzcd}
\Perf(X)^{[a,b]} \arrow{r}\arrow{d} & \Perf^{[a,b]}\arrow{d} \\
\Perf(X) \arrow{r} & \Perf .
\end{tikzcd}
\]

But we actually need to be careful with how we define the bottom map. We need to choose a compact generator $E$ of
the $\infty$-category $\Perf(X)$ of perfect complexes on $X$. \todo{Put reference to Toen, Vaquie, Moduli of objects}

We obtain $\Perf(X) = \cup_{a\leq b} \Perf(X)^{[a,b]}$.
\end{rem}

So the strategy of the proof is:
\begin{itemize}
\item $\Perf^{[a,b]}$ is $n$-geometric and locally f.p. for $n = b-a+1$. It follows that $\Perf$ is locally geom and locally f.p.
\item For $\Perf(X)$, we show that $\Perf(X)^{[a,b]} \to \Perf^{[a,b]}$ is $n$-representable, and then use Lemma. \todo{ref lemma}
\end{itemize}

Step 1. We want to find a cover $\pi : U \to \Perf^{[a,b]}$ such that $U$ is $n-1$-geometric and l.f.p., and $\pi$ is $n-1$
representable, smooth covering.

$U : CAlg_k \to \cS$ is defined to map $A$ to the space of morphisms in $A-mod$ consisting of $u: Q \to R$, where
$Q \in \Perf(A)^{[a,b-1]}$ and $R \in \Perf(A)^{[b-1,b-1]}$. Then $\pi: U \to \Perf^{[a,b]}$ is defined to take
$u:Q \to R$ to $hofib(u)$.

In order to show that $U$ is n-1 geometric, we build some map $p$ from $U$ to an $n-1$ geometric stack, and then show the map
is $n-1$ representable. If $a = b$, then $\Perf^{[a,b]} \simeq \underline{Vect}$, which is a 1-geometric stack and
locally f.p. This is because $\underline{Vect} = \cup_n B GL(n)$, and each of $B GL(n)$ is Artin, by groupoid presentation.
We make the inductive assumption that $\Perf^{[a,b-1]}$ is n-1-geometric. Then define the map:
\begin{align*}
p : U &\to \Perf^{[a,b-1]} \times \underline{Vect} \\
u:Q \to R &\mapsto (Q, R[b-1]) .
\end{align*}
$p$ is n-1 representable; in fact, it's representable. \todo{TV lemma 3.9; maybe add more details about this}

\begin{lem}
Diagonal of $\Perf^{[a,b]}$ is $n-1$-representable.
\end{lem}

Smooth: by the infinitesimal criterion for smoothness in HAG II, 2.2.2.

Covering: for all $P \in \Perf^{[a,b]}(A)$, we can find vector bundle $E$ in $\Spec(A)$, and a morphism $E[-b] \to P$ whose
cofiber $Q$ is contained in $\Perf^{[a,b-1]}$. Writing down the resulting fiber sequence, $P$ is a homotopy fiber
of $Q \to E[-b+1]$. 

Step 2. We need to show that $\Perf(X)^{[a,b]} \to \Perf^{[a,b]}$ is $n-1$ representable and strongly f.p. 
First we do a reduction to $X = \Spec B$, where $B$ is homotopically f.p. and:
\[
\begin{tikzcd}
 \pi^{-1}{p} & \Spec A \arrow{d}{p} \\
\Perf(X)^{[a,b]}\arrow{r}{\pi} & \Perf^{[a,b]}
\end{tikzcd}
\]
$\pi^{-1}(p) = \underline{Map}(B,\epsilon(p))$, where $\epsilon(p) := End_{A-mod^{perf}}(p,p)$;
\todo{paper} Lemma from TV 3.13 and 3.14, and 3.9 retraction

\section{Tangent complex}
Since $\Perf$ and $\Perf(X)$ are locally geometric, there exists a tangent complex. Since they are locally f.p., it is a perfect
complex.

\begin{rem}
There exists global tangent complex and it is a perfect complex. But for now we only compute it locally.
\end{rem}

\begin{thm}
\label{thm:tangent_perf}
$T_E \Perf(X) = End_{\Perf(X)}(E,E) [1]$. 
\end{thm}
\begin{proof}
$E : * = \Spec k \to \Perf(X)$, construct:
\begin{align*}
\Omega_E \Perf(X) : CAlg_k &\to \cS \\
A &\mapsto 
\end{align*}
\end{proof}


\begin{rem}
In particular, this recovers the entire deformation theory for vector bundles, by taking $E$ to be in degree 0. The shift means
that we recover $\Ext^1$. 
\end{rem}


\section{The Determinant Functor}
\begin{defin}
The \textbf{Picard stack} is $\Pic(X) = \Map(X, B G_m)$.
\end{defin}

Note that $\Pic \simeq Vect_1 \subset \Perf$. We want to construct $detperf: \Perf \to \Pic$, by using Waldhausen K-theory.
\begin{enumerate}
\item $\det : Vect \to \Pic$.
\item Simplicial stacks:
\end{enumerate}

\todo{paaaaper}

\begin{prop}
For all points $x_E: \Spec k \to \Perf(X)$, we get \todo{paper}
\end{prop}

\begin{defin}
$\mathcal{Y}$ geometric stack having a perfect cotangent complex, $E$ is a perfect complex on $\mathcal{Y}$ is the same as
$\phi_E : \mathcal{Y} \to \Perf$. \todo{paper}
\end{defin}


\begin{thm}
There is an equivalence $FMP_k \to dgLie_k$, which sends a formal moduli problem $F$ to $T_F[-1]$. In particular, if we
take the formal completion $\mathcal{Y}_x$, it gets sent to $x^* T_y[-1]$.
\end{thm}

Fact: the Lie algebra structure on $x^* T_Y[-1]$ is given by the Atiyah class. Nmely, the bracket is \todo{paper}




\chapter{D-modules}
Talk by Benedict Morrissey.

\section{Introduction and motivation}

We want to talk about differential equations in the setting of AG. It's all classical AG today, but things will go south starting
next week. We also want to talk about quantization: replace functions on the classical phase space ($\mathcal{O}(T^*X)$) with
differential operators on $X$ ($\mathcal{D}(X)$).

There's also motivation from representation theory: Beilinson-Bernstein says roughly that $Rep(\mathcal{U}(\mathfrak g))
\simeq \mathcal{D}_{G/B} - mod$.

The setting is $X$ smooth complex projective variety. We introduce sheaf of noncommutative algebras: $\mathcal{D}_X
 = Der_{\mathcal{C}_X}(\mathcal{O}_X)$. Say $U \subset X$ is a coordinate chart, with coordinates $y_1, \dots, y_n$,
$\mathcal{D}_X$ is generated by $[y_i, \partial_j] = \delta_{ij}$.

First thing to notice is that $\mathcal{D}_X$ acts on $\mathcal{O}_X$ on the left. Therefore $\mathcal{D}_X(U)$ also
acts on the distributions $\mathcal{O}_X(U)^*$ on the right.\footnote{$\mathcal{O}_X(U)$ should be the analytic sheaf.}

Say $f$ is the solution of a differential equation on $X$, e.g.:
\[	(\partial_x - \lambda) f = 0. 	\]
then $\mathcal{D}_X \dot f = \mathcal{D}_X / (\partial_x - \lambda) f$, and we call this $\mathcal{D}$-module
$M_{e^{\lambda x}}$. Then $\Hom_{\mathcal{D}_X -mod}(M_{e^{\lambda x}}, C^{\infty}(\bbA^1))$ is in bijective
correspondence with solutions to the differential equation.

Note also that this sheaf of solutions is a local system. 


\section{Operations on D-modules}
\begin{eg}
We start with pullback. If $f:X \to Y$, and $N \in \mathcal{D}_Y$ is a D-module, we define:
\[	p^*N = \mathcal{O}_X \otimes_{f^{-1} \mathcal{O}_Y} f^{-1} N.	\]
So far, this is just a sheaf of $\mathcal{O}_X$ modules. We also need to define an ation by derivations $\theta \in \mathcal{D}_X$,
as follows. \todo{paper} Taking coordinates $\{y_i\}$ on $Y$,
\[	\theta(\psi \otimes s) = \theta(\psi) \otimes s + \psi \sum_{i=1}^n \theta(y_i \circ f) \otimes \partial_i(s).	\]
Note that, if the D-module is one of functions, this is the same as pulling back the function to $X$, and then acting by differentition.
\end{eg}

Direct image is more annoying; we need to use complexes of D-modules for it to be meaningful. We define:
\[	f_* M = \mathcal{D}_{Y , X} \otimes^{\bbL}_{\mathcal{D}_X} M.	\]
Here $\mathcal{D}_{Y , X}$ is a $\mathcal{D}_Y - \mathcal{D}_X$ bimodule defined as follows. \todo{paper}


Fourier transform of $\mathcal{D}$-modules. Think about functions first: we pull back functions from $\bbA^1$ to
$\bbA^2$, multiply with a function (kernel) there, and then push forward to the second factor of $\bbA^1$.
For $\mathcal{D}$-modules, this is done as follows:
\[	F(M) = p_{2*} \big( (p_1^* M) \otimes M_{e^{2\pi i xy}} \big) . \]


\section{Characteristic Variety}
We next investigate how the $D$-module relates to the geometry of the solution set of the associated differential equation.
We take the associated graded \todo{enter more details here}, and $\Spec (\mathcal{D}_X^{gr}) = T^*X$, as long as $X$ is
smooth. For any D-module $M$, the associated graded $M^{gr}$ is a coherent $\mathcal{O}(T^*X)$-module. Then we associate
the \textbf{character variety} $ch(M) =  sup(M^{gr}) \subset T^*X$.

We have a functor $D_X -mod \to \mathcal{O}_X -mod$, $sol_X (M) = \R \Hom_{\mathcal{D}_X}(M,\mathcal{O}_X)$.
There's an easier functor to work with, the deRHam functor, which does: $DR_X(M) = M \otimes \Omega_X^{\bullet}$.
There's a duality $DR_X(M) = sol(D_X M)$, where \todo{paper}

\begin{defin}
$\eta \in T^*_x X$ is \textbf{non-characteristic} if for any division of $X$ into level sets of $h$ such that $dh = \eta$,
$dR(M)$ is locally constant transverse to level sets.
\end{defin}

\begin{thm}[Cauchy-Kovalevski]
The set $\{\eta \in T^*X \text{ characteristic}\} = ch(M)$.
\end{thm}

We have $\dim(ch(M)) \geq \dim(X)$; if equality holds, we call $M$ \textbf{holonomic}.

If $M$ is holonomic, $dR(M)$ is really nice, in the sense that $H^i(dR(M))$ is locally ocnstant on the strata of some 
stratification of $X$, $X = \bigsqcup_{\alpha \in \Lambda} X_{\alpha}$. Think about solutions to the logarithm,
whose associated D-module is locally constant on the strata $\C = \C^{\times} \sqcup \{0\}$.

\begin{defin}
A D-module $M$ is \textbf{regular} if for all $x\in X$, $\R \Hom_D(M_x, \mathcal{O}_x) \cong \R \Hom_D(M_x, \hat{\mathcal{O}_x})$.
\end{defin}

\begin{rem}
This can be promoted to a categorical statement, whereby regular holonomic $\mathcal{D}$-modules correspond under the deRham functor
to constructible complexes. THis is the Riemann-Hilbert correspondence.
\end{rem}


\section{More general spaces}
We can embed a singular variety $X$ in a nonsingular $Y$. A theorem of Kashiwara tells us that the following is well-defined:
\[	\mathcal{D}_X -mod = \{ U \in \mathcal{D}_Y -mod| supp_{\mathcal{O}_Y}(U) \subset X \}.	\]

Quotient stacks: $X = Y / G$, where $Y$ is smooth and $G$ is a reductive algebraic group. We want to relate D-modules on $X$
to D-modules on $Y$ with a strong equivariance property.

\begin{defin}
A D-module $M$ on $Y$ is \textbf{strongly equivariant} if there's an equivalence $\alpha : act^* M \to p^* M$ of
$\mathcal{D}_G \otimes \mathcal{D}_Y$-modules, where the latter is $p_1^* \mathcal{D}_G \otimes p_2^* \mathcal{D}_Y$.
\footnote{Change to square tensor}. This has to satisfy some compatibility condition \todo{paper}
\end{defin}


\section{Representation theory}
Beilinson-Bernstein theorem. $G$ acts on $G/B = Fl$. Infinitesimally this gives a map $\mathfrak g \to T_p Fl$, ie.
$\mathfrak g \to $ Vector fields on $Fl$. This extends to a map:
\[	\mathcal{U}(\mathfrak g) \to \mathcal{D}_{Fl}.	\]
Then given a line bundle $\mathcal{L}^{\chi}$ on $G/B$, we get $\mathcal{D}^{\chi}$ acting on the sections of $\mathcal{L}$.
Note that $Fl$ is the moduli space of Borels. Given a character $\chi : T \to \C$, I get a character on $B$ by
precomposing with the projection $B\to T$, i.e. the character is trivial on strictly upper-triangular matrices.

There's a theorem by Harish-Chandra saying that, to such a character, we can associate \todo{paper}. Then the theorem says that,
for $\chi$ regular, we have $\mathcal{U}(\mathfrak g)^{\chi}-mod = \mathcal{D}_{FL}^{\chi} - mod$.


\section{Nearby and vanishing cycles}
Say I have a family of algebraic varieties which degenerate at some point. Say I have the family of tori over $\C$ given by
$y^2 = x(x-a)(x-2a)$. But over 0 I have the cuspidal cubic $y^2 = x^3$. We want to use data about the nearby nice objects to
talk about the singular object.

The general setup is:
\[
\begin{tikzcd}
X_0\arrow{r}\arrow{d} & X \arrow{d} & X^{\times} \arrow{l}\arrow{d} \\
\{0\} \arrow{r} & \C & \C^{\times} \arrow{l}.
\end{tikzcd}
\]

Nearby cycle functor: \todo{paper}

Theorem: if $f$ is a proper map, then there exists $U$ of $X_0$ in $X$ such that $q:U \to X_0$ is continuous and homotopes to
identity on $X_0$. 


Silly example: if $X = \C$, $M$ is a $\mathcal{D}$-module on $\C^{\times}$, $K = DR(M)$. If we take $f$ to be the identity, then
$\psi_f(K) \cong K_{X_{\epsilon}}$. We have a monodromy operator $T: \psi_f(K) \to \psi_f(K)$, sending $a \mapsto a + c$.
If $K$ comes from logarithm, this is $a \mapsto a + 2\pi$. 

If $M$ is holonomic, from adjunction we have a unit map $M \mapsto p_* p^* M$ (need holonomic to have $p^* = p^!$).
Then we have an exact triangle in the derived category, $i^*M \to \psi_f(M) \to \Psi_f[K](1) \to \dots$, the 
latter is the \textbf{vanishing cycle}.

An application to geometric representation theory: \todo{paper}.

More generally, can take parabolic $P \subset G$. We have the projection $q: G[[t]] \to G$, and take $\bar P = q^{-1}(P)$.
Then $\bar P$-equivariant constructible sheaves on $G((t))/\bar P$ should be equivalent to representations of some other group.
Now take a family over $X$ a Riemann surface; this is related to the vanishing cycle, but none of us understand this yet.



\chapter{D-modules: de Rham space perspective}
Talk by Benedict Morrissey.

We will relate these to crystals, and use this to describe D-modules in DAG. In particular, we work towards the following.

\begin{thm}
If $X$ is a smooth scheme, then $Crys(\QCoh(X)) \simeq D_X - mod$ is an equivalence of categories.
\end{thm}

\section{Classical setting}
\label{sect:dmod_class}

\begin{defin}
A \textbf{crystal} of quasi-coherent sheaves on $X$ is $\mathcal{F} \in \QCoh(X)$ with the following data. For every map
from an affine scheme $x : \Spec R \to X$, let $\mathcal{F}_x = x^* \mathcal{F}$. Let $I$ be the nilpotent ideal of $R$,
and consider the sequence of maps:
\[	\Spec (R/I) \to \Spec R \overset{x,y}{\to} X.	\]
We say $x,y$ are \textbf{arbitrarily close} if the associated $R/I$ points are equal. We also need the choice of:
\[	\eta_{x,y} : \mathcal{F}_x \to \mathcal{F}_y	\]
an isomorphism of $R$-modules, satisfying a cocycle condition: $\eta_{x,z} = \eta_{y,z} \circ \eta_{x,y}$.
\end{defin}

\begin{defin}
The \textbf{de Rham prestack} is defined via the functor of points:
\[	X_{dR}(R) = X(R/I) .	\]
\end{defin}

Note that crystals are very similar to quasi-coherent sheaves on $X_{dR}$. That's because the latter have stalks
over each $\bar x$, and we can pull these back to get stalks at each $x, y$ which are canonically isomorphic.

\begin{rem}
Recall that we haven't defined $\QCoh$ for a prestack, so what exactly we mean is problematic.
\end{rem}

\begin{proof}
\[	\Spec (R/I) \to \Spec(R) \overset{x,y}{\to} X \times X	\]
The two maps factor through the diagonal. However, the maps from $\Spec R$ don't necessarily factor through the diagonal:
we can get fat points pointing in directions perpendicular to the diagonal. However, it factors through the completion of
the diagonal.

Let's define this more precisely. $\Delta_X \in X \times X$ is defined as the vanishing of some sheaf of ideals (such
as $x-y$, but globally). In other words, $\Delta_X = \Spec_{X\times X}(\mathcal{O}_{X\times X}/I)$. Then we define
the partial formal completions:
\[	\Delta^n_X = \Spec_{X\times X} (\mathcal{O}_{X\times X}/I^n) .	\]
Finally, \textbf{the formal completion of the diagonal} is defined as the ind-scheme:
\[	\hat \Delta_X = \colim_n \Delta^n_X.	\]

Then we have that $Crys(\QCoh(X)) \cong \QCoh(\hat \Delta_X)$. \todo{not sure how to finish this, but the derived case
we do in a bit should take care of it}. For each $n$, consider the 2 projections:
\[
\begin{tikzcd}
\; & \Delta^n_X & \\
X & & X.
\end{tikzcd}
\]
Pulling back and pushing forward gives:
\[	\mathcal{F} \to \pi^{(n)}_{1*} \pi_2^{(n)*} \mathcal{F} = \mathcal{O}_X^{(n)} \otimes_{\mathcal{O}_X} \mathcal{F}.	\]
Where $\mathcal{O}_X^{(n)}$ is by definition $\pi_{1*}^{(n)}\mathcal{O}_{\Delta^{(n)}_X}$.

Now let $\mathcal{D}_X^{\leq n}$ be differential operators of order $\leq n$.
\[	\mathcal{D}_X^{\leq n} \otimes_{\mathcal{O}_X} \mathcal{O}_{X^n} \to \mathcal{O}_X	\]
given by $(Dg)(x) = Dg(x,x)$. $g$ is a function of $x$ and $y$, consider $X$ fixed, and $y$ is varying locally around it.
Act the differnetial operators as if it's just a function of $y$. Get a new function, and evaluate it at $(x,x)$.
\end{proof}

\begin{eg}
$X = \bbA^1$, $\mathcal{O}_X = k[x]$. $\mathcal{O}_X^{(n)} = k[x,y]/(x-y)^{n+1}$. The latter has a basis as
a $k[x]$-module, given by $\{(x-y)^k\}_{0\leq k \leq n}$. Moreover:
\[	\mathcal{D}_X^{\leq n} = \left\{ \frac{1}{k!} \frac{\partial^k}{\partial y^k} \right\}	\]
as $k[x]$-module.
\end{eg}

\begin{lem}
If you act by differential operators twice, you get a commutative diagram:
\[
\begin{tikzcd}
\mathcal{D}_X \otimes_{\mathcal{O}_X} \mathcal{D}_X \otimes_X \mathcal{F} & \mathcal{D}_X \otimes_X \mathcal{F} \\
\mathcal{D}_X \otimes_X \mathcal{F} & \mathcal{F}.
\end{tikzcd}
\]
\end{lem}

Summing up, we have the chain of equivalences $Crys(\QCoh(X)) \cong \QCoh(\hat \Delta_X) \cong \mathcal{D}_X - mod$.


\section{Derived setting}
Recall $X_{dR}$, which we redefine as:
\[	X_{dR}(R) = X(R^{red}),	\]
where $R^{red} = H^0(R) / nil(H^0(R))$.

\begin{defin}
\textbf{Left D-modules} are:
\[	D-mod^l (X) := \QCoh(X_{dR}),	\]
where the latter are restricted to be eventually co-connective. Similarly \textbf{right D-modules} are:
\[	D-mod^r (X) := IndCoh(X_{dR}),	\]
wher the latter are restricted to be locally almost of finite type.
\end{defin}

How about the definition of $\QCoh(X)$? We'll just take $\QCoh(X) = \lim \QCoh(S)$, where the limit is taken over all
$S \to X$ derived affines. Recall also the definition of IndCoh: it's the colimit completion of $\Coh(Y)$ in
$\PSh(Y)$. Then we can define a map $\psi_Y$ as a left Kan extension:
\[
\begin{tikzcd}
\Coh(Y) \arrow{r} & \QCoh(X) \\
\IndCoh(Y) \arrow{ur}{\psi_Y} &
\end{tikzcd}
\]
These are all stable $\infty$-categories with t-structure. 

We have a natural transformation $p_{DR} : I \to DR$, which gives natural transofrmations:
\begin{align*}
D-mod^l &\to \QCoh \\
D-mod^r &\to IndCoh.
\end{align*}
\todo{here I and DR are reversed, what's up with that?}



\section{Properties}

Let's talk about descent. $D-mod^r$ satisfies fpppf, h- and etale descent on $DGSch_{aft}^{aff}$, where the subscript says
almost of finite type. \footnote{We have no idea what h- is, but it's apparently important. Also, fpppf is not a typo;
Gaitsgory and Rozenblyum add another condition which gives a third f.}

We also have an adjunction:
\[	obliv_x^r : D-mod^r(X) \to IndCoh(X) : ind_X^r,	\]
which is monadic. Therefore $IndCoh(X_{dR}) \cong T-mod (IndCoh(X))$.

T-structure. $\QCoh(Y)$ for $Y$ a prestack has a t-structure, such that for $S \to Y$, $\QCoh(Y) \to \QCoh(S)$ preserves
the t-structure. Same holds for $IndCoh$.

\begin{prop}
For $X$ a stack,
\[	D (D-mod^r(X)^{\heartsuit}) \simeq D-mod(X)	.\]
\end{prop}

\begin{rem}
This is not that surprising, since when passing from $X$ to $X_{dR}$ we're throwing out all the derived information.
\end{rem}


\section{Differential operators in the derived setting}
This relation follows closely the proof from the classical case, in section \ref{sect:dmod_class}

\begin{prop}[GR 3.1.3]
There's an equivalence:
\[	IndCoh(X_{dR}) \simeq Tot(IndCoh(X^{\bullet}/X_{dR})).	\]
The latter is defined by the \v{C}ech nerve of the natural map $X \to X_{dR}$.
\end{prop}

Let $X,Y \in DGSch_{aft}$.
\begin{prop}
$IndCoh(X)$ is cannonically self-dual, in the sense that:
\[	Funct_{cont}(IndCoh(X), IndCoh(Y)) \simeq IndCoh(X) \otimes IndCoh(Y) \simeq IndCoh(X \times Y).	\]
$Funct_{cont}$ means limit-preserving functors.
\end{prop}
\begin{proof}
Take $Q \in IndCoh(X \times Y)$. Then consider the projections:
\[
\begin{tikzcd}
\; & X  \times Y\arrow{d}{\Delta \times Id} & \\
\; & X \times X \times Y & \\
X & & X \times Y \\
& & Y .
\end{tikzcd}
\]
Run $Q$ through this to get a map from $X$ to $Y$. You need to say the words $(\Delta \times id)^! (\mathcal{F} \otimes
Q)$, but the tensor product is square.
\end{proof}

Recall the monad $T$, define $D_X^r = \alpha^{-1}(T) \in IndCoh(X\times X)$. Moreover $|X^{\bullet}/X_{dR}| \to X \times X$
is a derived analog of the completion of the diagonal. Now we have $D_X^r \simeq \Delta_*^{Indcoh}(\omega_{X \times_{X_{dR}} X})$.
\footnote{GR need to modify the pushforward slightly to make it play nicely with Indcoherent sheaves. That's what the
IndCoh superscript means. Don't worry about it too much.} $\omega$ is some notion of dualizing sheaf, which gives a generalization
of Serre duality $ - \otimes \omega_Y : IndCoh(Y) \to QCoh(Y)$.

Let $X \in DGSch_{aft}$; by Kashiwara's theorem, it suffices to take it smooth. Let $Diff_X$ be the sheaf of diff operators
in the sense ofthe previous talk; we would like to identify its action with that of $D_X^r$.

\todo{paper}

Taking $\mathcal{F}_1 = \mathcal{F}_2 = \mathcal{O}_X$, we get $\mathcal{D}_X^l \to Diff_X$.




\chapter{HKR isomorphism and shifted symplectic structures}
Talk by Matei Ionita.

We have reached the ``structured'' part of our ``structured DAG'' plan for the semester. We want to talk about shifted
symplectic structures and give examples, following \cite{PTVV}. But first we discuss some prerequisites.

\section{Affine Stacks}
For this section we follow \cite{vezzosi2013autour}, Expos\'e 10. Recall that we defined derived affine schemes as
the category opposite to $\cdga_k^{\leq 0}$. We have the following adjoint pair:
\[
\begin{tikzcd}
dSt \arrow[shift left]{r}{\mathcal{O}} & \cdga_k^{\leq 0} \arrow[shift left]{l}{\Spec} .
\end{tikzcd}
\]
The functor of global sections $\mathcal{O}$ is defined as the unique functor such that $\mathcal{O}(\Spec(A)) = A$ and
commutes with colimits. We want to extend this adjunction to cdga's that are not necessarily connective:
\[
\begin{tikzcd}
dSt \arrow[shift left]{r}{\mathcal{O}} & \cdga_k \arrow[shift left]{l}{\Spec} .
\end{tikzcd}
\]
This $\Spec$ functor is defined by $\Spec(A)(R) = \Map_{\cdga_k}(R,A)$, and then $\mathcal{O}$ is defined as a left adjoint,
like before.

\begin{defin}
A derived stack is \textbf{affine} if it is in the essential image of $\Spec$. Some authors use \textbf{co-affine}
to refer to the essential image of $\cdga_k^{\geq 0}$ under $\Spec$.
\end{defin}

In particular, we can regard topological spaces as constant sheaves, and thus as elements of $dSt$. Certain topological
spaces are co-affine. Recall, for example, the Eilenber-Maclane spaces $K(\Z,n) \simeq B^n\bbG_a$.

\begin{prop}
$B^n\bbG_a \simeq \Spec(\Sym k[-n])$.
\end{prop}
\begin{proof}
The proof in \cite{vezzosi2013autour} is by induction on pushout squares.
\end{proof}

This leads to a description of $\mathcal{O}(X)$ for $X$ the constant sheaf associated to a CW complex.

\begin{thm}
\label{thm:global_cochain}
If $X$ is a CW complex, then there is a quasi-isomorphism $\mathcal{O}(X) \simeq C^*(X)$, where the latter is the singular
cochain complex.
\end{thm}
\begin{proof}
Write $X$ as the colimit of some diagram of points: $X = \colim \Spec k$. Then consider the map:
\[	C^*(X) \simeq C^*(\colim \Spec(k)) \to \lim C^*(\Spec(k)) \simeq \lim k \simeq \mathcal{O}(X) .	\]
This induces an isomorphism in cohomology:
\[	H^n(X) \cong [X,B^n\bbG_a] \cong \pi_0 \Map_{\cdga_k}(\Sym k[-n], \mathcal{O}(X) ) \simeq H^n(\mathcal{O}(X)).	\]
\end{proof}



\section{HKR isomorphism}
In this section we follow \cite{TV_HKR}; a less technical exposition of these ideas is in \cite{BZN_loop}. We want
to prove an equivalence between cdga's with an $S^1$ action and, roughly speaking, cdga's with an extra derivation.

\begin{defin}
Let $S^1-\cdga_k^{\leq 0}$ denote connective cdga's with an action of $S^1$. This definition can be made rigorous by realizing
the connetive cdga's as simplicial commutative algebras via Dold-Kan, and realizing $S^1$ as a simplicial group, which can
act on the simplicial algebras.
\end{defin}

\begin{eg}
For $A \in \cdga_k^{\leq 0}$, the free $S^1$-algebra is $S^1 \otimes A \simeq A \otimes_{A\otimes A} A$, also known as the
Hochschild chain complex. The functor $A \mapsto S^1 \otimes A$ is left adjoint to the forgetful functor $S^1-\cdga_k^{\leq 0}
\to \cdga_k^{\leq 0}$.
\end{eg}

The second category of interest is the following.

\begin{defin}
Let $\epsilon-\cdga_k^{\leq 0}$ be the category of cdga's equipped with an extra differential $\epsilon : A \to A[-1]$. This
definition can be made more rigorous by considering the over-category $k[\epsilon] - dg-mod_k$, where $|\epsilon| = -1$. (These
are called \textbf{mixed complexes} in \cite{PTVV}.)
This category has a symmetric monoidal structure, arising from the co-multiplication $k[\epsilon] \to k[\epsilon]
\otimes k[\epsilon]$. Then we define $\epsilon-\cdga_k^{\leq 0}$ to be the monoids in $k[\epsilon] - dg-mod_k$.
\end{defin}

\begin{eg}
\label{eg:de_rham}
For $A \in \cdga_k^{\leq 0}$, the free $\epsilon$-algebra is \textbf{the de Rham complex} $DR(A) = \Sym_A(\bbL_A[1])$,
where the extra differential is the de Rham differential.
\[
\begin{tikzcd}
A^{-3}\arrow{d} & \bbL^{-2}\arrow{d} & (\wedge^2 \bbL)^{-1}\arrow{d} & (\wedge^3 \bbL)^0 \\
A^{-2}\arrow{d}\arrow{ur}{d_{dR}} & \bbL^{-1}\arrow{d}\arrow{ur}{d_{dR}} & (\wedge^2 \bbL)^{0}\arrow{ur}{d_{dR}} & \\
A^{-1}\arrow{d}\arrow{ur}{d_{dR}} & \bbL^0\arrow{ur}{d_{dR}} & & \\
A^0\arrow{ur}{d_{dR}} & & &
\end{tikzcd}
\]
The functor $A \mapsto DR(A)$ is left adjoint to the forgetful functor $\epsilon-\cdga_k^{\leq 0}
\to \cdga_k^{\leq 0}$.
\end{eg}

We can now state and sketch the proof of the main theorem in \cite{TV_HKR}.

\begin{thm}
There is an equivalence $\phi$ which commutes with the forgetful functors:
\[
\begin{tikzcd}
S^1 - \cdga_k^{\leq 0}\arrow{rr}{\phi}\arrow{dr} & & \epsilon - \cdga_k^{\leq 0}\arrow{dl} \\
 & \cdga_k^{\leq 0} & 
\end{tikzcd}
\]
\end{thm}
\begin{proof}
   
\begin{enumerate}
\item Note first that $S^1-\cdga_k^{\leq 0} \simeq \Fun(BS^1, \cdga_k^{\leq 0})$, where $BS^1$ is the category with a single
object and 1-morphisms for each element of $S^1$.
\item Passing to global sections gives a functor $\phi_3$:
\[
\begin{tikzcd}
\Fun(BS^1, \cdga_k^{\leq 0})\arrow{r}{\phi_3}\arrow[swap]{d}{\text{eval}} & k[u]-\cdga_k\arrow{d}{k\otimes_{k[u]} -} \\
\cdga_k^{\leq 0}\arrow[hook]{r} & \cdga_k .
\end{tikzcd}
\]
Some comments are necessary here. First, the global sections of $BS^1$ are $k[u]$ with $|u| = 2$, due to Theorem
\ref{thm:global_cochain}. Second, working with non-connective cdga's is necessary in the right hand column, because
$\cdga_k^{\leq 0}$ is not closed under limits. Third, the diagram is \emph{not} commutative, but becomes so when restricted
to $\cdga^+_k$, the category of cdga's which are bounded on the left. The proof of commutativity uses an increasing induction
on Postnikov towers, and the existence of a base case for the induction requires this extra constraint. Moreover,
the restriction $\phi_3^+$ to left-bounded cdga's is fully faithful, with essential image given by $k[u]-\cdga_k^{+,\leq 0}$.
\item $k[\epsilon]$ is Koszul dual to $k[u]$, which gives a map:
\[	\Ext_{k[\epsilon]}(k,-) : k[\epsilon] - dg-mod_k \to k[u] - dg-mod_k.	\]
Moreover, this map preserves the monoidal structure on the two categories, so it induces a map $\phi_4: \epsilon-\cdga_k^{\leq 0}
\to k[u] -\cdga_k$, which fits into a diagram:\todo{do this argument more carefully}
\[
\begin{tikzcd}
\epsilon-\cdga_k^{\leq 0}\arrow{r}{\phi_4}\arrow{d} & k[u]-\cdga_k\arrow{d}{k\otimes_{k[u]} -} \\
\cdga_k^{\leq 0}\arrow[hook]{r} & \cdga_k .
\end{tikzcd}
\]
The comments about commutativity, full faithfulenss and essential image from the previous step also apply here.
\item Putting these together, we obtain a commutative diagram:
\[
\begin{tikzcd}
\Fun(BS^1, \cdga_k^{+,\leq 0})\arrow{r}{\phi_3^+}\arrow[swap]{d}{\text{eval}} & k[u]-\cdga^+_k\arrow{d}{k\otimes_{k[u]} -}
& \epsilon-\cdga_k^{+,\leq 0}\arrow[swap]{l}{\phi_4^+}\arrow{d}{\text{forget}} \\
\cdga_k^{+,\leq 0}\arrow[hook]{r} & \cdga_k^+ & \cdga_k^{+,\leq 0}\arrow[hook]{l} .
\end{tikzcd}
\]
$\phi_3^+$ and $\phi_4^+$ are fully faithful with the same essential image, which gives an equivalence $\phi$ which
fits into the commutative diagram:
\[
\begin{tikzcd}
\Fun(BS^1, \cdga_k^{+,\leq 0})\arrow{r}{\phi^+}\arrow[swap]{d}{\text{eval}} & \epsilon-\cdga_k^{+,\leq 0}\arrow{d}{\text{forget}} \\
\cdga_k^{+,\leq 0}\arrow[hook]{r} &  \cdga_k^{+,\leq 0} .
\end{tikzcd}
\]
$\phi^+$ is an equivalence, so in particular it commutes with colimits. Therefore it extends to an equivalence between
$\Fun(BS^1, \cdga_k^{\leq 0})$ and $\epsilon-\cdga_k^{\leq 0}$.
\end{enumerate}
\end{proof}

\begin{thm}
$\phi$ also commutes with the free functors, i.e. $\phi(S^1\otimes A) \simeq DR(A)$.
\[
\begin{tikzcd}
S^1 - \cdga_k^{\leq 0}\arrow{rr}{\phi} & & \epsilon - \cdga_k^{\leq 0} \\
 & \cdga_k^{\leq 0}\arrow[swap]{ur}{DR}\arrow{ul}{S^1 \otimes} & 
\end{tikzcd}
\]
\end{thm}
\begin{proof}
This just follows from category theory and the fact that $\phi$ commutes with the forgetful functors.
\end{proof}

\begin{cor}[HKR isomorphism]
\label{cor:HKR}
Let $X \in dSt$. \todo{in the paper they state this just for classical schemes, but it clearly works in more generality.
what assumptions do we need on the stack? finite presentation?}
\begin{enumerate}
\item $\mathcal{O}_X \otimes_{\mathcal{O}_X\otimes\mathcal{O}_X} \mathcal{O}_X \simeq \Sym_{\mathcal{O}_X} (\bbL_X[1])$.
\item If $X$ is a smooth truncated scheme, this specializes to $\mathcal{O}_X \otimes_{\mathcal{O}_X\otimes\mathcal{O}_X} 
\mathcal{O}_X \simeq \Sym_{\mathcal{O}_X} (\Omega^1_X[1])$. This is the classical version of the HKR isomorphism, enhanced
to an isomorphism of algebras, as opposed to just complexes.
\item Let $hS^1$ denote homotopy fixed points of the $S^1$ action, and ev denote the even part of de Rham cohomology. Then:
\[	(\mathcal{O}_X \otimes_{\mathcal{O}_X\otimes\mathcal{O}_X} \mathcal{O}_X)^{hS^1} \simeq H_{dR}^{ev}(X).	\]
\end{enumerate}
\end{cor}
\begin{proof}
The first statement is just saying that we can apply the equivalence $\phi$ at the level of sheaves.
\todo{say something about the last one, maybe even negative cyclic complexes}
\end{proof}

\begin{rem}
\label{rem:loop_stack}
For $X \in dSt$, we can define the \textbf{derived loop stack} $\mathscr{L}X$ as the mapping stack $\Map_{dSt}(S^1,X)$.
Using tensor-hom adjunction, $\mathcal{O}(\mathscr{L}X) \simeq S^1 \otimes X$. On the other side of the HKR
isomorphism, $\Sym_{\mathcal{O}_X} (\bbL_X[1])$ has an interpretation as $\mathcal{O}(T[1]X)$, global sections of the
shifted tangent bundle of $X$. This gives an identification $\mathscr{L}X \simeq T[1]X$. 
The slogan is that ``forms on $X$ are functions on $\mathcal{L}X$''. More about this in \cite{BZN_loop}.
\end{rem}


\section{Shifted symplectic structures}
In all remaining sections we follow \cite{PTVV}. For $X$ a smooth scheme over $k$, a symplectic structure is a closed
2-form
$\omega \in H^0(X,\Omega^{2,cl}_X)$, which induces an isomorphism $\Theta_\omega : T_X \simeq \Omega^1_X$. We want to
generalize this for $X$ a derived Artin stack over $k$. Morally speaking, we want an n-shifted symplectic structure
to be an element $\omega \in H^0(X,\wedge^2\bbL_X [2])$, which is closed and induces an isomorphism
$\Theta_\omega : \bbT_X \to \bbL_X[n]$. The main technical difficulty is defining what it means for a form to be closed:
instead of $d_{dR} \omega = 0$, we want $d_{dR} \omega$ to be exact, meaning that it's in the image of the internal
differential of the complex $\wedge^3\bbL_X[3]$. (See the diagram in \ref{eg:de_rham}; the internal differentials are the
vertical maps there.) In particular, ``closed'' is now a structure, instead of a property.\todo{explain this better} 

Using the last part of Corollary \ref{cor:HKR}, as well as remark \ref{rem:loop_stack}
we can translate the closed condition into the condition of being a homotopy fixed point for the action of $S^1$ on $\mathscr{L}X$. 
However, the difficulty in working with $\mathscr{L}X$ is that loops do not satisfy descent in the \'etale (or smooth) topology.
As such, one needs to work with infinitesimal loops, which is achieved in \cite{BZN_loop} by introducing the completion
of $\mathscr{L}X$ around the constant loops, i.e. the zero section $X \to \mathscr{L}X$.

The authors of \cite{PTVV} prefer a different approach, based on the negative cyclic complex, where descent is immediate
from the definition of forms and closed forms, see \ref{prop:forms_descent}.

\begin{defin}
Let $E$ be an $\epsilon$-dg-module (or mixed complex) over $k$. The \textbf{negative cyclic complex} of $E$ is a dg-module $NC(E)$
over $k$, given by:
\[	NC^n(E) = \prod_{i\geq 0} E^{n-2i} .	\]
The differential $D$ is the sum of $\epsilon$ and the internal differential $d$:
\[	D\big(\{m_i\}\big)_j = \epsilon m_{j-1} + d m_j .	\]
\end{defin}

Consider now the \textbf{weight grading} on $E$, which is $E = \oplus_p E(p)$ such that $\epsilon : E(p) \to E(p+1)$.
We consider a variant of the negative cyclic complex which uses the weight grading: $NC^n(E)(p) = \prod_{i\geq 0}
E^{n-2i}(p+i)$.\footnote{When talking about complexes, round parantheses always refer to the weight grading,
while square brackets refer to the cohomological grading. The confusing bit is that $(p)$ means that we're isolating
the weight $p$ subspace, while $[n]$ means that we're shifting the cohomological degree by $n$.}

\begin{defin}
The \textbf{weighted negative cyclic complex} is:
\[	NC^w(E) = \oplus_p NC(E)(p).	\]
In other words, we have a double complex whose degree $n$, weight $p$ part is $\prod_{i\geq 0}
E^{n-2i}(p+i)$.
\end{defin}

\todo{give some intuition about how this is related to the corollary in HKR}

\begin{rem}
\label{rem:underlying_form}
There is a natural map $NC^w(E) \to E$, given by projection to the $i=0$ component:
\[	NC^w(E)^n(p) = \prod_{i\geq 0} E^{n-2i}(p+i) \to E^n(p) .	\]
Shortly we will interpret this as assigning to a closed $p$-form its underlying $p$-form.
\end{rem}

Recall that, for $A \in \cdga_k^{\leq 0}$, we have the de Rham complex $DR(A) = \oplus_p(\wedge^p \bbL_A)[p]$.
\begin{defin}
The space of \textbf{p-forms of degree n} on $A$ is\footnote{We're using Dold-Kan to identify a connective complex
with a simplicial set, and then taking geometric realization to get a space.}:
\[	\mathcal{A}^p(A,n) = \big| \wedge^p \bbL_A [n-p] \big| \in \cS.	\]
The space of \textbf{closed p-forms of degree n} on $A$ is:
\[	\mathcal{A}^{p,cl}(A,n) = \big|NC^w(DR(A))[n-p](p) \big| \in \cS.	\]
\end{defin}

\begin{rem}
One may expect $n$-shifted $p$-forms to require a shift by $n$, instead of the $n-p$ that appears in the definition.
But note that a shift in $p$ is already present in the de Rham complex, as well as its associated weighted negative cyclic
complex. This brings the total shift to $n-p$.\todo{wait, this doesn't actually work yet, fix it}
\end{rem}

\begin{rem}
The map in Remark \ref{rem:underlying_form} induces a map on the geometric realizations $\mathcal{A}^{p,cl}(A,n)
\to \mathcal{A}^p(A,n)$, which associates to a closed $p$-form its underlying $p$-form.
\end{rem}

\begin{defin}
For $w \in \mathcal{A}^p(A,n)$, the homotopy fiber $K(w)$ of $\mathcal{A}^{p,cl}(A,n) \to \mathcal{A}^p(A,n)$ is
\textbf{the space of keys} of $w$.
\end{defin}

As advertised, this formalism makes it easy to prove:
\begin{prop}
\label{prop:forms_descent}
$\mathcal{A}^p(-,n)$ and $\mathcal{A}^{p,cl}(-,n)$ are derived stacks for the \'etale topology.
\end{prop}
\begin{proof}
Backtracking through two pairs of adjoint functors we have:
\[	\mathcal{A}^p(A,n) \simeq \Map_{dg-mod_k}(k, \wedge^p\bbL_A[n]).	\]
This reduces the problem to showing that $A \mapsto \wedge^p\bbL_A[n]$ satisfies descent, which it does, because it's
quasi-coherent. Similarly, letting $k(p)$ denote the mixed complex with just a copy of $k$ in degree 0 and weight $p$,
\[	\mathcal{A}^{p,cl}(A,n) = |NC^w(DR(A))[n-p](p)| \simeq \Hom_{\epsilon-dg-mod_k}\big(k(p),DR(A)[n-p]\big)
= \Hom_{\epsilon-dg-mod_k} \big(k(p), \oplus_q \wedge^q \bbL_A[n-p+q].	\]
The middle equivalence follows from Corollary 1.4 in \cite{PTVV}. Hence this problem is also reduced to descent for the
cotangent complex.
\end{proof}

This proposition allows us to globalize the definitions. For $F\in dSt_k$, let:
\begin{align*}
\mathcal{A}^p(F,n) &= \Map_{dSt_k}\big(F,\mathcal{A}^p(-,n)\big), \\
\mathcal{A}^{p,cl}(F,n) &= \Map_{dSt_k}\big(F,\mathcal{A}^{p.cl}(-,n)\big).
\end{align*}

We also have the following nice description for $\mathcal{A}^p(F,n)$, but unfortunately no such thing exists for
$\mathcal{A}^{p,cl}(F,n)$.

\begin{prop}
\label{prop:forms_maps}
Let $F \in dSt_k$, then $\mathcal{A}^p(F,n) \simeq \Map_{QCoh(F)}\big(\mathcal{O}_F,\wedge^p\bbL_F[n]\big)$.
\end{prop}
\begin{proof}
The idea is to induct on the $m$-geometricity level of $F$. That is, choose an atlas for $F$ in terms of $m-1$-geometric
stacks $\{X_{\alpha}\}$, and look at the following commutative diagram:
\[
\begin{tikzcd}
\Map_{QCoh(F)}\big(\mathcal{O}_F,\wedge^p\bbL_F[n]\big) \arrow{d}\arrow{r} &
\lim \Map_{QCoh(X_{\alpha})}\big(\mathcal{O}_{X_{\alpha}},\wedge^p\bbL_{X_{\alpha}}[n]\big)\arrow{d} \\
\mathcal{A}^p(F,n) \arrow{r} & \lim \mathcal{A}^p(X_{\alpha},n) .
\end{tikzcd}
\]
The bottom map is an equivalence by descent, the right map is an equivalence by the inductive hypothesis. The top map
is also an equivalence, but this is more subtle, see \cite{PTVV} for the details. Therefore the left map is an equivalence.
\end{proof}

Let $F$ be a derived Artin stack, locally finitely presented over $k$. Then $\bbL_F$ is perfect, so in particular it's
dualizable in $QCoh(F)$. The dual is the tangent complex $\bbT_F$.
Using Proposition \ref{prop:forms_maps}, $\omega \in \mathcal{A}^2(F,n)$ determines a map $\mathcal{O}_F \to
\wedge^2 \bbL_F[n]$, which is dual to a map $ \Theta_{\omega}: \bbT_F \to \bbL_F[n]$.

\begin{defin}
$\omega \in \mathcal{A}^2(F,n)$ is \textbf{non-degenerate} if $\Theta_{\omega}$ is a quasi-isomorphism. The space of
\textbf{n-shifted symplectic structures} on $F$ is the pullback of the diagram:
\[
\begin{tikzcd}
Symp(F,n)\arrow{d}\arrow{r} & \mathcal{A}^{2,cl}(F,n)\arrow{d} \\
\mathcal{A}^2(F,n)^{nd}\arrow{r} & \mathcal{A}^2(F,n).
\end{tikzcd}
\]
\end{defin}

\begin{rem}
$\mathcal{A}^2(F,n)^{nd}$ is a union of path components of $\mathcal{A}^2(F,n)$, so symplectic structures are the same as
closed 2-forms whose underlying 2-forms live in these particular components.
\end{rem}

\begin{rem}
If $\bbL_X$ has amplitude $(-m,n)$, then shifted symplectic structures on $X$ can only exist in degree $m-n$.
\end{rem}

\begin{eg}
If $X$ is a smooth underived scheme, then $\bbL_X = \Omega^1_X[0]$, so the only shifted symplectic structures on $X$
are symplectic structures in the usual sense.
\end{eg}

\begin{rem}
For low values of $n$, an $n$-shifted symplectic structure can be seen as pairing the negative degree terms in $\bbL_X$
(the derived structure) with the positive degree terms (the stacky structure).
\end{rem}


\section{Examples: BG and Perf}
For our first first nontrivial example, we take $X = BG$, for $G$ reductive. Let $\fr g$ be the Lie algebra of $G$.

\begin{prop}
There exist 2-shifted symplectic structures on $BG$. Moreover, homotopy classes of such correspond to non-degenerate 
invariant bilinear forms on $\fr g$.
\end{prop}
\begin{proof}
Recall that $\bbL_{BG} \simeq g^* [-1]$, so that $\bbT_{BG} \simeq g[1]$. It's immediate that non-degenerate
$p$-forms of degree $n$ cannot exist unless $n=2$. Let's see what the spaces of forms look like.

We proved that $\mathcal{A}^p(-,n)$ satisfies descent; this is equivalent to the fact that $DR(-)$ satisfies descent.
Therefore we can talk about $DR(BG)$, obtained by taking global sections on $BG$, which corresponds to taking
invariants under $G$. We obtain $DR(BG) \simeq (\Sym_k \fr g^*)^G$, concentrated
in degree 0, and where $\fr g^*$ has weight 1.
\[
\begin{tikzcd}
0 & 0 & 0 & 0 \\
k\arrow{ur}{d_{dR}} & \fr g^*\arrow{ur}{d_{dR}} & \Sym^2 \fr g^*\arrow{ur}{d_{dR}} & \\
0 & 0 & 0 & 
\end{tikzcd}
\]
Now recall that $\mathcal{A}^p(BG,n) = |DR(BG)[n-p](p)|$; in particular:
\[	\pi_i\big(\mathcal{A}^p(BG,n)\big) = H^{-i} \tau^{\leq 0} DR(BG)[n-p](p) = H^{-i} \tau^{\leq 0} (\Sym^p \fr g^*)^G [n-p]	.	\] 
This means that we have:
\begin{equation}
\label{eq:desc_forms}
	\mathcal{A}^p(BG,n) = 
\left\{ \begin{array} {ll} * & \text{if } n<p,  \\ 
K\big((\Sym^p \fr g^*)^G, n-p\big) & \text{if } n\geq p .  \end{array} \right.
\end{equation}
The interesting case is $n=p$, where $\pi_0\big(\mathcal{A}^p(BG,n)\big) \cong (\Sym^p \fr g^*)^G$; in all other cases,
$\pi_0\big(\mathcal{A}^p(BG,n)\big) = 0$.

The de Rham differential is identically 0 for degree reasons. This means that all forms admit a closed structure. However, this
need not be canonical. For example, $\pi_0\big(\mathcal{A}^1(BG,3)\big) = 0$, but $\pi_0\big(\mathcal{A}^{1,cl}(BG,3)\big) \cong 
(\Sym^2 \fr g)^G$. This can be seen from the global sections of the de Rham complex:
\[
\begin{tikzcd}
k & \fr g^* & \Sym^2 \fr g^*\arrow{d} \\
0 & 0 & 0 \\
0 & 0\arrow{ur}{d_{dR}} & 0 
\end{tikzcd}
\]

Let's determine the spaces of closed forms in more detail:
\[	\mathcal{A}^{p,cl}(BG,n) = \big| NC^w(DR(BG))[n-p](p)\big|.	\]
Using the definition of $NC^w$, and then the particular form that $DR(BG)$ takes:
\begin{align*}
	NC^w(DR(BG))^m = \oplus_p \prod_{i\geq 0} DR(BG)^{m-2i}(p+i) &= \left\{ \begin{array} {ll}
0 & \text{for m odd}, \\ \oplus_{p\geq - \frac{m}{2}} DR(BG)^0(p+\frac{m}{2}) & \text{for m even}
\end{array} \right. \\
&= \left\{ \begin{array} {ll}
0 & \text{for m odd}, \\ \oplus_{p\geq - \frac{m}{2}} \big(\Sym^{p+j} \fr g^*\big)^G & \text{for m even}
\end{array} \right.
\end{align*}
We may as well write $m=2j$, and remember that for odd $m$ the result is 0:
\[	NC^w(DR(BG))^{2j} = \oplus_{p\geq -j} \big(\Sym^{p+j} \fr g^*\big)^G[-2j].	\]
The final form of the weighted negative cyclic complex is, then:
\[	NC^w(DR(BG)) = \oplus_j \oplus_{p\geq -j} \big(\Sym^{p+j} \fr g^*\big)^G[-2j].	\]
Finally, we need to shift by $n-p$, take the weight $p$ part, and take geometric realization:
\[	\mathcal{A}^{p,cl}(BG,n) = \big|  \oplus_{j\geq -p} \big(\Sym^{p+j} \fr g^*\big)^G[n-p-2j] \big|. \]

It's a bit hard to give a complete description of these spaces, analogous to \ref{eq:desc_forms}. But we make a few comments:
\begin{enumerate}
\item If $n<p$, the entire negative cyclic complex gets shifted into positive degrees, which are killed by geometric realization.
Hence for $n<p$, $\mathcal{A}^{p,cl}(BG,n) = * = \mathcal{A}^{p}(BG,n)$.
\item To have nontrivial $\pi_0$ we need $n-p \geq 0$ and even. In this case, $\pi_0\big(\mathcal{A}^{p,cl}(BG,n)\big)
\cong \big(\Sym^{\frac{p+n}{2}} \fr g^*\big)^G$. In particular, $\pi_0\big(\mathcal{A}^{2,cl}(BG,2)\big)
\cong \big(\Sym^{2} \fr g^*\big)^G$.
\end{enumerate}
All this was quite messy, but at least the non-degeneracy condition is what you'd expect.
\end{proof}

\begin{rem}
\label{rem:symp_trace}
If $G \subset GL(n)$, there's a canonical 2-shifted symplectic structure coming from the trace $\Tr(\text{mult})$.
\end{rem}

We move on to an example which is universal in some sense. Recall the stack $\Perf$ from 
Chapter \ref{chap:stack_perf}, and in particular the description of its tangent spaces in Theorem \ref{thm:tangent_perf}:
$T_E \Perf \simeq \End(E)[1]$. We use here without proof the global description of the tangent bundle, which is as
follows. Let $\mathcal{E}$ be the universal perfect complex over $\Perf$, which is classified by the identity
map $\Perf \to \Perf$. Then $\bbT_{\Perf} \simeq \End(\mathcal{E}, \mathcal{E})[1]$.

\begin{thm}
\label{thm:symp_perf}
There is a 2-shifted symplectic structure on $\Perf$.
\end{thm}
\begin{proof}
The closed 2-form on $\Perf$ is given by the Chern character, which is constructed in \cite{TV_Chern}. We first discuss
the underlying 2-form and the nondegeneracy condition. 

Recall from \ref{} the Atiyah class:
\[	a_\mathcal{E} : \mathcal{E} \to \mathcal{E} \otimes_{\mathcal{O}_\Perf} \bbL_{\Perf}[1] .	\]
Iterating on this construction, we obtain:
\[	a_\mathcal{E}^i : \mathcal{E} \to \mathcal{E} \otimes_{\mathcal{O}_\Perf} \wedge^i \bbL_{\Perf}[i] .	\]
Since $\mathcal{E}$ is dualizable \todo{say sth about this}, we can consider the dual map, which we denote by the same
symbol:
\[	a_\mathcal{E}^i : \mathcal{O}_{\Perf} \to \mathcal{E}^* \otimes \mathcal{E} \otimes_{\mathcal{O}_\Perf} \wedge^i \bbL_{\Perf}[i].	\]
Composing with the trace map $\mathcal{E}^* \otimes \mathcal{E} \to \mathcal{O}_\Perf$, we obtain:
\[	\Ch_i(\mathcal E) = \frac{\Tr(a_\mathcal{E}^i)}{i!} \in \Hom\big(\mathcal{O}_\Perf,\wedge^i \bbL_{\Perf}[i]\big) 
\cong H^i\big(\wedge^i \bbL_{\Perf}\big) .	\]
Taking $i=2$ we otain an element of $H^2(\wedge^2 \bbL_{\Perf})$, which is the underlying 2-form that we are looking after.

Now we use the fact that $\bbT_{\Perf} \simeq \End(\mathcal{E})[1]$, so that
$\bbL_\Perf[1] \simeq \End(\mathcal{E})$. The Atiyah class is, then, the adjoint of the multiplication morphism:
\[	\text{mult} : \End(\mathcal{E}) \otimes \End(\mathcal{E}) \to \End(\mathcal{E}),	\]
and we can identify $\Ch_2(\mathcal{E})$ with $\Tr(\text{mult})/2$, which is nondegenerate because the trace is. (Recall that
the trace is defined as adjoint to the identity map $\mathcal{E} \to \mathcal{E}$.)

It remains to lift $\Ch_2(\mathcal{E})$ to the negative cyclic complex:
\[
\begin{tikzcd}
\; & NC \arrow{d} \\
\Perf \arrow{r}{\Ch_2}\arrow[dotted]{ur} & DR .
\end{tikzcd}
\]
\todo{finish this}
\end{proof}

\begin{rem}
Note that there is an embedding $i: BGL(n) \to \Perf$, obtaining by regarding vector bundles as a sub-category of the perfect
complexes. Theorem \ref{thm:symp_perf} gives a 2-shifted symplectic structure $\omega_{\Perf}$ on $\Perf$, while 
\ref{rem:symp_trace} gives
an explicit form for a 2-shifted symplectic structure $\omega_{BGL(n)}$ on $BGL(n)$. Up to a numerical factor, both 
expressions are the trace
of a multiplication map between endomorphisms. It follows that $\omega_{BGL(n)} = i^* \omega_{\Perf}$.
\end{rem}



\section{Examples: Mapping Stacks}
For the next example, we build towards the following AKSZ-type statement, made precise in Theorem \ref{thm:symp_map}.
If $F \in dSt_k$ is equipped with an n-shifted symplectic structure, and $X \in dSt_k$ 
is equipped with, roughly, a fundamental class in degree $d$, then the mapping stack $\Map_{dSt}(X,F)$ admits an
$n-d$ shifted symplectic structure. Together with Theorem \ref{thm:symp_perf}, this proves that various moduli stacks of
bundles and complexes admit shifted symplectic structures. (See Corollary \ref{cor:symp_moduli}.)

\begin{rem}
Let us first give a heuristic idea for the AKSZ construction, by working with $C^{\infty}$ manifolds. Let $M$ be a compact
manifold of dimension $d$, and $(N,\omega)$ a symplectic manifold. Consider the evaluation map:
\[
\begin{tikzcd}
	M \times C^{\infty}(M,N) \arrow{r}{eval} & N .
\end{tikzcd}
\]
Pullback and integration along $M$ give a map:
\begin{align*}
\Omega_N^p &\to \Omega^{p-d}_{C^{\infty}(M,N)} \\
\alpha &\mapsto \int_M eval^* \alpha.
\end{align*}
In particular applying it to $\omega$ gives $\int_M eval^*\omega \in \Omega^{2-d}$. \todo{how can this be symplectic if it's no
longer a 2-form?}
\end{rem}

To imitate this strategy in the derived context, we need to define appropriate notions of orientability and integration
along the fibers.

\begin{defin}
For any $X \in dSt_k$, let $X_A$ denote $X \times \Spec A$.
\footnote{If, like me, you're not very good with stacks, here's some intuition for considering $X_A$. When making statements
about the ``points'' of a stack, e.g. in the proof of Theorem \ref{thm:symp_map}, it's not sufficient to consider $k$-valued
points, but rather those valued in an arbitrary derived affine. That's because stacks are defined as functors on
$d\Aff$, so information about them is complete only when we've probed with all derived affines.} 
We say that $X$ is $\mathcal{O}$\textbf{-compact} if:
\begin{enumerate}
\item $\mathcal{O}_{X_A}$ is a compact object in $QCoh(X_A)$;
\item for any perfect complex $E$ on $X_A$, the $A$-dg-module $C(X,E) = \Hom(\mathcal{O}_{X_A},E)$ is perfect.
\footnote{This is the same as $p_* E$, where $p:X\times \Spec A \to \Spec A$ is the projection.}
\end{enumerate}
\end{defin}

The property of being $\mathcal{O}$-compact buys us the following.
\begin{lem}
If $X$ is $\mathcal{O}$-compact, there is a natural transformation:
\[	\kappa_X : DR( - \times X) \to DR(-) \otimes_k C(X,\mathcal{O}_X).	\]
\end{lem}
\begin{proof}
A brief explanation for this is as follows. $C(X,\mathcal{O}_X)$ is perfect over $k$ by the $\mathcal{O}$-compactness
hypothesis, so the functor $E \mapsto \otimes_k C(X,\mathcal{O}_X)$ commutes with limits. Similarly, $DR$ sends colimits
to limits (this is descent). Hence both functors send colimits to limits. Now, since every object of $dSt_k$ is a colimit
of objects in $d\Aff_k$, it suffices to construct a natural transformation between the functors restricted to $d\Aff_k$,
and then take a left Kan extension in the following diagram.
\[
\begin{tikzcd}
dSt_k^{\op} \arrow[shift left]{rr}{DR(-\times X)}\arrow[shift right,swap]{rr}{DR(-)\otimes_k C(X,\mathcal{O}_X)} 
& &\epsilon - dg-mod_k^{gr} \\
d\Aff_k^{\op}\arrow[hook]{u}\arrow[shift left]{urr}\arrow[shift right]{urr} & &
\end{tikzcd}
\]
At the level of derived affines, the natural transformation is obtained essentially from a Kunneth formula: 
$DR(B)\otimes_k DR(C) \simeq DR(B\otimes_k C)$.
\end{proof}

An application of the functor $NC^w$ to $\kappa_X$, together with the fact that $C(X,\mathcal{O}_X)$ is perfect,
gives another natural transformation:
\[	NC^w(- \times X) \to NC^w\big(DR(-) \otimes_k C(X,\mathcal{O}_X)\big) \simeq NC^w(F) \otimes_k C(X,\mathcal{O}_X) .	\]
Moreover these commute with the canonical maps from $NC^w$ to $DR$:
\[
\begin{tikzcd}
NC^w( F \times X) \arrow{r}{\kappa_{F,X}}\arrow{d} & NC^w(F) \otimes_k C(X,\mathcal{O}_X)\arrow{d} \\
DR( F \times X) \arrow[swap]{r}{\kappa_{F,X}} & DR(F) \otimes_k C(X,\mathcal{O}_X) .
\end{tikzcd}
\]

\begin{defin}
Let $X,F \in dSt_k$ with $X$ $\mathcal{O}$-compact. Assume given a morphism $\eta : C(X,\mathcal{O}_X) \to k[-d]$ of
perfect complexes over $k$. The \textbf{integration map along} $\eta$ is the morphism:
\[
\begin{tikzcd}
\int_{\eta} : NC^w(F\times X) \arrow{r}{K_{F,X}} & NC^w(F) \otimes_k C(X,\mathcal{O}_X) \arrow{r}{id \otimes \eta} &
NC^w(F)[-d] .
\end{tikzcd}
\]
\end{defin}
\begin{rem}
We can define the same for $DR$, and the two integration maps are compatible.
\end{rem}

Finally, an additional constraint on the morphism $\eta$ makes it an $\mathcal{O}$-orientation on $X$, which we define now.
For any $E \in \Perf(X)$, we have a natural pairing, which we can compose with $\eta$:
\[
\begin{tikzcd}
C(X,E) \otimes_k C(X,E^*) \arrow{r} & C(X,\mathcal{O}_X)\arrow{r} & k[-d] .
\end{tikzcd}
\]
Dually this gives a ``cap product'' morphism:
\[	\cap \eta : C(X,E) \to C(X,E^*)^*[-d].	\]

\begin{defin}
Let $X \in dSt_k$ $\mathcal{O}$-compact. An $\mathcal{O}$\textbf{-orientation of degree d} on $X$ is a morphism of complexes:
\[	[X] : C(X,\mathcal{O}_X) \to k[-d]	\]
such that, for every $A \in \cdga_k^{\leq 0}$ and any $E \in \Perf(X_A)$, the morphism
\[	\cap [X]_A : C(X_A,E) \to C(X_A,E^*)*[-d]	\]
is a quasi-isomorphism of $A$-dg-modules.
\end{defin}

The main theorem of this section is:

\begin{thm}[Theorem 2.5 in \cite{PTVV}]
\label{thm:symp_map}
Let $F$ be a derived Artin stack equipped with $\omega \in \Symp(F,n)$. Let $X$ be an $\mathcal{O}$-compact derived stack
equipped with an $\mathcal{O}$-orientation of degree $d$:
\[	[X] : C(X,\mathcal{O}_X) \to k[-d].	\]
Assume, moreover, that $\Map_{dSt}(X,F)$ is a derived Artin stack, locally of finite presentation. Then there is a canonical
$n-d$ shifted symplectic structure on $\Map_{dSt}(X,F)$.
\end{thm}

\begin{proof}
Note that $\omega \in \mathcal{A}^{2,cl}(F,n)$ is the same as:
\[	\omega : k[2-n](2) \to NC^w(F) .	\]
Pulling back along the evaluation morphism $\pi : X \to \Map(X,F)$ and integrating on $X$ gives:
\[
\begin{tikzcd}
k[2-n](2) \arrow{r}{\omega} & NC^w(F) \arrow{r}{\pi^*} & NC^w\big(X\times \Map(X,F)\big) \arrow{r}{\int_{[X]}} &
NC^w\big(\Map(X,F)\big)[-d] .
\end{tikzcd}
\]
It remains to see that the underlying 2-form of $\int_{[X]} \pi^* \omega$ is non-degenerate. We can check
this condition locally. Let $f : \Spec A \to \Map(X,F)$ be an $A$-point of $\Map(X,F)$. The tangent complex at $f$ is:
\[	\bbT_f \Map(X,F) \simeq C\big(X \times \Spec A, f^*(\bbT_F)\big).	\]
The underlying 2-form of $\omega$ determines a non-degenerate pairing:
\[	\bbT_F \wedge \bbT_F \to \mathcal{O}_F[n].	\]
By pull-back we obtain a non-degenerate pairing of $A$-dg-modules:
\[	C\big(X \times \Spec A, f^*(\bbT_F)\big) \wedge C\big(X \times \Spec A, f^*(\bbT_F)\big) \to C\big(X \times \Spec A,
\mathcal{O}_{X\times \Spec A}[n]\big) .	\]
Composing with the orientation $[X_A]$ gives a non-degenerate pairing:
\[	C\big(X \times \Spec A, f^*(\bbT_F)\big) \wedge C\big(X \times \Spec A, f^*(\bbT_F)\big) \to A[n-d].	\]
But this is just the pairing induced by the underlying 2-form of $\int_{[X]} \pi^*\omega$.
\end{proof}

The following are examples of stacks $X$ which satisfy the $\mathcal{O}$-compactness and $\mathcal{O}$-orientability
hypotheses of Theorem \ref{thm:symp_map}.

\begin{eg}
\begin{enumerate}
\item (Calabi-Yau) Let $X$ be a smooth and proper DM stack over $\Spec k$ with relative dimension $d$, with connected
geometric fibers. Assume given an isomorphism of line bundles $u:\omega_X \simeq \mathcal{O}_X$. $X$ is $\mathcal{O}$-compact
automatically \todo{why?}. Moreover, the isomorphism $u$ together with Serre duality give an isomorphism:
\[	H^d(X,\mathcal{O}_X) \overset{u}{\to} H^d(X,\omega_X) \cong k ,	\]
which lifts to a quasi-isomorphism of complexes:
\[	C(X,\mathcal{O}_X) \to k[-d] .	\]
Theorem \ref{thm:symp_map} also requires that $\Map(X,F)$ be a derived Artin stack when $F$ is one. This follows from 
Artin-Lurie representability.
\item (Betti) 
\item (de Rham)
\item (Dolbeault) We omit this one.
\end{enumerate}
\end{eg}

We have the following existence statements for various moduli spaces of bundles and complexes.
\begin{cor}[Corollaries 2.6 and 2.13 in \cite{PTVV}]
\label{cor:symp_moduli}
Let $G$ be a reductive group scheme over $k$, and fix $\omega \in (\Sym^2 \fr g) ^G$ non-degenerate.
\begin{enumerate}
\item (Betti) Let $M$ be a compact, orientable topological manifold of degree $d$. A choice of fundamental class $[M] \in H_d(M,k)$
determines a $2-d$ shifted symplectic structure on:
\begin{align*}
LocSys(M) &= \Map(M,BG), \\
\Perf(M) &= \Map(M, \Perf) .
\end{align*}

\item (de Rham) Let $Y$ be a smooth and proper DM stack with connected geometric fibers of relative dimension $d$. A choice of
fundamental class $[Y] \in H^{2d}_{dR}(Y)$ determines a $2-2d$ shifted symplectic structure on the stacks of bundles/perfect
complexes with flat connections:
\begin{align*}
Loc_{dR}(Y) &= \Map(Y_{dR},BG), \\
\Perf_{dR}(Y) &= \Map(Y_{dR}, \Perf) .
\end{align*}

\item (Dolbeault) Let $Y$ be as before. A choice of
fundamental class $[Y] \in H^{2d}_{\p}(Y)$ determines a $2-2d$ shifted symplectic structure on the stacks of bundles/perfect
complexes with Higgs fields:
\begin{align*}
Higgs(Y) &= \Map(Y_{\p},BG), \\
\Perf_{\p}(Y) &= \Map(Y_{\p}, \Perf) .
\end{align*}

\item (Calabi-Yau) Let $Y$ be as before. A choice of trivialization $\omega_{Y/k} \simeq \mathcal{O}_Y$ determines a canonical
$2-d$ shifted symplectic structure on:
\begin{align*}
Bun_G(Y) &= \Map(Y,BG), \\
\Perf(Y) &= \Map(Y, \Perf) .
\end{align*}
\end{enumerate}
\end{cor}

\begin{rem}
For $Y$ a K3 or an elliptic surface, we obtain a 0-shifted symplectic structure on $Bun_G(Y)$. This recovers
a result that was known before the paper \cite{PTVV}, for the locus of simple bundles.\footnote{Simple means that the
only endomorphisms are constants, and they don't have negative self extensions.} But the fact that this classical 
symplectic structure extends to the entire moduli space
is new.
\end{rem}

\todo{some extensions of the mapping stack result in a paper by Calaque and in the thesis of Ted Spaide}


\section{Examples: Lagrangian intersections}
Probably no time for this



\bibliographystyle{plain}
\bibliography{dahema}

\end{document}








